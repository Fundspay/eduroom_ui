<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="./../assets/css/bootstrap.min.css">
    <!--! END: Bootstrap CSS-->
    <!--! BEGIN: Vendors CSS-->
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/vendors.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/select2.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/select2-theme.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/tagify.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/tagify-data.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/quill.min.css">
    <!--! END: Vendors CSS-->
    <!--! BEGIN: Custom CSS-->
    <link rel="stylesheet" type="text/css" href="./../assets/css/theme.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!--! END: Custom CSS-->
    <!--! HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries !-->
    <!--! WARNING: Respond.js doesn"t work if you view the page via file: !-->
    <!--[if lt IE 9]>
			<script src="https:oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https:oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
</head>

<body>
    <!--! ================================================================ !-->
    <!--! [Start] Main Content !-->
    <!--! ================================================================ !-->
    <main class="nxl-container apps-container apps-email bg-white">
        <div class="nxl-content without-header nxl-full-content">
            <!-- [ Main Content ] start -->
            <div class="row">
                <!-- First container (main card) -->

                <div class="main-content" style="margin-bottom: 5%;">
                    <div class="row justify-content-center">
                        <div class="col-xl-10">
                            <div class="card stretch stretch-full shadow-sm">
                                <div class="card-body">
                                    <form id="register-form">
                                        <h4 class="mb-4" style="color:rgb(49, 215, 204);">Internship Details</h4>

                                        <!-- Progress Steps -->
                                        <div class="tp-register-progress mb-40">
                                            <div class="progress-steps">
                                                <div class="step completed" data-step="1">
                                                    <span>1</span>
                                                    <p>Personal Info</p>
                                                </div>
                                                <div class="step completed" data-step="2">
                                                    <span>2</span>
                                                    <p>Educational Details</p>
                                                </div>
                                                <div class="step active" data-step="3">
                                                    <span>3</span>
                                                    <p>Internship Details</p>
                                                </div>
                                                <div class="step" data-step="4">
                                                    <span>4</span>
                                                    <p>Identification & Verification</p>
                                                </div>
                                                <div class="step" data-step="5">
                                                    <span>5</span>
                                                    <p>Bank Details</p>
                                                </div>
                                                <div class="step" data-step="6">
                                                    <span>6</span>
                                                    <p>Communication Preferences</p>
                                                </div>
                                                <div class="step" data-step="7">
                                                    <span>7</span>
                                                    <p>Declaration & Consent</p>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Internship Program & Duration -->
                                        <div class="row" style="margin-top: 2%;">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Internship Program <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="internshipProgram" class="form-control"
                                                    placeholder="Enter Internship Program">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Internship Duration <span
                                                        class="text-danger">*</span></label>
                                                <select class="form-control" id="internshipDuration"
                                                    data-select2-selector="icon">
                                                    <option value="">Select Duration</option>
                                                    <option value="15 Days">15 Days</option>
                                                    <option value="1 Month">1 Month</option>
                                                    <option value="2 Months">2 Months</option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- Preferred Start Date -->
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Preferred Start Date <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="preferredStartDate" class="form-control"
                                                    placeholder="YYYY-MM-DD">
                                            </div>
                                        </div>

                                        <!-- Referral Code & Referral Link -->
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Referral Code<span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="referralCode" class="form-control"
                                                    placeholder="Enter Referral Code" maxlength="8">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Referral Link<span
                                                        class="text-danger">*</span></label>
                                                <input type="url" id="referralLink" class="form-control"
                                                    placeholder="Enter Referral Link (if any)">
                                            </div>
                                        </div>

                                        <!-- Referral Source -->
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Referral Source <span
                                                        class="text-danger">*</span></label>
                                                <select class="form-control" id="referralSource"
                                                    data-select2-selector="icon">
                                                    <option value="">Select Referral Source</option>
                                                    <option value="Campus">Campus</option>
                                                    <option value="Online">Online</option>
                                                    <option value="Friend">Friend</option>
                                                    <option value="Social Media">Social Media</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- Submit -->
                                        <div class="d-flex justify-content-end mt-3">
                                            <button type="submit" class="btn px-4"
                                                style="background-color: #36d5d5; color: #fff;">
                                                Next
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <style>
                    .progress-steps {
                        display: flex;
                        justify-content: space-between;
                        position: relative;
                    }

                    .progress-steps::before {
                        content: '';
                        position: absolute;
                        top: 15px;
                        left: 0;
                        right: 0;
                        height: 2px;
                        background: #ddd;
                        z-index: 1;
                    }

                    .progress-steps .step {
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        position: relative;
                        z-index: 2;
                    }

                    .progress-steps .step span {
                        width: 30px;
                        height: 30px;
                        border-radius: 50%;
                        background: #ddd;
                        color: #fff;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        margin-bottom: 5px;
                        font-weight: bold;
                    }

                    .progress-steps .step p {
                        font-size: 12px;
                        color: #777;
                        margin: 0;
                        text-align: center;
                    }

                    .progress-steps .step.active span {
                        background: rgb(49, 215, 204);
                        ;
                    }

                    .progress-steps .step.active p {
                        color: rgb(49, 215, 204);
                        ;
                        font-weight: bold;
                    }
                </style>

                <!-- [ Content Area ] end -->
            </div>
            <!-- [ Main Content ] end -->
        </div>
    </main>
    <!--! ================================================================ !-->
    <!--! [End] Main Content !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! BEGIN: Compose Mail Modal !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! END: Compose Mail Modal !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! [Start] Search Modal !-->
    <!--! ================================================================ !-->

    <style>
        main.nxl-container.apps-container.apps-email {
            margin-top: 0 !important;
            padding-top: 0 !important;
            position: relative;
            top: 0;
        }

        main.nxl-container.apps-container.apps-email {
            margin: 0 !important;
            padding: 0 !important;
            position: relative;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            /* Full viewport height */
            box-sizing: border-box;
        }

        .content-sidebar-header .btn-primary {
            background-color: #36d5d5 !important;
            border-color: #36d5d5 !important;
            color: white !important;
        }

        .content-sidebar-header .btn-primary:hover {
            background-color: #36d5d5 !important;
            /* darker teal */
            border-color: #36d5d5 !important;
        }
    </style>

    <style>
        .email-chip {
            display: flex;
            align-items: center;
            background-color: #e0e0e0;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            color: #333;
        }

        .email-chip .remove-btn {
            margin-left: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .email-chip .remove-btn:hover {
            color: red;
        }

        .email-chip .avatar {
            width: 22px;
            height: 22px;
            background-color: #9cc1f9;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
    </style>

    <!--! ================================================================ !-->
    <!--! [End] Theme Customizer !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! Footer Script !-->
    <!--! ================================================================ !-->
    <!--! BEGIN: Vendors JS !-->
    <script src="./../assets/vendors/js/vendors.min.js"></script>
    <!-- vendors.min.js {always must need to be top} -->
    <script src="./../assets/vendors/js/select2.min.js"></script>
    <script src="./../assets/vendors/js/select2-active.min.js"></script>
    <script src="./../assets/vendors/js/tagify.min.js"></script>
    <script src="./../assets/vendors/js/tagify-data.min.js"></script>
    <script src="./../assets/vendors/js/quill.min.js"></script>
    <!--! END: Vendors JS !-->
    <!--! BEGIN: Apps Init  !-->
    <script src="./../assets/js/common-init.min.js"></script>
    <script src="./../assets/js/apps-email-init.min.js"></script>
    <!--! END: Apps Init !-->
    <!--! BEGIN: Theme Customizer  !-->
    <script src="./../assets/js/theme-customizer-init.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!--! END: Theme Customizer !-->

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <!-- Flatpickr -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Bootstrap JS (optional) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function () {
            const userId = sessionStorage.getItem("userId");
            console.log("User ID:", userId);

            $("#preferredStartDate").flatpickr({
                dateFormat: "Y-m-d",
                minDate: "today"
            });

            $("#internshipProgram").on("input", function () {
                this.value = this.value.replace(/[^a-zA-Z\s]/g, "");
            });

            $("#referralCode").on("input", function () {
                this.value = this.value.replace(/[^a-zA-Z0-9]/g, "");
            });

            $("#register-form").on("submit", function (e) {
                e.preventDefault();

                let internshipProgram = $("#internshipProgram").val().trim();
                let internshipDuration = $("#internshipDuration").val();
                let preferredStartDate = $("#preferredStartDate").val().trim();
                let referralCode = $("#referralCode").val().trim();
                let referralLink = $("#referralLink").val().trim();
                let referralSource = $("#referralSource").val();
                let internshipModeId = 1;

                if (!internshipProgram || !internshipDuration || !preferredStartDate || !referralSource || !referralCode || !referralLink) {
                    return Swal.fire("Error", "All required fields must be filled.", "error");
                }

                if (!/^[a-zA-Z\s]+$/.test(internshipProgram)) {
                    return Swal.fire("Error", "Internship Program must contain only letters.", "error");
                }

                if (referralCode && !/^[a-zA-Z0-9]+$/.test(referralCode)) {
                    return Swal.fire("Error", "Referral Code must be alphanumeric.", "error");
                }

                if (referralLink && !/^https?:\/\/.+$/.test(referralLink)) {
                    return Swal.fire("Error", "Please enter a valid Referral Link (http/https).", "error");
                }

                const payload = {
                    internshipProgram,
                    internshipDuration,
                    internshipModeId,
                    preferredStartDate,
                    referralCode,
                    referralLink,
                    referralSource
                };

                Swal.fire({
                    title: "Confirm Submission",
                    text: "Please check your details carefully. Once submitted, changes cannot be made again.",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonText: "Yes, Confirm",
                    cancelButtonText: "Cancel",
                    reverseButtons: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        Swal.fire({
                            title: "Processing...",
                            text: "Please wait while we save your details.",
                            allowOutsideClick: false,
                            didOpen: () => Swal.showLoading()
                        });

                        $.ajax({
                            url: `https://eduroom.in/api/v1/user/${userId}/internship-details`,
                            method: "PUT",
                            contentType: "application/json",
                            data: JSON.stringify(payload),
                            success: function (res) {
                                Swal.fire("Success", "Details saved successfully!", "success")
                                    .then(() => window.top.location.href = "/register4.html");
                            },
                            error: function (xhr) {
                                Swal.fire("Error", xhr.responseJSON?.message || "Something went wrong.", "error");
                            }
                        });
                    }
                });
            });
        });
    </script>

</body>

</html>