<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="./../assets/css/bootstrap.min.css">
    <!--! END: Bootstrap CSS-->
    <!--! BEGIN: Vendors CSS-->
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/vendors.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/select2.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/select2-theme.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/tagify.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/tagify-data.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/quill.min.css">
    <!--! END: Vendors CSS-->
    <!--! BEGIN: Custom CSS-->
    <link rel="stylesheet" type="text/css" href="./../assets/css/theme.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyALdQBWavYA5oJf9GbtakWhyQkyLZYC-8g",
            authDomain: "eduroom-server.firebaseapp.com",
            projectId: "eduroom-server",
            storageBucket: "eduroom-server.firebasestorage.app",
            messagingSenderId: "785105894800",
            appId: "1:785105894800:web:57784412eddc0f5ae9c715"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const provider = new firebase.auth.GoogleAuthProvider();
    </script>

    <!--! END: Custom CSS-->
    <!--! HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries !-->
    <!--! WARNING: Respond.js doesn"t work if you view the page via file: !-->
    <!--[if lt IE 9]>
			<script src="https:oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https:oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
</head>

<body>
    <!--! ================================================================ !-->
    <!--! [Start] Main Content !-->
    <!--! ================================================================ !-->
    <main class="nxl-container apps-container apps-email bg-white">
        <div class="nxl-content without-header nxl-full-content">
            <!-- [ Main Content ] start -->
            <div class="row">
                <!-- First container (main card) -->

                <div class="main-content" style="margin-bottom: 5%;">
                    <div class="row justify-content-center">
                        <div class="col-xl-6">
                            <div class="card stretch stretch-full shadow-sm">
                                <div class="card-body">
                                    <form id="register-form">
                                        <h3 class="mb-4" style="color:rgb(49, 215, 204); text-align: center;">Create
                                            Your EDUROOM Account
                                        </h3>

                                        <!-- <div class="tp-register-progress mb-40">
                                            <div class="progress-steps">
                                                <div class="step active" data-step="1">
                                                    <span>1</span>
                                                    <p>Personal Info</p>
                                                </div>
                                                <div class="step" data-step="2">
                                                    <span>2</span>
                                                    <p>Educational Details</p>
                                                </div>
                                                <div class="step" data-step="3">
                                                    <span>3</span>
                                                    <p>Internship Details</p>
                                                </div>
                                                <div class="step" data-step="4">
                                                    <span>4</span>
                                                    <p>Identification & Verification</p>
                                                </div>
                                                <div class="step" data-step="5">
                                                    <span>5</span>
                                                    <p>Bank Details</p>
                                                </div>
                                                <div class="step" data-step="5">
                                                    <span>6</span>
                                                    <p>Communication Preferences</p>
                                                </div>
                                                <div class="step" data-step="5">
                                                    <span>7</span>
                                                    <p>Declaration & Consent</p>
                                                </div>
                                            </div>
                                        </div> -->

                                        <!-- First / Last Name -->
                                        <div class="row" style="margin-top: 5%;">
                                            <div class="col-md-12 mb-3">
                                                <label class="form-label">First Name <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="firstName" class="form-control"
                                                    placeholder="Enter First Name">
                                            </div>
                                            <div class="col-md-12 mb-3">
                                                <label class="form-label">Last Name <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="lastName" class="form-control"
                                                    placeholder="Enter Last Name">
                                            </div>
                                        </div>

                                        <!-- DOB & Gender -->
                                        <!-- <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Date of Birth <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="dateOfBirth" class="form-control"
                                                    placeholder="YYYY-MM-DD">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Gender <span
                                                        class="text-danger">*</span></label>
                                                <select class="form-control" id="gender" data-select2-selector="icon">
                                                    <option value="">Select Gender</option>
                                                    <option value="1">Male</option>
                                                    <option value="2">Female</option>
                                                    <option value="3">Other</option>
                                                </select>
                                            </div>
                                        </div> -->

                                        <!-- Phone Numbers -->
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label class="form-label">Phone Number <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="phoneNumber" class="form-control"
                                                    placeholder="10-digit number" maxlength="10">
                                            </div>
                                            <div class="col-md-12 mb-3">
                                                <label class="form-label">Email <span
                                                        class="text-danger">*</span></label>
                                                <input type="email" id="email" class="form-control"
                                                    placeholder="Enter Email Address">
                                            </div>
                                        </div>

                                        <!-- Email -->
                                        <!-- <div class="mb-3">
                                            <label class="form-label">Email <span class="text-danger">*</span></label>
                                            <input type="email" id="email" class="form-control"
                                                placeholder="Enter Email Address">
                                        </div> -->

                                        <!-- <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Referral Code<span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="referralCode" class="form-control"
                                                    placeholder="Enter Referral Code" maxlength="8">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Referral Link<span
                                                        class="text-danger">*</span></label>
                                                <input type="url" id="referralLink" class="form-control"
                                                    placeholder="Enter Referral Link (if any)">
                                            </div>
                                        </div> -->

                                        <!-- Address -->
                                        <!-- <div class="mb-3">
                                            <label class="form-label">Residential Address <span
                                                    class="text-danger">*</span></label>
                                            <textarea id="residentialAddress" class="form-control" rows="2"
                                                placeholder="Enter your address"></textarea>
                                        </div> -->

                                        <!-- Emergency Contact -->
                                        <!-- <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Emergency Contact Name <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="emergencyContactName" class="form-control"
                                                    placeholder="Enter Contact Name">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Emergency Contact Number <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="emergencyContactNumber" class="form-control"
                                                    placeholder="10-digit number" maxlength="10">
                                            </div>
                                        </div> -->

                                        <!-- State & City -->
                                        <!-- <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">State <span
                                                        class="text-danger">*</span></label>
                                                <select class="form-control" id="state" data-select2-selector="icon">
                                                    <option value="">Select State</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">City <span
                                                        class="text-danger">*</span></label>
                                                <select class="form-control" id="city" data-select2-selector="icon">
                                                    <option value="">Select City</option>
                                                </select>
                                            </div>
                                        </div> -->

                                        <!-- Pin Code -->
                                        <!-- <div class="mb-3">
                                            <label class="form-label">Pin Code <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" id="pinCode" class="form-control"
                                                placeholder="Enter Pin Code" maxlength="6">
                                        </div> -->

                                        <!-- Password -->
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label class="form-label">Password <span
                                                        class="text-danger">*</span></label>
                                                <div class="input-group">
                                                    <input type="password" id="password-field" class="form-control"
                                                        placeholder="Enter Password">
                                                    <button class="btn btn-outline-secondary toggle-password"
                                                        type="button">
                                                        <i class="fa fa-eye"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="col-md-12 mb-3">
                                                <label class="form-label">Confirm Password <span
                                                        class="text-danger">*</span></label>
                                                <div class="input-group">
                                                    <input type="password" id="confirm-password-field"
                                                        class="form-control" placeholder="Re-enter Password">
                                                    <button class="btn btn-outline-secondary toggle-password"
                                                        type="button">
                                                        <i class="fa fa-eye"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Submit -->
                                        <div class="d-flex justify-content-center mt-4">
                                            <button type="submit" class="btn w-100"
                                                style="background-color: #36d5d5; color: #fff;">
                                                Sign Up
                                            </button>
                                        </div>

                                    </form>

                                    <div class="col-md-12 text-center mb-3 mt-3">
                                        <span style="font-weight: 600; color: #999;">OR</span>
                                    </div>

                                    <div class="col-md-12 mb-3 d-flex justify-content-center">
                                        <div class="w-100" style="max-width: 600px;">
                                            <button id="google-login-btn" type="button"
                                                class="btn btn-outline-dark d-flex align-items-center justify-content-center w-100"
                                                style="height: 50px; border-radius: 25px;">
                                                <img src="https://img.icons8.com/color/20/000000/google-logo.png"
                                                    class="me-2" alt="Google Icon" style="margin-right: 2%;" />
                                                Continue with Google
                                            </button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <style>
                .progress-steps {
                    display: flex;
                    justify-content: space-between;
                    position: relative;
                }

                .progress-steps::before {
                    content: '';
                    position: absolute;
                    top: 15px;
                    left: 0;
                    right: 0;
                    height: 2px;
                    background: #ddd;
                    z-index: 1;
                }

                .progress-steps .step {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    position: relative;
                    z-index: 2;
                }

                .progress-steps .step span {
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    background: #ddd;
                    color: #fff;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin-bottom: 5px;
                    font-weight: bold;
                }

                .progress-steps .step p {
                    font-size: 12px;
                    color: #777;
                    margin: 0;
                    text-align: center;
                }

                .progress-steps .step.active span {
                    background: rgb(49, 215, 204);
                    ;
                }

                .progress-steps .step.active p {
                    color: rgb(49, 215, 204);
                    ;
                    font-weight: bold;
                }
            </style>

            <!-- [ Content Area ] end -->
        </div>
        <!-- [ Main Content ] end -->
        </div>
    </main>
    <!--! ================================================================ !-->
    <!--! [End] Main Content !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! BEGIN: Compose Mail Modal !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! END: Compose Mail Modal !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! [Start] Search Modal !-->
    <!--! ================================================================ !-->

    <style>
        main.nxl-container.apps-container.apps-email {
            margin-top: 0 !important;
            padding-top: 0 !important;
            position: relative;
            top: 0;
        }

        main.nxl-container.apps-container.apps-email {
            margin: 0 !important;
            padding: 0 !important;
            position: relative;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            /* Full viewport height */
            box-sizing: border-box;
        }

        .content-sidebar-header .btn-primary {
            background-color: #36d5d5 !important;
            border-color: #36d5d5 !important;
            color: white !important;
        }

        .content-sidebar-header .btn-primary:hover {
            background-color: #36d5d5 !important;
            /* darker teal */
            border-color: #36d5d5 !important;
        }
    </style>

    <style>
        .email-chip {
            display: flex;
            align-items: center;
            background-color: #e0e0e0;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            color: #333;
        }

        .email-chip .remove-btn {
            margin-left: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .email-chip .remove-btn:hover {
            color: red;
        }

        .email-chip .avatar {
            width: 22px;
            height: 22px;
            background-color: #9cc1f9;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
    </style>

    <!--! ================================================================ !-->
    <!--! [End] Theme Customizer !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! Footer Script !-->
    <!--! ================================================================ !-->
    <!--! BEGIN: Vendors JS !-->
    <script src="./../assets/vendors/js/vendors.min.js"></script>
    <!-- vendors.min.js {always must need to be top} -->
    <script src="./../assets/vendors/js/select2.min.js"></script>
    <script src="./../assets/vendors/js/select2-active.min.js"></script>
    <script src="./../assets/vendors/js/tagify.min.js"></script>
    <script src="./../assets/vendors/js/tagify-data.min.js"></script>
    <script src="./../assets/vendors/js/quill.min.js"></script>
    <!--! END: Vendors JS !-->
    <!--! BEGIN: Apps Init  !-->
    <script src="./../assets/js/common-init.min.js"></script>
    <script src="./../assets/js/apps-email-init.min.js"></script>
    <!--! END: Apps Init !-->
    <!--! BEGIN: Theme Customizer  !-->
    <script src="./../assets/js/theme-customizer-init.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!--! END: Theme Customizer !-->

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <!-- Flatpickr -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Bootstrap JS (optional) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        (function ($) {
            console.log('Register script loaded');

            const nameRegex = /^[A-Za-z\s]+$/;
            const phoneRegex = /^\d{10}$/;
            const pinRegex = /^\d{6}$/;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            let citiesData = [];

            $.getJSON('/cities.json')
                .done(function (data) {
                    console.log('cities.json loaded', data && data.length, 'records');
                    citiesData = data;
                    populateStatesFromData();
                    populateCitiesFromData();
                })
                .fail(function (jqxhr, status, error) {
                    console.log('Could not load /cities.json. Using sample fallback. Error:', status, error);
                    citiesData = [
                        { state: 'Karnataka', name: 'Bengaluru' },
                        { state: 'Karnataka', name: 'Mysuru' },
                        { state: 'Maharashtra', name: 'Mumbai' },
                        { state: 'Maharashtra', name: 'Pune' },
                        { state: 'Delhi', name: 'New Delhi' }
                    ];
                    populateStatesFromData();
                    populateCitiesFromData();
                });

            function populateStatesFromData() {
                const states = [...new Set(citiesData.map(i => i.state))].sort();
                const $state = $('#state');
                $state.empty().append('<option value="">Select State</option>');
                states.forEach(s => $state.append(`<option value="${s}">${s}</option>`));
            }

            function populateCitiesFromData() {
                const cities = [...new Set(citiesData.map(i => i.name))].sort();
                const $city = $('#city');
                $city.empty().append('<option value="">Select City</option>');
                cities.forEach(c => $city.append(`<option value="${c}">${c}</option>`));
            }

            if (typeof flatpickr === 'function') {
                try {
                    flatpickr('#dateOfBirth', {
                        dateFormat: 'Y-m-d',
                        maxDate: 'today',
                        allowInput: false,
                        onReady: function (sel) { console.log('flatpickr ready for #dateOfBirth'); }
                    });
                } catch (err) {
                    console.warn('flatpickr init failed:', err);
                    $('#dateOfBirth').attr('type', 'date').prop('readonly', false);
                }
            } else {
                console.warn('flatpickr not found â€” using native date input');
                $('#dateOfBirth').attr('type', 'date').prop('readonly', false);
            }

            $(document).on('click', '.toggle-password', function (e) {
                e.preventDefault();
                const $btn = $(this);
                const $input = $btn.closest('.input-group').find('input').first();
                if (!$input || $input.length === 0) return;
                const currentType = $input.attr('type');
                const newType = currentType === 'password' ? 'text' : 'password';
                $input.attr('type', newType);
                $btn.find('i').toggleClass('fa-eye fa-eye-slash');
            });

            $('#firstName, #lastName, #emergencyContactName').on('input', function () {
                const before = this.value;
                this.value = this.value.replace(/[^A-Za-z\s]/g, '');
                if (before !== this.value) $(this).addClass('is-invalid'); else $(this).removeClass('is-invalid');
            });

            $('#phoneNumber, #alternatePhoneNumber, #emergencyContactNumber, #pinCode').on('input', function () {
                const max = $(this).attr('maxlength') || 100;
                this.value = this.value.replace(/\D/g, '').slice(0, max);
            });

            function showFieldError(id, show, msg) {
                const $err = $('#' + id);
                if (show) {
                    $err.text(msg).show();
                } else {
                    $err.hide();
                }
            }

            function showSwalError(message) {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: message,
                    confirmButtonText: 'OK'
                });
            }

            $('#register-form').on('submit', function (e) {
                e.preventDefault();

                const firstName = $('#firstName').val()?.trim();
                const lastName = $('#lastName').val()?.trim();
                // const dateOfBirth = $('#dateOfBirth').val()?.trim();
                // const gender = $('#gender').val();
                const phoneNumber = $('#phoneNumber').val()?.trim();
                // const alternatePhoneNumber = $('#alternatePhoneNumber').val()?.trim();
                const email = $('#email').val()?.trim();
                // const residentialAddress = $('#residentialAddress').val()?.trim();
                // const emergencyContactName = $('#emergencyContactName').val()?.trim();
                // const emergencyContactNumber = $('#emergencyContactNumber').val()?.trim();
                // const city = $('#city').val();
                // const state = $('#state').val();
                // const pinCode = $('#pinCode').val()?.trim();
                const password = $('#password-field').val();
                const confirmPassword = $('#confirm-password-field').val();

                // const referralCode = $('#referralCode').val()?.trim();
                // const referralLink = $('#referralLink').val()?.trim();
                // const internshipModeId = 1;

                if (!firstName || !nameRegex.test(firstName)) return showSwalError('Valid First Name required.');
                if (!lastName || !nameRegex.test(lastName)) return showSwalError('Valid Last Name required.');
                // if (!dateOfBirth) return showSwalError('Date of Birth is required.');
                // if (!gender) return showSwalError('Gender is required.');
                if (!phoneRegex.test(phoneNumber)) return showSwalError('Primary Phone must be 10 digits.');
                // if (alternatePhoneNumber && !phoneRegex.test(alternatePhoneNumber)) return showSwalError('Alternate Phone must be 10 digits.');
                if (!emailRegex.test(email)) return showSwalError('Valid Email required.');
                // if (!residentialAddress || residentialAddress.length < 5) return showSwalError('Address must be at least 5 characters.');
                // if (!emergencyContactName || !nameRegex.test(emergencyContactName)) return showSwalError('Valid Emergency Contact Name required.');
                // if (!phoneRegex.test(emergencyContactNumber)) return showSwalError('Emergency Contact Number must be 10 digits.');
                // if (!state) return showSwalError('State is required.');
                // if (!city) return showSwalError('City is required.');
                // if (!pinRegex.test(pinCode)) return showSwalError('Pin Code must be 6 digits.');
                if (!password) return showSwalError('Password is required.');
                if (password !== confirmPassword) return showSwalError('Passwords do not match.');

                // if (referralCode && !/^[a-zA-Z0-9]+$/.test(referralCode)) return showSwalError('Referral Code must be alphanumeric.');
                // if (referralLink && !/^https?:\/\/.+$/.test(referralLink)) return showSwalError('Referral Link must be valid (http/https).');

                const personalPayload = {
                    firstName, lastName,
                    phoneNumber, email, password
                };

                Swal.fire({
                    title: "Confirm Submission",
                    text: "Please check all your details before submitting!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonText: "Yes, Submit",
                    cancelButtonText: "Cancel",
                    reverseButtons: true
                }).then((result) => {
                    if (!result.isConfirmed) return;

                    Swal.fire({
                        title: "Processing...",
                        text: "Registering your account...",
                        allowOutsideClick: false,
                        didOpen: () => Swal.showLoading()
                    });

                    $.ajax({
                        url: "https://eduroom.in/api/v1/user/personal-info",
                        method: "POST",
                        contentType: "application/json",
                        data: JSON.stringify(personalPayload),
                        success: function (res) {
                            const userId = res.userId;
                            sessionStorage.setItem("userId", userId);

                            Swal.fire("Success", "Registration done successfully, Please login to proceed.", "success")
                                .then(() => window.top.location.href = "/login.html");

                            // const referralPayload = { referralCode, referralLink, internshipModeId };
                            // console.log("payload for put call:", referralPayload);

                            // $.ajax({
                            //     url: `https://eduroom.in/api/v1/user/${userId}/internship-details`,
                            //     method: "PUT",
                            //     contentType: "application/json",
                            //     data: JSON.stringify(referralPayload),
                            //     success: function () {
                            //         Swal.fire("Success", "Registration done successfully, Please login to proceed.", "success")
                            //             .then(() => window.top.location.href = "/login.html");
                            //     },
                            //     error: function (xhr) {
                            //         Swal.fire("Error", xhr.responseJSON?.message || "Something went wrong while saving registering, please try again later.", "error");
                            //     }
                            // });
                        },
                        error: function (xhr) {
                            Swal.fire("Error", xhr.responseJSON?.message || "Something went wrong while registering.", "error");
                        }
                    });
                });
            });

        })(jQuery);
    </script>

    <script>
        $(document).ready(function () {
            let GOOGLE_DEFAULT_PASSWORD = "";

            // Load config.json to fetch the password
            $.getJSON("/config.json", function (config) {
                GOOGLE_DEFAULT_PASSWORD = config.GOOGLE_DEFAULT_PASSWORD;
            });

            $('#google-login-btn').on('click', function () {
                Swal.fire({
                    title: 'Signing up with Google...',
                    allowOutsideClick: false,
                    didOpen: () => Swal.showLoading()
                });

                auth.signInWithPopup(provider)
                    .then(result => {
                        Swal.close();
                        const user = result.user;
                        let email = user.email || '';
                        const password = GOOGLE_DEFAULT_PASSWORD;

                        if (!email || !email.endsWith("@gmail.com")) {
                            throw new Error("Only Gmail accounts are allowed!");
                        }

                        // One SweetAlert with multiple inputs
                        return Swal.fire({
                            title: "Complete Your Details",
                            html: `
                                <div style="text-align:center; margin-bottom:15px;">
                                    <h3 style="margin:0; font-size:18px; font-weight:600; color:#333;">
                                        Just a few steps to go ðŸš€
                                    </h3>
                                    <p style="font-size:13px; color:#666; margin:5px 0 0;">
                                        Please provide accurate details to proceed smoothly.
                                    </p>
                                </div>

                                <div style="text-align:left; font-size:14px; margin-top:10px;">
                                    <label for="swal-firstname" style="font-weight:600;">First Name:</label>
                                    <input id="swal-firstname" class="swal2-input" style="margin-bottom:15px;" 
                                        placeholder="Enter first name"
                                        oninput="this.value = this.value.replace(/[^a-zA-Z]/g, '')">

                                    <label for="swal-lastname" style="font-weight:600;">Last Name:</label>
                                    <input id="swal-lastname" class="swal2-input" style="margin-bottom:15px;" 
                                        placeholder="Enter last name"
                                        oninput="this.value = this.value.replace(/[^a-zA-Z]/g, '')">

                                    <label for="swal-phone" style="font-weight:600;">Phone Number:</label>
                                    <input id="swal-phone" class="swal2-input" style="margin-bottom:5px;" 
                                        placeholder="10 digit phone number" maxlength="10"
                                        oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                                    <small style="font-size:12px; color:#666;">Example: 9999999999</small>
                                </div>

                                <div style="margin-top:15px; text-align:center; font-size:12px; color:red;">
                                    <strong>(Note: Please Enter the Phone Number you are registered with FundsAudit App.)</strong>
                                </div>
                            `,
                            focusConfirm: false,
                            showCancelButton: true,
                            confirmButtonText: "<i class='fa fa-check'></i> Submit",
                            cancelButtonText: "Cancel",
                            confirmButtonColor: "#3085d6",
                            cancelButtonColor: "#d33",
                            customClass: {
                                popup: "swal2-rounded",
                                confirmButton: "px-4 py-2 fw-bold",
                                cancelButton: "px-4 py-2"
                            },
                            preConfirm: () => {
                                const firstName = document.getElementById("swal-firstname").value.trim();
                                const lastName = document.getElementById("swal-lastname").value.trim();
                                const phoneNumber = document.getElementById("swal-phone").value.trim();

                                if (!firstName) return Swal.showValidationMessage("âš ï¸ First name is required!");
                                if (!lastName) return Swal.showValidationMessage("âš ï¸ Last name is required!");
                                if (!/^[0-9]{10}$/.test(phoneNumber)) {
                                    return Swal.showValidationMessage("âš ï¸ Enter a valid 10-digit phone number!");
                                }

                                return { firstName, lastName, phoneNumber };
                            }
                        }).then(res => {
                            if (!res.isConfirmed) throw new Error("User cancelled input");

                            const googlePayload = {
                                firstName: res.value.firstName,
                                lastName: res.value.lastName,
                                email,
                                phoneNumber: res.value.phoneNumber,
                                password
                            };

                            console.log("Final Google Register Payload:", googlePayload);

                            Swal.fire({
                                title: "Registering...",
                                text: "Creating your account...",
                                allowOutsideClick: false,
                                didOpen: () => Swal.showLoading()
                            });

                            return $.ajax({
                                url: "https://eduroom.in/api/v1/user/personal-info",
                                type: "POST",
                                contentType: "application/json",
                                data: JSON.stringify(googlePayload)
                            });
                        });
                    })
                    .then(registerResponse => {
                        const userId = registerResponse.userId;
                        sessionStorage.setItem("user_id", userId);

                        Swal.close();
                        Swal.fire({
                            icon: "success",
                            title: "Registration Successful",
                            text: "Redirecting to your profile...",
                            timer: 2000,
                            showConfirmButton: false
                        }).then(() => {
                            window.top.location.href = "/profile.html";
                        });
                    })
                    .catch(error => {
                        Swal.close();

                        if (error.status === 409 || (error.responseJSON && error.responseJSON.message === "User already exists")) {
                            Swal.fire({
                                title: 'User already registered. Logging in...',
                                allowOutsideClick: false,
                                didOpen: () => Swal.showLoading()
                            });

                            auth.signInWithPopup(provider)
                                .then(result => result.user.getIdToken())
                                .then(idToken => {
                                    return $.ajax({
                                        url: "https://eduroom.in/api/v1/user/google-login",
                                        type: "POST",
                                        contentType: "application/json",
                                        data: JSON.stringify({ idToken: idToken })
                                    });
                                })
                                .then(response => {
                                    let userId = null;
                                    let redirectUrl = "/profile.html";

                                    if (response.account && response.account.managerId) {
                                        userId = response.account.managerId;
                                        redirectUrl = "/profile/dashboard/index.html";
                                    } else if (response.user && response.user.user_id) {
                                        userId = response.user.user_id;
                                    }

                                    if (userId) sessionStorage.setItem("user_id", userId);

                                    Swal.close();
                                    Swal.fire({
                                        icon: "success",
                                        title: "Login Successful",
                                        text: "Redirecting...",
                                        timer: 2000,
                                        showConfirmButton: false
                                    }).then(() => window.top.location.href = redirectUrl);
                                })
                                .catch(err => {
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Google Login Failed',
                                        text: err.responseJSON?.message || err.message
                                    });
                                });

                        } else if (error.message && (error.message.includes("cancelled"))) {
                            Swal.fire({
                                icon: "info",
                                title: "Registration Cancelled",
                                text: "You must provide all details to register."
                            });
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'Google Registration Failed',
                                text: error.responseJSON?.message || error.message
                            });
                        }
                    });
            });
        });
    </script>

</body>

</html>