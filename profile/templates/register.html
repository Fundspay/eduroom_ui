<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="./../assets/css/bootstrap.min.css">
    <!--! END: Bootstrap CSS-->
    <!--! BEGIN: Vendors CSS-->
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/vendors.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/select2.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/select2-theme.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/tagify.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/tagify-data.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/quill.min.css">
    <!--! END: Vendors CSS-->
    <!--! BEGIN: Custom CSS-->
    <link rel="stylesheet" type="text/css" href="./../assets/css/theme.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!--! END: Custom CSS-->
    <!--! HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries !-->
    <!--! WARNING: Respond.js doesn"t work if you view the page via file: !-->
    <!--[if lt IE 9]>
			<script src="https:oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https:oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
</head>

<body>
    <!--! ================================================================ !-->
    <!--! [Start] Main Content !-->
    <!--! ================================================================ !-->
    <main class="nxl-container apps-container apps-email bg-white">
        <div class="nxl-content without-header nxl-full-content">
            <!-- [ Main Content ] start -->
            <div class="row">
                <!-- First container (main card) -->

                <div class="main-content" style="margin-bottom: 5%;">
                    <div class="row justify-content-center">
                        <div class="col-xl-10">
                            <div class="card stretch stretch-full shadow-sm">
                                <div class="card-body">
                                    <form id="register-form">
                                        <h4 class="mb-4" style="color:rgb(49, 215, 204);">Create Your EDUROOM Account
                                        </h4>

                                        <div class="tp-register-progress mb-40">
                                            <div class="progress-steps">
                                                <div class="step active" data-step="1">
                                                    <span>1</span>
                                                    <p>Personal Info</p>
                                                </div>
                                                <div class="step" data-step="2">
                                                    <span>2</span>
                                                    <p>Educational Details</p>
                                                </div>
                                                <div class="step" data-step="3">
                                                    <span>3</span>
                                                    <p>Internship Details</p>
                                                </div>
                                                <div class="step" data-step="4">
                                                    <span>4</span>
                                                    <p>Identification & Verification</p>
                                                </div>
                                                <div class="step" data-step="5">
                                                    <span>5</span>
                                                    <p>Bank Details</p>
                                                </div>
                                                <div class="step" data-step="5">
                                                    <span>6</span>
                                                    <p>Communication Preferences</p>
                                                </div>
                                                <div class="step" data-step="5">
                                                    <span>7</span>
                                                    <p>Declaration & Consent</p>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- First / Last Name -->
                                        <div class="row" style="margin-top: 2%;">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">First Name <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="firstName" class="form-control"
                                                    placeholder="Enter First Name">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Last Name <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="lastName" class="form-control"
                                                    placeholder="Enter Last Name">
                                            </div>
                                        </div>

                                        <!-- DOB & Gender -->
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Date of Birth <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="dateOfBirth" class="form-control"
                                                    placeholder="YYYY-MM-DD">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Gender <span
                                                        class="text-danger">*</span></label>
                                                <select class="form-control" id="gender" data-select2-selector="icon">
                                                    <option value="">Select Gender</option>
                                                    <option value="1">Male</option>
                                                    <option value="2">Female</option>
                                                    <option value="3">Other</option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- Phone Numbers -->
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Phone Number <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="phoneNumber" class="form-control"
                                                    placeholder="10-digit number" maxlength="10">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Alternate Phone Number</label>
                                                <input type="text" id="alternatePhoneNumber" class="form-control"
                                                    placeholder="10-digit number" maxlength="10">
                                            </div>
                                        </div>

                                        <!-- Email -->
                                        <div class="mb-3">
                                            <label class="form-label">Email <span class="text-danger">*</span></label>
                                            <input type="email" id="email" class="form-control"
                                                placeholder="Enter Email Address">
                                        </div>

                                        <!-- Address -->
                                        <div class="mb-3">
                                            <label class="form-label">Residential Address <span
                                                    class="text-danger">*</span></label>
                                            <textarea id="residentialAddress" class="form-control" rows="2"
                                                placeholder="Enter your address"></textarea>
                                        </div>

                                        <!-- Emergency Contact -->
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Emergency Contact Name <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="emergencyContactName" class="form-control"
                                                    placeholder="Enter Contact Name">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Emergency Contact Number <span
                                                        class="text-danger">*</span></label>
                                                <input type="text" id="emergencyContactNumber" class="form-control"
                                                    placeholder="10-digit number" maxlength="10">
                                            </div>
                                        </div>

                                        <!-- State & City -->
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">State <span
                                                        class="text-danger">*</span></label>
                                                <select class="form-control" id="state" data-select2-selector="icon">
                                                    <option value="">Select State</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">City <span
                                                        class="text-danger">*</span></label>
                                                <select class="form-control" id="city" data-select2-selector="icon">
                                                    <option value="">Select City</option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- Pin Code -->
                                        <div class="mb-3">
                                            <label class="form-label">Pin Code <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" id="pinCode" class="form-control"
                                                placeholder="Enter Pin Code" maxlength="6">
                                        </div>

                                        <!-- Password -->
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Password <span
                                                        class="text-danger">*</span></label>
                                                <div class="input-group">
                                                    <input type="password" id="password-field" class="form-control"
                                                        placeholder="Enter Password">
                                                    <button class="btn btn-outline-secondary toggle-password"
                                                        type="button">
                                                        <i class="fa fa-eye"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Confirm Password <span
                                                        class="text-danger">*</span></label>
                                                <div class="input-group">
                                                    <input type="password" id="confirm-password-field"
                                                        class="form-control" placeholder="Re-enter Password">
                                                    <button class="btn btn-outline-secondary toggle-password"
                                                        type="button">
                                                        <i class="fa fa-eye"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Submit -->
                                        <div class="d-flex justify-content-end mt-3">
                                            <button type="submit" class="btn px-4"
                                                style="background-color: #36d5d5; color: #fff;">
                                                Next
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <style>
                .progress-steps {
                    display: flex;
                    justify-content: space-between;
                    position: relative;
                }

                .progress-steps::before {
                    content: '';
                    position: absolute;
                    top: 15px;
                    left: 0;
                    right: 0;
                    height: 2px;
                    background: #ddd;
                    z-index: 1;
                }

                .progress-steps .step {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    position: relative;
                    z-index: 2;
                }

                .progress-steps .step span {
                    width: 30px;
                    height: 30px;
                    border-radius: 50%;
                    background: #ddd;
                    color: #fff;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin-bottom: 5px;
                    font-weight: bold;
                }

                .progress-steps .step p {
                    font-size: 12px;
                    color: #777;
                    margin: 0;
                    text-align: center;
                }

                .progress-steps .step.active span {
                    background: rgb(49, 215, 204);
                    ;
                }

                .progress-steps .step.active p {
                    color: rgb(49, 215, 204);
                    ;
                    font-weight: bold;
                }
            </style>

            <!-- [ Content Area ] end -->
        </div>
        <!-- [ Main Content ] end -->
        </div>
    </main>
    <!--! ================================================================ !-->
    <!--! [End] Main Content !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! BEGIN: Compose Mail Modal !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! END: Compose Mail Modal !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! [Start] Search Modal !-->
    <!--! ================================================================ !-->

    <style>
        main.nxl-container.apps-container.apps-email {
            margin-top: 0 !important;
            padding-top: 0 !important;
            position: relative;
            top: 0;
        }

        main.nxl-container.apps-container.apps-email {
            margin: 0 !important;
            padding: 0 !important;
            position: relative;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            /* Full viewport height */
            box-sizing: border-box;
        }

        .content-sidebar-header .btn-primary {
            background-color: #36d5d5 !important;
            border-color: #36d5d5 !important;
            color: white !important;
        }

        .content-sidebar-header .btn-primary:hover {
            background-color: #36d5d5 !important;
            /* darker teal */
            border-color: #36d5d5 !important;
        }
    </style>

    <style>
        .email-chip {
            display: flex;
            align-items: center;
            background-color: #e0e0e0;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            color: #333;
        }

        .email-chip .remove-btn {
            margin-left: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .email-chip .remove-btn:hover {
            color: red;
        }

        .email-chip .avatar {
            width: 22px;
            height: 22px;
            background-color: #9cc1f9;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
    </style>

    <!--! ================================================================ !-->
    <!--! [End] Theme Customizer !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! Footer Script !-->
    <!--! ================================================================ !-->
    <!--! BEGIN: Vendors JS !-->
    <script src="./../assets/vendors/js/vendors.min.js"></script>
    <!-- vendors.min.js {always must need to be top} -->
    <script src="./../assets/vendors/js/select2.min.js"></script>
    <script src="./../assets/vendors/js/select2-active.min.js"></script>
    <script src="./../assets/vendors/js/tagify.min.js"></script>
    <script src="./../assets/vendors/js/tagify-data.min.js"></script>
    <script src="./../assets/vendors/js/quill.min.js"></script>
    <!--! END: Vendors JS !-->
    <!--! BEGIN: Apps Init  !-->
    <script src="./../assets/js/common-init.min.js"></script>
    <script src="./../assets/js/apps-email-init.min.js"></script>
    <!--! END: Apps Init !-->
    <!--! BEGIN: Theme Customizer  !-->
    <script src="./../assets/js/theme-customizer-init.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!--! END: Theme Customizer !-->

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <!-- Flatpickr -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Bootstrap JS (optional) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        (function ($) {
            console.log('Register script loaded');

            const nameRegex = /^[A-Za-z\s]+$/;
            const phoneRegex = /^\d{10}$/;
            const pinRegex = /^\d{6}$/;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            let citiesData = [];

            $.getJSON('/cities.json')
                .done(function (data) {
                    console.log('cities.json loaded', data && data.length, 'records');
                    citiesData = data;
                    populateStatesFromData();
                    populateCitiesFromData();
                })
                .fail(function (jqxhr, status, error) {
                    console.log('Could not load /cities.json. Using sample fallback. Error:', status, error);
                    citiesData = [
                        { state: 'Karnataka', name: 'Bengaluru' },
                        { state: 'Karnataka', name: 'Mysuru' },
                        { state: 'Maharashtra', name: 'Mumbai' },
                        { state: 'Maharashtra', name: 'Pune' },
                        { state: 'Delhi', name: 'New Delhi' }
                    ];
                    populateStatesFromData();
                    populateCitiesFromData();
                });

            function populateStatesFromData() {
                const states = [...new Set(citiesData.map(i => i.state))].sort();
                const $state = $('#state');
                $state.empty().append('<option value="">Select State</option>');
                states.forEach(s => $state.append(`<option value="${s}">${s}</option>`));
            }

            function populateCitiesFromData() {
                const cities = [...new Set(citiesData.map(i => i.name))].sort();
                const $city = $('#city');
                $city.empty().append('<option value="">Select City</option>');
                cities.forEach(c => $city.append(`<option value="${c}">${c}</option>`));
            }

            if (typeof flatpickr === 'function') {
                try {
                    flatpickr('#dateOfBirth', {
                        dateFormat: 'Y-m-d',
                        maxDate: 'today',
                        allowInput: false,
                        onReady: function (sel) { console.log('flatpickr ready for #dateOfBirth'); }
                    });
                } catch (err) {
                    console.warn('flatpickr init failed:', err);
                    $('#dateOfBirth').attr('type', 'date').prop('readonly', false);
                }
            } else {
                console.warn('flatpickr not found — using native date input');
                $('#dateOfBirth').attr('type', 'date').prop('readonly', false);
            }

            $(document).on('click', '.toggle-password', function (e) {
                e.preventDefault();
                const $btn = $(this);
                const $input = $btn.closest('.input-group').find('input').first();
                if (!$input || $input.length === 0) return;
                const currentType = $input.attr('type');
                const newType = currentType === 'password' ? 'text' : 'password';
                $input.attr('type', newType);
                $btn.find('i').toggleClass('fa-eye fa-eye-slash');
            });

            $('#firstName, #lastName, #emergencyContactName').on('input', function () {
                const before = this.value;
                this.value = this.value.replace(/[^A-Za-z\s]/g, '');
                if (before !== this.value) $(this).addClass('is-invalid'); else $(this).removeClass('is-invalid');
            });

            $('#phoneNumber, #alternatePhoneNumber, #emergencyContactNumber, #pinCode').on('input', function () {
                const max = $(this).attr('maxlength') || 100;
                this.value = this.value.replace(/\D/g, '').slice(0, max);
            });

            function showFieldError(id, show, msg) {
                const $err = $('#' + id);
                if (show) {
                    $err.text(msg).show();
                } else {
                    $err.hide();
                }
            }

            $('#register-form').on('submit', function (e) {
                e.preventDefault();

                const firstName = $('#firstName').val().trim();
                const lastName = $('#lastName').val().trim();
                const dateOfBirth = $('#dateOfBirth').val().trim();
                const gender = $('#gender').val();
                const phone = $('#phoneNumber').val().trim();
                const altPhone = $('#alternatePhoneNumber').val().trim();
                const email = $('#email').val().trim();
                const residentialAddress = $('#residentialAddress').val().trim();
                const emergencyContactName = $('#emergencyContactName').val().trim();
                const emergencyContactNumber = $('#emergencyContactNumber').val().trim();
                const city = $('#city').val();
                const state = $('#state').val();
                const pinCode = $('#pinCode').val().trim();
                const password = $('#password-field').val();
                const confirmPassword = $('#confirm-password-field').val();

                $('.field-error').hide();

                if (!firstName || !nameRegex.test(firstName)) { showFieldError('err-firstName', true, 'Valid First Name required (letters & spaces).'); return Swal.fire('Error', 'Valid First Name required (letters & spaces).', 'error'); }
                if (!lastName || !nameRegex.test(lastName)) { showFieldError('err-lastName', true, 'Valid Last Name required (letters & spaces).'); return Swal.fire('Error', 'Valid Last Name required (letters & spaces).', 'error'); }
                if (!dateOfBirth) { showFieldError('err-dob', true, 'Date of Birth required.'); return Swal.fire('Error', 'Date of Birth is required.', 'error'); }
                if (!gender) { showFieldError('err-gender', true, 'Select a gender.'); return Swal.fire('Error', 'Gender is required.', 'error'); }
                if (!phoneRegex.test(phone)) { showFieldError('err-phone', true, 'Phone must be 10 digits.'); return Swal.fire('Error', 'Primary phone must be 10 digits.', 'error'); }
                if (altPhone && !phoneRegex.test(altPhone)) { showFieldError('err-altphone', true, 'Alternate phone must be 10 digits.'); return Swal.fire('Error', 'Alternate phone must be 10 digits.', 'error'); }
                if (!emailRegex.test(email)) { showFieldError('err-email', true, 'Enter a valid email.'); return Swal.fire('Error', 'Enter a valid email address.', 'error'); }
                if (!residentialAddress || residentialAddress.length < 5) { showFieldError('err-address', true, 'Address must be at least 5 chars.'); return Swal.fire('Error', 'Address must be at least 5 characters.', 'error'); }
                if (!emergencyContactName || !nameRegex.test(emergencyContactName)) { showFieldError('err-emerName', true, 'Valid emergency name required.'); return Swal.fire('Error', 'Valid Emergency Contact Name required.', 'error'); }
                if (!phoneRegex.test(emergencyContactNumber)) { showFieldError('err-emerPhone', true, 'Emergency contact must be 10 digits.'); return Swal.fire('Error', 'Emergency Contact Number must be 10 digits.', 'error'); }
                if (!state) { showFieldError('err-state', true, 'Select a state.'); return Swal.fire('Error', 'State is required.', 'error'); }
                if (!city) { showFieldError('err-city', true, 'Select a city.'); return Swal.fire('Error', 'City is required.', 'error'); }
                if (!pinRegex.test(pinCode)) { showFieldError('err-pin', true, 'Pin code must be 6 digits.'); return Swal.fire('Error', 'Pin Code must be 6 digits.', 'error'); }
                if (!password) { showFieldError('err-pass', true, 'Password required.'); return Swal.fire('Error', 'Password is required.', 'error'); }
                if (password !== confirmPassword) { showFieldError('err-pass', true, 'Passwords do not match.'); return Swal.fire('Error', 'Passwords do not match.', 'error'); }

                const payload = {
                    firstName, lastName, dateOfBirth, gender,
                    phoneNumber: phone, alternatePhoneNumber: altPhone,
                    email, residentialAddress,
                    emergencyContactName, emergencyContactNumber,
                    city, state, pinCode, password
                };

                Swal.fire({
                    title: "Confirm Submission",
                    text: "Please check your details carefully. Once submitted, changes cannot be made again.",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonText: "Yes, Confirm",
                    cancelButtonText: "Cancel",
                    reverseButtons: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        Swal.fire({
                            title: "Processing...",
                            text: "Please wait while we save your details.",
                            allowOutsideClick: false,
                            didOpen: () => Swal.showLoading()
                        });

                        $.ajax({
                            url: "https://eduroom.in/api/v1/user/personal-info",
                            method: "POST",
                            contentType: "application/json",
                            data: JSON.stringify(payload),
                            success: function (res) {
                                sessionStorage.setItem("userId", res.userId || '');
                                Swal.fire("Success", "Details saved successfully!", "success").then(() => {
                                    window.top.location.href = "/register2.html";
                                });
                            },
                            error: function (xhr) {
                                console.error('Submit error', xhr);
                                const msg = xhr.responseJSON?.message || (xhr.responseText ? xhr.responseText : 'Something went wrong.');
                                Swal.fire("Error", msg, "error");
                            }
                        });
                    }
                });
            });

            console.log('Ready: elements present ->', {
                dateOfBirth_exists: !!$('#dateOfBirth').length,
                toggle_buttons: $('.toggle-password').length,
                state_select: $('#state').length
            });

        })(jQuery);
    </script>

</body>

</html>