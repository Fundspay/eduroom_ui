<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="keyword" content="" />
    <meta name="author" content="" />
    <!--! The above 6 meta tags *must* come first in the head; any other head content must come *after* these tags !-->
    <!--! BEGIN: Apps Title-->
    <title>Eduroom || Dashboard</title>
    <!--! END:  Apps Title-->
    <!--! BEGIN: Favicon-->
    <link rel="shortcut icon" type="image/x-icon" href="/assets/images/FundsAuditLogo.png" />
    <!--! END: Favicon-->
    <!--! BEGIN: Bootstrap CSS-->
    <link rel="stylesheet" type="text/css" href="./../assets/css/bootstrap.min.css" />
    <!--! END: Bootstrap CSS-->
    <!--! BEGIN: Vendors CSS-->
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/vendors.min.css" />
    <link rel="stylesheet" type="text/css" href="./../assets/css/theme.min.css">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/tagify.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/tagify-data.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/quill.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/select2.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/select2-theme.min.css">
    <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/daterangepicker.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!--! END: Vendors CSS-->
    <!--! BEGIN: Custom CSS-->
    <link rel="stylesheet" type="text/css" href="./../assets/css/theme.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>


    <script>
        function setStickyColumns() {
            const table = document.getElementById("leadsTable");
            if (!table) return;

            const stickyCols = 3;
            let leftOffsets = [];

            let total = 0;
            const firstRow = table.querySelector("thead tr:first-child");
            for (let i = 0; i < stickyCols; i++) {
                const th = firstRow.querySelector(`th:nth-child(${i + 1})`);
                if (th) {
                    leftOffsets[i] = total;
                    total += th.offsetWidth;
                }
            }

            requestAnimationFrame(() => {
                const headerRows = table.querySelectorAll("thead tr");
                let cumulativeTop = 0;

                headerRows.forEach(row => {
                    const rowHeight = row.offsetHeight;

                    row.querySelectorAll("th").forEach(th => {
                        th.style.position = "sticky";
                        th.style.top = cumulativeTop + "px";
                        th.style.background = "#fff";
                        th.style.zIndex = 12;
                    });

                    for (let i = 0; i < stickyCols; i++) {
                        const th = row.querySelector(`th:nth-child(${i + 1})`);
                        if (th) {
                            th.style.left = leftOffsets[i] + "px";
                            th.style.zIndex = 16;
                        }
                    }

                    cumulativeTop += rowHeight;
                });

                const rows = table.querySelectorAll("tbody tr");
                rows.forEach(row => {
                    for (let i = 0; i < stickyCols; i++) {
                        const td = row.querySelector(`td:nth-child(${i + 1})`);
                        if (td) {
                            td.style.position = "sticky";
                            td.style.left = leftOffsets[i] + "px";
                            td.style.background = "#fff";
                            td.style.zIndex = 6;
                        }
                    }
                });
            });
        }

        window.addEventListener("load", setStickyColumns);
        window.addEventListener("resize", setStickyColumns);
    </script>

    <script>
        function setStickyColumns2() {
            const table = document.getElementById("leadsTable2");
            if (!table) return;

            const stickyCols = 3;
            let leftOffsets = [];

            let total = 0;
            const firstRow = table.querySelector("thead tr:first-child");
            for (let i = 0; i < stickyCols; i++) {
                const th = firstRow.querySelector(`th:nth-child(${i + 1})`);
                if (th) {
                    leftOffsets[i] = total;
                    total += th.offsetWidth;
                }
            }

            requestAnimationFrame(() => {
                const headerRows = table.querySelectorAll("thead tr");
                let cumulativeTop = 0;

                headerRows.forEach(row => {
                    const rowHeight = row.offsetHeight;

                    row.querySelectorAll("th").forEach(th => {
                        th.style.position = "sticky";
                        th.style.top = cumulativeTop + "px";
                        th.style.background = "#fff";
                        th.style.zIndex = 12;
                    });

                    for (let i = 0; i < stickyCols; i++) {
                        const th = row.querySelector(`th:nth-child(${i + 1})`);
                        if (th) {
                            th.style.left = leftOffsets[i] + "px";
                            th.style.zIndex = 16;
                        }
                    }

                    cumulativeTop += rowHeight;
                });

                const rows = table.querySelectorAll("tbody tr");
                rows.forEach(row => {
                    for (let i = 0; i < stickyCols; i++) {
                        const td = row.querySelector(`td:nth-child(${i + 1})`);
                        if (td) {
                            td.style.position = "sticky";
                            td.style.left = leftOffsets[i] + "px";
                            td.style.background = "#fff";
                            td.style.zIndex = 6;
                        }
                    }
                });
            });
        }

        window.addEventListener("load", setStickyColumns2);
        window.addEventListener("resize", setStickyColumns2);
    </script>
    <!--! END: Custom CSS-->
    <!--! HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries !-->
    <!--! WARNING: Respond.js doesn"t work if you view the page via file: !-->
    <!--[if lt IE 9]>
			<script src="https:oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https:oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
</head>

<body>
    <!--! ================================================================ !-->
    <!--! [Start] Navigation Manu !-->
    <!--! ================================================================ !-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <nav class="nxl-navigation">
        <div class="navbar-wrapper">
            <div class="m-header">
                <a href="#" class="b-brand">
                    <img src="/images/favicon.svg" alt="" class="logo logo-lg" />
                    <img src="/images/favicon.svg" alt="" class="logo logo-sm" />
                </a>
            </div>

            <div class="navbar-content">
                <ul class="nxl-navbar">
                    <li class="nxl-item nxl-caption">
                        <label>Navigation</label>
                    </li>

                    <!-- PASSWORD PROTECTED DROPDOWN -->
                    <li class="nxl-item nxl-hasmenu" id="protectedDropdown">
                        <a href="javascript:void(0);" class="nxl-link protected-menu-trigger" id="protectedTrigger">
                            <span class="nxl-micon"><i class="feather-upload"></i></span>
                            <span class="nxl-mtext">CMS</span>
                            <span class="nxl-arrow"><i class="feather-chevron-right"></i></span>
                        </a>

                        <!-- hidden by default -->
                        <ul class="nxl-submenu protected-submenu" style="display: none;">
                            <li class="nxl-item"><a class="nxl-link"
                                    href="/profile/dashboard/add-selection-domain.html">ADD SELECTION DOMAIN</a></li>
                            <li class="nxl-item"><a class="nxl-link"
                                    href="/profile/dashboard/update-selection-domain.html">UPDATE SELECTION DOMAIN</a>
                            </li>
                            <li class="nxl-item"><a class="nxl-link"
                                    href="/profile/dashboard/add-selection-questions.html">ADD SELECTION QUESTIONS</a>
                            </li>
                            <li class="nxl-item"><a class="nxl-link"
                                    href="/profile/dashboard/update-selection-questions.html">UPDATE SELECTION
                                    QUESTIONS</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/index.html">ADD DOMAIN</a>
                            </li>
                            <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/add-course.html">ADD
                                    COURSE</a></li>
                            <li class="nxl-item"><a class="nxl-link"
                                    href="/profile/dashboard/add-course-preview.html">ADD COURSE PREVIEW</a></li>
                            <li class="nxl-item"><a class="nxl-link"
                                    href="/profile/dashboard/add-course-details.html">ADD COURSE DETAILS</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/update-domain.html">UPDATE
                                    DOMAIN</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/update-course.html">UPDATE
                                    COURSE</a></li>
                            <li class="nxl-item"><a class="nxl-link"
                                    href="/profile/dashboard/update-course-preview.html">UPDATE COURSE PREVIEW</a></li>
                            <li class="nxl-item"><a class="nxl-link"
                                    href="/profile/dashboard/update-course-details.html">UPDATE COURSE DETAILS</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/bd-incentives.html">BD
                                    INCENTIVES</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/hr-targets-admin.html">HR
                                    TARGETS ADMIN</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/bd-targets-admin.html">BD
                                    TARGETS ADMIN</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/hr-master-sheet.html">HR
                                    MASTER SHEET</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/bd-master-sheet.html">BD
                                    MASTER SHEET</a>
                        </ul>
                    </li>

                    <!-- OTHER MENU ITEMS UNCHANGED -->
                    <li class="nxl-item nxl-hasmenu">
                        <a href="javascript:void(0);" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-user"></i></span>
                            <span class="nxl-mtext">HR </span>
                            <span class="nxl-arrow"><i class="feather-chevron-right"></i></span>
                        </a>

                        <ul class="nxl-submenu">
                            <li class="nxl-item">
                                <a class="nxl-link" id="hrTargetsBtn" href="javascript:void(0);">HR TARGETS</a>
                            </li>
                            <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/CO.html">CO SHEET</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/RE.html">RE SHEET</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/R.html">RISA SHEET</a>
                            </li>
                        </ul>
                    </li>

                    <li class="nxl-item nxl-hasmenu">
                        <a href="javascript:void(0);" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-briefcase"></i></span>
                            <span class="nxl-mtext">BD </span>
                            <span class="nxl-arrow"><i class="feather-chevron-right"></i></span>
                        </a>

                        <ul class="nxl-submenu">
                            <li class="nxl-item">
                                <a class="nxl-link" id="bdTargetsBtn" href="javascript:void(0);">BD TARGETS</a>
                            </li>
                            <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/BD.html">BD SHEET</a></li>
                        </ul>
                    </li>

                    <li class="nxl-item">
                        <a href="/profile/dashboard/team-manager.html" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-airplay"></i></span>
                            <span class="nxl-mtext">MASTER SHEET</span>
                            <span class="nxl-arrow"><i class="feather-chevron-right"></i></span>
                        </a>
                    </li>

                    <li class="nxl-item">
                        <a href="/profile/dashboard/team-manager-college.html" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-file-text"></i></span>
                            <span class="nxl-mtext">COLLEGE SHEET</span>
                            <span class="nxl-arrow"><i class="feather-chevron-right"></i></span>
                        </a>
                    </li>

                    <li class="nxl-item">
                        <a href="javascript:void(0);" id="logoutBtn" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-log-out"></i></span>
                            <span class="nxl-mtext">Logout</span>
                            <span class="nxl-arrow"><i class="feather-chevron-right"></i></span>
                        </a>
                    </li>
                </ul>
                <div class="card text-center">
                    <div class="card-body">
                        <i class="feather-briefcase fs-4 text-dark"></i>
                        <h6 class="mt-4 text-dark fw-bolder">Welcome to FundsRoom</h6>
                        <p class="fs-11 my-3 text-dark">
                            FundsRoom is your trusted financial partner, offering seamless solutions for managing
                            investments, loans, and business funds with ease.
                        </p>
                        <!-- <a href="https://www.fundsroom.com/" class="btn btn-primary text-dark w-100" style="margin-bottom: 10%;">Fundsroom</a>
                        <a href="https://play.google.com/store/apps/details?id=com.fundsroom.fundsaudit&hl=en_IN" class="btn btn-success text-light w-100">Download FundsAudit</a> -->
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!--! ================================================================ !-->
    <!--! [End]  Navigation Manu !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! [Start] Header !-->
    <!--! ================================================================ !-->
    <header class="nxl-header">
        <div class="header-wrapper">
            <!--! [Start] Header Left !-->
            <div class="header-left d-flex align-items-center gap-4">
                <!--! [Start] nxl-head-mobile-toggler !-->
                <a href="javascript:void(0);" class="nxl-head-mobile-toggler" id="mobile-collapse">
                    <div class="hamburger hamburger--arrowturn">
                        <div class="hamburger-box">
                            <div class="hamburger-inner"></div>
                        </div>
                    </div>
                </a>
                <!--! [Start] nxl-head-mobile-toggler !-->
                <!--! [Start] nxl-navigation-toggle !-->
                <div class="nxl-navigation-toggle">
                    <a href="javascript:void(0);" id="menu-mini-button">
                        <i class="feather-align-left"></i>
                    </a>
                    <a href="javascript:void(0);" id="menu-expend-button" style="display: none">
                        <i class="feather-arrow-right"></i>
                    </a>
                </div>
                <!--! [End] nxl-navigation-toggle !-->
                <!--! [Start] nxl-lavel-mega-menu-toggle !-->
                <!-- <div class="nxl-lavel-mega-menu-toggle d-flex d-lg-none">
                    <a href="javascript:void(0);" id="nxl-lavel-mega-menu-open">
                        <i class="feather-align-left"></i>
                    </a>
                </div> -->
                <!--! [End] nxl-lavel-mega-menu-toggle !-->
                <!--! [Start] nxl-lavel-mega-menu !-->
                <div class="nxl-drp-link nxl-lavel-mega-menu">
                    <div class="nxl-lavel-mega-menu-toggle d-flex d-lg-none">
                        <a href="javascript:void(0)" id="nxl-lavel-mega-menu-hide">
                            <i class="feather-arrow-left me-2"></i>
                            <span>Back</span>
                        </a>
                    </div>

                    <!--! [End] nxl-lavel-mega-menu-wrapper !-->
                </div>
                <!--! [End] nxl-lavel-mega-menu !-->
            </div>
            <!--! [End] Header Left !-->
            <!--! [Start] Header Right !-->
            <div class="header-right ms-auto">
                <div class="d-flex align-items-center">

                    <!-- Full Screen Switcher -->
                    <!-- <div class="nxl-h-item d-none d-sm-flex">
                        <div class="full-screen-switcher">
                            <a href="javascript:void(0);" class="nxl-head-link me-0"
                                onclick="$('body').fullScreenHelper('toggle');">
                                <i class="feather-maximize maximize"></i>
                                <i class="feather-minimize minimize"></i>
                            </a>
                        </div>
                    </div> -->

                    <!-- User Dropdown -->
                    <div class="dropdown nxl-h-item">
                        <a href="javascript:void(0);" data-bs-toggle="dropdown" role="button"
                            data-bs-auto-close="outside">
                            <div class="avatar-text avatar-lg bg-gray-200">
                                <i class="feather-user"></i>
                            </div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end nxl-h-dropdown nxl-user-dropdown">
                            <div class="dropdown-header">
                                <section id="user-header">
                                    <div id="user-section" class="user-dropdown">
                                        <a>
                                            <i class="feather-user"></i>
                                            <span id="manager-name">Fundsroom Tech</span></a>
                                    </div>
                                    <script>
                                        const managerName2 = sessionStorage.getItem("userName");
                                        const nameElement = document.getElementById("manager-name");
                                        if (nameElement && managerName2 && managerName2.trim() !== "") {
                                            nameElement.textContent = managerName2;
                                        }
                                    </script>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--! [End] Header Right !-->
        </div>
    </header>
    <!--! ================================================================ !-->
    <!--! [End] Header !-->
    <!--! ================================================================ !-->
    <!--! ================================================================ !-->
    <!--! [Start] Main Content !-->
    <!--! ================================================================ !-->
    <main class="nxl-container">
        <div class="nxl-content">
            <!-- [ page-header ] start -->
            <div class="page-header">
                <div class="page-header-left d-flex align-items-center">
                    <!-- <div class="page-header-title">
                        <h5 class="m-b-10">Dashboard</h5>
                    </div> -->
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="CO.html">Home</a></li>
                        <li class="breadcrumb-item">Connect</li>
                    </ul>
                </div>
                <div class="page-header-right ms-auto">
                    <div class="page-header-right-items">
                        <div class="d-flex d-md-none">
                            <a href="javascript:void(0)" class="page-header-right-close-toggle">
                                <i class="feather-arrow-left me-2"></i>
                                <span>Back</span>
                            </a>
                        </div>
                    </div>
                    <!-- <div class="d-md-none d-flex align-items-center">
                        <a href="javascript:void(0)" class="page-header-right-open-toggle">
                            <i class="feather-align-right fs-20"></i>
                        </a>
                    </div> -->
                </div>
                <div class="position-relative border-bottom" style="margin-right: 1%;">
                    <label class="dropdown-item upload-trigger" style="cursor:pointer;" data-bs-toggle="modal"
                        data-bs-target="#manualEntryModal">
                        <span class="btn btn-icon" data-bs-toggle="tooltip" data-bs-trigger="hover"
                            title="Add College Data Manually">
                            <i class="feather-edit"></i> Add College Data Manually
                        </span>
                    </label>
                </div>
                <div class="position-relative border-bottom">
                    <label for="excelUpload" class="dropdown-item upload-trigger" style="cursor:pointer;">
                        <span class="btn btn-icon" data-bs-toggle="tooltip" data-bs-trigger="hover"
                            title="Upload Excel files (Less than 5MB)">
                            <i class="feather-upload"></i> Upload College Data
                        </span>
                    </label>
                    <input type="file" id="excelUpload" accept=".csv,.xls,.xlsx" style="display:none;">

                </div>
                <button id="downloadExample" class="btn btn-icon btn-success" style="margin-left: 1%;">
                    <i class="feather-download"></i> Download Upload File
                </button>
                <div class="date-picker-container" style="margin-left: 1%;">
                    <input type="text" id="dateRangePicker" class="form-control" placeholder="Select date or range"
                        style="max-width:220px;" />
                </div>
            </div>
            <!-- [ page-header ] end -->
            <!-- [ Main Content ] start -->
            <div class="main-content">
                <div class="row">
                    <!-- Total Calls -->
                    <div class="col-xxl-2 col-lg-2 col-md-6">
                        <div class="card stretch stretch-full">
                            <div class="card-body">
                                <div class="fs-12 fw-medium text-muted mb-3">Total Calls</div>
                                <div class="hstack justify-content-between lh-base">
                                    <div>
                                        <h3><span id="totalCalls">0</span>/<span id="targetCalls">0</span></h3>
                                        <!-- <div class="fs-11 text-muted">
                                            Remaining: <span id="remainingCalls">0</span>
                                        </div> -->
                                    </div>
                                    <div class="hstack gap-2 fs-11" id="totalCallsTrend">
                                        <!-- <i class="feather-arrow-up-circle fs-12"></i> -->
                                        <span id="achievementPercent">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Connected -->
                    <div class="col-xxl-2 col-lg-2 col-md-6">
                        <div class="card stretch stretch-full">
                            <div class="card-body">
                                <div class="fs-12 fw-medium text-muted mb-3">Connected</div>
                                <div class="hstack justify-content-between lh-base">
                                    <h3><span id="connectedCount">0</span></h3>
                                    <div class="hstack gap-2 fs-11">
                                        <!-- <i class="feather-arrow-up-circle fs-12"></i> -->
                                        <span id="connectedPercent">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Not Answered -->
                    <div class="col-xxl-2 col-lg-2 col-md-6">
                        <div class="card stretch stretch-full">
                            <div class="card-body">
                                <div class="fs-12 fw-medium text-muted mb-3">Not Answered</div>
                                <div class="hstack justify-content-between lh-base">
                                    <h3><span id="notAnsweredCount">0</span></h3>
                                    <div class="hstack gap-2 fs-11">
                                        <!-- <i class="feather-arrow-up-circle fs-12"></i> -->
                                        <span id="notAnsweredPercent">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Busy -->
                    <div class="col-xxl-2 col-lg-2 col-md-6">
                        <div class="card stretch stretch-full">
                            <div class="card-body">
                                <div class="fs-12 fw-medium text-muted mb-3">Busy</div>
                                <div class="hstack justify-content-between lh-base">
                                    <h3><span id="busyCount">0</span></h3>
                                    <div class="hstack gap-2 fs-11">
                                        <!-- <i class="feather-arrow-up-circle fs-12"></i> -->
                                        <span id="busyPercent">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Switch Off -->
                    <div class="col-xxl-2 col-lg-2 col-md-6">
                        <div class="card stretch stretch-full">
                            <div class="card-body">
                                <div class="fs-12 fw-medium text-muted mb-3">Switch Off</div>
                                <div class="hstack justify-content-between lh-base">
                                    <h3><span id="switchOffCount">0</span></h3>
                                    <div class="hstack gap-2 fs-11">
                                        <!-- <i class="feather-arrow-up-circle fs-12"></i> -->
                                        <span id="switchOffPercent">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Invalid -->
                    <div class="col-xxl-2 col-lg-2 col-md-6">
                        <div class="card stretch stretch-full">
                            <div class="card-body">
                                <div class="fs-12 fw-medium text-muted mb-3">Invalid</div>
                                <div class="hstack justify-content-between lh-base">
                                    <h3><span id="invalidCount">0</span></h3>
                                    <div class="hstack gap-2 fs-11">
                                        <!-- <i class="feather-arrow-up-circle fs-12"></i> -->
                                        <span id="invalidPercent">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xxl-12 col-lg-12 col-md-12 d-flex justify-content-center align-items-center">
                        <div class="card stretch stretch-full" id="remainingCallsCard" style="width: 100%;">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center fs-18 fw-medium mb-3">
                                    <div>
                                        Remaining Calls: <span id="remainingCalls" style="color:white;">0</span>
                                    </div>
                                    <div>
                                        Achieved Percentage: <span id="achievementPercent2">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Add this button at the top of your page -->
                    <!-- <div class="text-end mb-3">
                        <button class="btn btn-primary" onclick="printPage()">
                            <i class="bi bi-printer"></i> Print Page
                        </button>
                    </div> -->

                    <!-- [Latest Leads] start -->
                    <div class="col-12 flex-fill">
                        <div class="card stretch stretch-full">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="card-title">INDIVIDUAL CONNECTS (Total colleges: <span
                                            id="collegeCount2">
                                            0</span>)</h5>
                                </div>
                                <div class="card-header-action d-flex align-items-center gap-2">
                                    <!-- <div data-bs-toggle="tooltip" title="Refresh">
                                        <a href="javascript:void(0);" class="avatar-text avatar-xs bg-warning"
                                            onclick="loadTableData2()"> </a>
                                    </div> -->
                                    <div class="search-wrapper2" id="searchWrapper2">
                                        <button id="searchToggle2" class="search-icon">
                                            <img src="https://cdn-icons-png.flaticon.com/512/622/622669.png"
                                                alt="Search" width="20" height="20">
                                        </button>
                                        <div class="search-bar2" id="searchBar2">
                                            <input type="text" id="searchInput2" class="form-control"
                                                placeholder="Search..." oninput="filterTable2()">
                                        </div>
                                    </div>
                                    <div data-bs-toggle="tooltip" title="Maximize/Minimize">
                                        <a href="javascript:void(0);" class="avatar-xs" data-bs-toggle="expand">
                                            <i class="feather-maximize maximize" style="font-size: 15px;"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <div class="card-body custom-card-action p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0" id="leadsTable2">
                                        <thead>
                                            <tr class="border-b">
                                                <th>Delete</th>
                                                <th>SR</th>
                                                <th>College Name</th>
                                                <th>Co-ordinator Name</th>
                                                <th>Mobile Number</th>
                                                <th>Email</th>
                                                <th>State</th>
                                                <th>City</th>
                                                <th>Course</th>
                                                <th>Connected by</th>
                                                <th>Date of connect</th>
                                                <th>Call Response</th>
                                                <th>Type of INT</th>
                                                <th>Detailed Response</th>
                                                <th>Send JD</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="card-footer">
                                <div class="d-flex justify-content-between align-items-center">
                                    <ul class="list-unstyled d-flex align-items-center gap-2 mb-0 pagination-common-style"
                                        id="pagination2"></ul>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-primary" onclick="printTable2()">
                                            <i class="bi bi-printer"></i> Print
                                        </button>
                                        <button class="btn btn-success" onclick="exportToExcel2()">
                                            <i class="bi bi-file-earmark-excel"></i> Excel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <style>
                        #dateRangePicker2::placeholder {
                            font-weight: 700;
                            color: #000;
                            opacity: 1;
                        }

                        .search-wrapper2 {
                            position: relative;
                            display: flex;
                            align-items: center;
                        }

                        .search-icon {
                            background: none;
                            border: none;
                            cursor: pointer;
                            margin-right: 8px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            padding: 4px;
                        }

                        .search-bar2 {
                            display: none;
                        }

                        .search-bar2.active {
                            display: block;
                        }

                        #searchInput2 {
                            padding: 6px 10px;
                            border: 1px solid #ccc;
                            border-radius: 6px;
                        }
                    </style>

                    <script>
                        const searchToggle2 = document.getElementById("searchToggle2");
                        const searchBar2 = document.getElementById("searchBar2");
                        const searchWrapper2 = document.getElementById("searchWrapper2");

                        searchToggle2.addEventListener("click", () => {
                            const isActive = searchBar2.classList.toggle("active");

                            if (isActive) {
                                document.getElementById("searchInput2").focus();

                                loadTableData();
                                loadTableData2();
                            }
                        });

                        document.addEventListener("click", (event) => {
                            if (!searchWrapper2.contains(event.target)) {
                                searchBar2.classList.remove("active");
                            }
                        });
                    </script>

                    <!-- Calendar Component -->
                    <!-- <div class="col-4 flex-fill calendar-container">
                        <div class="card stretch stretch-full">
                            <div class="card-body">
                                <div class="calendar">
                                    <div class="calendar-header">
                                        <button id="prevMonth">&lt;</button>
                                        <h2 id="currentMonthYear">March 2025</h2>
                                        <button id="nextMonth">&gt;</button>
                                    </div>
                                    <div class="calendar-grid">
                                        <div class="calendar-weekdays">
                                            <div>MON</div>
                                            <div>TUE</div>
                                            <div>WED</div>
                                            <div>THU</div>
                                            <div>FRI</div>
                                            <div>SAT</div>
                                            <div>SUN</div>
                                        </div>
                                        <div class="calendar-days" id="calendarDays"></div>
                                    </div>
                                </div>
                                <div id="errorMessage" class="text-danger mt-2" style="display: none;">
                                    Failed to fetch data. Please try again.
                                </div>
                                <div class="selected-range mt-3">
                                    <strong>Selected:</strong>
                                    <span id="selectedRange"></span>
                                </div>
                            </div>
                        </div>
                    </div> -->
                    <!-- [Project Calendar] end -->

                    <div class="col-xxl-12">
                        <div class="card stretch stretch-full overflow-hidden">
                            <div class="bg-success text-white">

                                <div class="p-4 d-flex justify-content-between align-items-center">
                                    <h5 class="text-reset">ANALYTICS</h5>

                                    <div class="d-flex gap-2">
                                        <button class="chart-scroll-btn" id="scrollLeftBtn">
                                            <i class="bi bi-chevron-left"></i>
                                        </button>

                                        <button class="chart-scroll-btn" id="scrollRightBtn">
                                            <i class="bi bi-chevron-right"></i>
                                        </button>
                                    </div>
                                </div>

                                <div id="chartScrollWrapper" class="chart-scroll-wrapper">
                                    <div id="chart-inner">
                                        <div id="conversion-statistic-bar-chart"></div>
                                    </div>
                                </div>

                            </div>

                            <div class="card-body">
                                <h6 class="mb-3">Daily JD Sent</h6>
                                <ul class="list-group" id="jdList"></ul>
                            </div>
                        </div>
                    </div>

                    <style>
                        .chart-scroll-btn {
                            background: rgba(255, 255, 255, 0.25);
                            border: none;
                            color: #fff;
                            width: 36px;
                            height: 36px;
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            cursor: pointer;
                            transition: 0.2s ease-in-out;
                        }

                        .chart-scroll-btn:hover {
                            background: rgba(255, 255, 255, 0.45);
                        }

                        .chart-scroll-wrapper {
                            overflow-x: auto;
                            scroll-behavior: smooth;
                            padding-bottom: 10px;
                            white-space: nowrap;
                        }

                        .chart-scroll-wrapper {
                            overflow-x: auto;
                            overflow-y: hidden;
                            width: 100%;
                            padding-bottom: 10px;
                        }

                        #chart-inner {
                            min-width: 600px;
                        }

                        #jdList {
                            max-height: 250px;
                            overflow-y: auto;
                        }
                    </style>
                </div>
                <hr style="border: none; border-top: 10px dotted #000000; margin-top: 10px;">

                <div class="row" style="margin-bottom: 3%;">
                    <style>
                        .table-responsive {
                            overflow-x: auto;
                            position: relative;
                        }

                        #leadsTable {
                            border-collapse: collapse;
                            width: max-content;
                            font-family: 'Inter', sans-serif;
                            font-size: 14px;
                            background: #fff;
                            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
                            border-radius: 8px;
                        }

                        .column-filter {
                            display: inline-block !important;
                            width: 100%;
                            margin-top: 4px;
                        }


                        #leadsTable th {
                            font-weight: 600;
                            text-align: left;
                            padding: 8px 12px;
                            border-bottom: 2px solid #e5e7eb;
                            position: sticky;
                            top: 0;
                            z-index: 10;
                        }

                        #leadsTable th:nth-child(-n+3) {
                            background: #fff;
                            color: #000;
                            z-index: 15;
                        }

                        #leadsTable th:nth-child(n+4) {
                            background: #fff;
                            color: #000;
                            font-weight: bold;
                            font-size: 13px;
                        }

                        #leadsTable td {
                            vertical-align: middle;
                            padding: 8px 12px;
                            white-space: nowrap;
                            border-bottom: 1px solid #f1f5f9;
                        }

                        /* #leadsTable tr:nth-child(even) td {
                            background: #fafafa;
                        } */

                        #leadsTable tr:hover td {
                            background: #f1f5ff;
                        }

                        #leadsTable th:nth-child(-n+3),
                        #leadsTable td:nth-child(-n+3) {
                            position: sticky;
                            left: 0;
                            z-index: 5;
                            border-right: 1px solid #dee2e6;
                            background: #fff;
                            font-size: 13px;
                        }

                        #leadsTable input,
                        #leadsTable select {
                            display: none;
                            width: 100%;
                            font-size: 14px;
                            padding: 6px 8px;
                            border: 1px solid #cbd5e1;
                            border-radius: 6px;
                            background: #fff;
                        }

                        #leadsTable td.editing input,
                        #leadsTable td.editing select {
                            display: block;
                        }

                        #leadsTable td span {
                            display: inline-block;
                            width: 100%;
                            min-height: 22px;
                            font-size: 14px;
                            cursor: pointer;
                            color: #1e293b;
                        }

                        #leadsTable td.editing {
                            background: #fff7ed;
                            box-shadow: inset 0 0 0 2px #f97316;
                        }
                    </style>

                    <style>
                        .table-responsive {
                            overflow-x: auto;
                            position: relative;
                        }

                        .column-filter2 {
                            display: inline-block !important;
                            width: 100%;
                            margin-top: 4px;
                        }

                        #leadsTable2 {
                            border-collapse: collapse;
                            width: max-content;
                            font-family: 'Inter', sans-serif;
                            font-size: 14px;
                            background: #fff;
                            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
                            border-radius: 8px;
                        }

                        #leadsTable2 th {
                            font-weight: 600;
                            text-align: left;
                            padding: 8px 12px;
                            border-bottom: 2px solid #e5e7eb;
                            position: sticky;
                            top: 0;
                            z-index: 10;
                            background: #fff;
                        }

                        #leadsTable2 th:nth-child(-n+3) {
                            background: #fff;
                            color: #000;
                            z-index: 15;
                        }

                        #leadsTable2 th:nth-child(n+4) {
                            background: #fff;
                            color: #000;
                            font-weight: bold;
                            font-size: 13px;
                        }

                        #leadsTable2 td {
                            vertical-align: middle;
                            padding: 8px 12px;
                            white-space: nowrap;
                            border-bottom: 1px solid #f1f5f9;
                        }

                        /* #leadsTable2 tr:nth-child(even) td {
                            background: #fafafa;
                        } */

                        #leadsTable2 tr:hover td {
                            background: #f1f5ff;
                        }

                        #leadsTable2 th:nth-child(-n+3),
                        #leadsTable2 td:nth-child(-n+3) {
                            position: sticky;
                            left: 0;
                            z-index: 5;
                            border-right: 1px solid #dee2e6;
                            background: #fff;
                            font-size: 13px;
                        }

                        #leadsTable2 input,
                        #leadsTable2 select {
                            display: none;
                            width: 100%;
                            font-size: 14px;
                            padding: 6px 8px;
                            border: 1px solid #cbd5e1;
                            border-radius: 6px;
                            background: #fff;
                        }

                        #leadsTable2 td.editing input,
                        #leadsTable2 td.editing select {
                            display: block;
                        }

                        #leadsTable2 td span {
                            display: inline-block;
                            width: 100%;
                            min-height: 22px;
                            font-size: 14px;
                            cursor: pointer;
                            color: #1e293b;
                        }

                        #leadsTable2 td.editing {
                            background: #fff7ed;
                            box-shadow: inset 0 0 0 2px #f97316;
                        }
                    </style>

                    <div class="col-12">
                        <div class="card stretch stretch-full">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="card-title">COLLEGE DETAILS (Total colleges: <span id="collegeCount">
                                            0</span>)</h5>
                                </div>
                                <div class="card-header-action">
                                    <!-- <div data-bs-toggle="tooltip" title="Refresh">
                                        <a href="javascript:void(0);" class="avatar-text avatar-xs bg-warning"
                                            onclick="loadTableData()"> </a>
                                    </div> -->

                                    <div class="search-wrapper" id="searchWrapper">
                                        <button id="searchToggle" class="search-icon">
                                            <img src="https://cdn-icons-png.flaticon.com/512/622/622669.png"
                                                alt="Search" width="20" height="20">
                                        </button>
                                        <div class="search-bar" id="searchBar">
                                            <input type="text" id="searchInput" class="form-control"
                                                placeholder="Search..." oninput="filterTable()">
                                        </div>
                                    </div>

                                    <div data-bs-toggle="tooltip" title="Maximize/Minimize">
                                        <a href="javascript:void(0);" class="avatar-xs" data-bs-toggle="expand">
                                            <i class="feather-maximize maximize" style="font-size: 15px;"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <div class="card-body custom-card-action p-0">
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover mb-0" id="leadsTable">
                                        <thead class="table-light">
                                            <tr class="border-b">
                                                <th>Delete</th>
                                                <th>SR</th>
                                                <th>College Name</th>
                                                <th>Co-ordinator Name</th>
                                                <th>Mobile Number</th>
                                                <th>Email</th>
                                                <th>Placement Cell Link</th>
                                                <th>MBA Fee Approx</th>
                                                <th>MBA Batch Strength Approx</th>
                                                <th>State</th>
                                                <th>City</th>
                                                <th>College Tier</th>
                                                <th>College Level</th>
                                                <th>Comment</th>
                                                <th>Corporate Relations</th>
                                                <th>Course</th>
                                                <th>Connected by</th>
                                                <th>Date of connect</th>
                                                <th>Call Response</th>
                                                <th>Type of INT</th>
                                                <th>Detailed Response</th>
                                                <th>Send JD</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Rows dynamically injected here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between align-items-center">
                                    <ul class="list-unstyled d-flex align-items-center gap-2 mb-0 pagination-common-style"
                                        id="pagination">
                                        <!-- Pagination links will be dynamically populated here -->
                                    </ul>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-primary" onclick="printTable()">
                                            <i class="bi bi-printer"></i> Print
                                        </button>
                                        <button class="btn btn-success" onclick="exportToExcel()">
                                            <i class="bi bi-file-earmark-excel"></i> Excel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr style="border: none; border-top: 10px dotted #000000; margin-top: 10px;">
                    <div class="date-picker-container d-flex justify-content-center"
                        style="margin-top: 2%; margin-bottom: 2%; margin-right:2%;">
                        <input type="text" id="dateRangePicker2" class="form-control text-center fw-bold"
                            placeholder="Select date or range"
                            style="max-width:220px; font-weight:700; color:#000; opacity:1;" />
                    </div>

                    <style>
                        #dateRangePicker2::placeholder {
                            font-weight: 700;
                            color: #000;
                            opacity: 1;
                        }

                        .search-wrapper {
                            position: relative;
                            display: flex;
                            align-items: center;
                        }

                        .search-icon {
                            background: none;
                            border: none;
                            cursor: pointer;
                            margin-right: 8px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            padding: 4px;
                        }

                        .search-bar {
                            display: none;
                        }

                        .search-bar.active {
                            display: block;
                        }

                        #searchInput {
                            padding: 6px 10px;
                            border: 1px solid #ccc;
                            border-radius: 6px;
                        }
                    </style>

                    <script>
                        const searchToggle = document.getElementById("searchToggle");
                        const searchBar = document.getElementById("searchBar");
                        const searchWrapper = document.getElementById("searchWrapper");

                        searchToggle.addEventListener("click", () => {
                            const isActive = searchBar.classList.toggle("active");

                            if (isActive) {
                                document.getElementById("searchInput").focus();

                                loadTableData();
                                loadTableData2();
                            }
                        });

                        document.addEventListener("click", (event) => {
                            if (!searchWrapper.contains(event.target)) {
                                searchBar.classList.remove("active");
                            }
                        });
                    </script>

                    <div class="col-lg-6">
                        <div class="row g-3 h-100">
                            <!-- First Row of Cards -->
                            <div class="col-md-6">
                                <a href="tables/cna.html" class="text-decoration-none">
                                    <div class="card bg-danger text-white h-100">
                                        <div class="card-body">
                                            <div class="text-start">

                                                <p class="text-reset m-0">CNA:
                                                <h1 class="text-reset"></h1>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <div class="col-md-6">
                                <a href="tables/busy.html" class="text-decoration-none">
                                    <div class="card bg-warning text-white h-100">
                                        <div class="card-body">
                                            <div class="text-start">

                                                <p class="text-reset m-0">Busy:
                                                <h1 class="text-reset"></h1>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="row g-3 h-100">
                            <!-- Second Row of Cards -->
                            <div class="col-md-6">
                                <a href="tables/invalid.html" class="text-decoration-none">
                                    <div class="card bg-secondary text-white h-100">
                                        <div class="card-body">
                                            <div class="text-start">

                                                <p class="text-reset m-0">Invalid:
                                                <h1 class="text-reset"></h1>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <div class="col-md-6">
                                <a href="tables/others.html" class="text-decoration-none">
                                    <div class="card bg-primary text-white h-100">
                                        <div class="card-body">

                                            <div class="text-start">

                                                <p class="text-reset m-0">Switch off:
                                                <h1 class="text-reset"></h1>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>

                </div>
                <hr style="border: none; border-top: 10px dotted #000000; margin-top: 10px;">

                <div class="col-12 flex-fill">
                    <div class="card stretch stretch-full">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title">FUTURE COLLEGE DETAILS</h5>
                            </div>
                            <div class="card-header-action d-flex align-items-center gap-2">
                                <!-- <div data-bs-toggle="tooltip" title="Refresh">
                                    <a href="javascript:void(0);" class="avatar-text avatar-xs bg-warning"
                                        onclick="loadTableData3()"> </a>
                                </div> -->

                                <div class="month-dropdown d-flex align-items-center gap-2">
                                    <select id="monthSelect3" class="form-select form-select-sm"
                                        onchange="setSelectedMonthYear3()">
                                        <option value=""></option>
                                    </select>
                                    <select id="yearSelect3" class="form-select form-select-sm"
                                        onchange="setSelectedMonthYear3()">
                                        <option value=""></option>
                                    </select>

                                    <span id="selectedMonthDisplay3" class="badge bg-primary"
                                        style="display:none;"></span>
                                </div>


                                <div class="search-wrapper3" id="searchWrapper3">
                                    <button id="searchToggle3" class="search-icon">
                                        <img src="https://cdn-icons-png.flaticon.com/512/622/622669.png" alt="Search"
                                            width="20" height="20">
                                    </button>
                                    <div class="search-bar3" id="searchBar3">
                                        <input type="text" id="searchInput3" class="form-control"
                                            placeholder="Search..." oninput="filterTable3()">
                                    </div>
                                </div>
                                <div data-bs-toggle="tooltip" title="Maximize/Minimize">
                                    <a href="javascript:void(0);" class="avatar-xs" data-bs-toggle="expand">
                                        <i class="feather-maximize maximize" style="font-size: 15px;"></i>
                                    </a>
                                </div>
                            </div>

                        </div>

                        <div class="card-body custom-card-action p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0" id="leadsTable3">
                                    <thead>
                                        <tr class="border-b">
                                            <th>SR</th>
                                            <th>College Name</th>
                                            <th>Co-ordinator Name</th>
                                            <th>Mobile Number</th>
                                            <th>Email</th>
                                            <th>City</th>
                                            <th>State</th>
                                            <th>Course</th>
                                            <th>Connected by</th>
                                            <th>Date of connect</th>
                                            <th>Call Response</th>
                                            <th>Type of INT</th>
                                            <th>Detailed Response</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="card-footer">
                            <div class="d-flex justify-content-between align-items-center">
                                <ul class="list-unstyled d-flex align-items-center gap-2 mb-0 pagination-common-style"
                                    id="pagination3"></ul>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-primary" onclick="printTable3()">
                                        <i class="bi bi-printer"></i> Print
                                    </button>
                                    <button class="btn btn-success" onclick="exportToExcel3()">
                                        <i class="bi bi-file-earmark-excel"></i> Excel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <style>
                    #dateRangePicker3::placeholder {
                        font-weight: 700;
                        color: #000;
                        opacity: 1;
                    }

                    .search-wrapper3 {
                        position: relative;
                        display: flex;
                        align-items: center;
                    }

                    .search-icon {
                        background: none;
                        border: none;
                        cursor: pointer;
                        margin-right: 8px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        padding: 4px;
                    }

                    .search-bar3 {
                        display: none;
                    }

                    .search-bar3.active {
                        display: block;
                    }

                    #searchInput3 {
                        padding: 6px 10px;
                        border: 1px solid #ccc;
                        border-radius: 6px;
                    }
                </style>

                <script>
                    const searchToggle3 = document.getElementById("searchToggle3");
                    const searchBar3 = document.getElementById("searchBar3");
                    const searchWrapper3 = document.getElementById("searchWrapper3");

                    searchToggle3.addEventListener("click", () => {
                        const isActive = searchBar3.classList.toggle("active");

                        if (isActive) {
                            document.getElementById("searchInput3").focus();

                            loadTableData();
                            loadTableData2();
                        }
                    });

                    document.addEventListener("click", (event) => {
                        if (!searchWrapper3.contains(event.target)) {
                            searchBar3.classList.remove("active");
                        }
                    });
                </script>

                <style>
                    .card-header-action {
                        gap: 10px;
                    }

                    .month-dropdown select {
                        min-width: 160px;
                        border-radius: 8px;
                        border: 1px solid #ddd;
                        background-color: #f8f9fa;
                        padding: 4px 8px;
                        font-size: 14px;
                        transition: all 0.2s ease-in-out;
                    }

                    .month-dropdown select:hover {
                        border-color: #0d6efd;
                        background-color: #fff;
                        box-shadow: 0 0 6px rgba(13, 110, 253, 0.2);
                    }

                    .search-bar .input-group {
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        overflow: hidden;
                        transition: box-shadow 0.2s;
                    }

                    .search-bar .input-group:focus-within {
                        box-shadow: 0 0 6px rgba(13, 110, 253, 0.2);
                        border-color: #0d6efd;
                    }

                    .search-bar input {
                        border: none;
                        outline: none;
                        font-size: 14px;
                    }
                </style>


                <!-- [ Main Content ] end -->
            </div>
            <!-- [ Footer ] start -->
            <footer class="footer">
                <p class="fs-11 text-muted fw-medium text-uppercase mb-0 copyright">
                    <span>Copyright Fundsroom </span>
                    <script>
                        document.write(new Date().getFullYear());
                    </script>
                </p>
                <div class="d-flex align-items-center gap-4">
                    <!-- <a href="javascript:void(0);" class="fs-11 fw-semibold text-uppercase">Help</a>
					<a href="javascript:void(0);" class="fs-11 fw-semibold text-uppercase">Terms</a>
					<a href="javascript:void(0);" class="fs-11 fw-semibold text-uppercase">Privacy</a> -->
                </div>
            </footer>
            <style>
                .flatpickr-calendar,
                .flatpickr-calendar * {
                    font-family: 'Inter', sans-serif !important;
                    font-size: 14px;
                }

                .flatpickr-months .flatpickr-month {
                    font-weight: 600;
                    color: #155fcf;
                }

                .flatpickr-weekday {
                    color: #1e293b;
                    font-weight: 500;
                }

                .flatpickr-day.selected,
                .flatpickr-day.startRange,
                .flatpickr-day.endRange {
                    background: #155fcf !important;
                    color: #fff !important;
                    border-radius: 6px;
                }

                .flatpickr-day.inRange {
                    background: #e0ebff;
                    color: #155fcf;
                }

                .flatpickr-day.today {
                    border: 1px solid #155fcf;
                }

                #dateRangePicker {
                    font-family: 'Inter', sans-serif;
                    font-size: 14px;
                    border-radius: 6px;
                    border: 1px solid #cbd5e1;
                    padding: 6px 10px;
                    color: #1e293b;
                }
            </style>
            <!-- [ Footer ] end -->
    </main>

    <div class="modal fade-scale" id="composeMail" tabindex="-1" aria-labelledby="composeMail" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="d-flex flex-column mb-0">
                        <span class="fs-18 fw-bold mb-1">Compose JD Mail</span>
                        <small class="d-block fs-11 fw-normal text-muted">Send Internship JD to College
                            Coordinator</small>
                    </h2>
                    <a href="javascript:void(0)" class="avatar-text avatar-md bg-soft-danger close-icon"
                        data-bs-dismiss="modal">
                        <i class="feather-x text-danger"></i>
                    </a>
                </div>
                <div class="modal-body p-0">
                    <div class="position-relative border-bottom">
                        <div class="col-lg-12 mb-4">
                            <input id="from" class="form-control border-0 text-dark flex-grow-1" name="from"
                                placeholder="From: recruitment@fundsaudit.co.in" style="min-width: 150px;" readonly>
                        </div>
                        <div class="px-2 d-flex align-items-center">
                            <div class="p-0 w-100 d-flex flex-wrap align-items-center gap-1" id="email-chip-wrapper">
                                <input id="email-input" class="form-control border-0 text-dark flex-grow-1"
                                    name="tomailmodal" placeholder="To" style="min-width: 150px;" readonly>
                            </div>
                        </div>
                    </div>

                    <div class="border-bottom mail-cc-bcc-fields" id="ccbccToggleModalFileds" style="display: none">
                        <div class="px-2 w-100 d-flex align-items-center border-bottom">
                            <input class="form-control border-0 text-dark" name="ccmailmodal" placeholder="CC">
                        </div>
                        <div class="px-2 w-100 d-flex align-items-center">
                            <input class="form-control border-0 text-dark" name="bccmailmodal" placeholder="BCC">
                        </div>
                    </div>

                    <div class="px-2 w-100 d-flex align-items-center">
                        <input id="subject-input" class="form-control border-0 my-1 w-100 shadow-none" type="text"
                            placeholder="Subject"
                            value="Collaboration Proposal for Live Projects, Internships & Placements - FundsAudit"
                            readonly>
                    </div>

                    <!-- Attachment Section -->
                    <div class="px-3 py-2 border-bottom">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <label class="fw-semibold text-dark mb-0">Attachments:</label>
                            <button type="button" id="addAttachmentBtn" class="btn btn-sm btn-outline-primary">
                                <i class="feather-paperclip me-1"></i> Add Attachment
                            </button>
                        </div>
                        <div id="attachmentContainer" class="mt-2">
                            <!-- Attachments will be displayed here -->
                        </div>
                        <input type="file" id="fileInput" multiple style="display: none;"
                            accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                    </div>

                    <!-- Email Body Container -->
                    <div class="email-body-container p-3">
                        <!-- Fixed Top Part -->
                        <div id="email-fixed-top" class="email-fixed-part mb-3 p-3 border rounded bg-light">
                            <!-- This will be filled dynamically with JavaScript -->
                        </div>

                        <!-- Editable Middle Part -->
                        <div class="email-editable-part mb-3">
                            <label class="fw-semibold text-dark mb-2 d-block">Customize Email:</label>
                            <div id="mailEditorModal" class="ht-200 border rounded p-3 bg-white" contenteditable="true">
                                <!-- Editable content will be inserted here -->
                            </div>
                        </div>

                        <!-- Fixed Bottom Part -->
                        <div id="email-fixed-bottom" class="email-fixed-part mt-3 p-3 border rounded bg-light">
                            <!-- This will be filled dynamically with JavaScript -->
                        </div>
                    </div>

                    <!-- Preview Section -->
                    <div class="mt-4 px-3" id="emailPreviewContainer">
                        <label class="fw-semibold text-dark mb-2 d-block">Email Preview:</label>
                        <div id="emailPreview" class="border rounded p-3 bg-light"
                            style="max-height: 400px; overflow-y: auto;">
                            <!-- Live preview will be injected here -->
                        </div>
                    </div>

                    <input type="hidden" id="currentRecordId" value="">
                    <input type="hidden" id="currentRecordData" value="">
                </div>

                <div class="modal-footer d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <button id="sendEmailBtn" class="btn btn-primary me-2" data-bs-toggle="tooltip"
                            data-bs-trigger="hover" title="Send Message with Attachments">
                            <i class="feather-send me-1"></i> Send JD Mail
                        </button>

                        <button type="button" id="copyEmailBtn" class="btn btn-outline-secondary me-2">
                            <i class="feather-copy me-1"></i> Copy Body
                        </button>
                    </div>

                    <div class="d-flex align-items-center">
                        <a href="javascript:void(0);" data-bs-dismiss="modal" class="btn btn-outline-danger">
                            <i class="feather-x me-1"></i> Cancel
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <style>
        .email-body-container {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin: 15px;
        }

        .email-fixed-part {
            font-size: 14px;
            line-height: 1.6;
            user-select: none;
            cursor: default;
        }

        .email-editable-part {
            border-left: 3px solid #0d6efd;
            padding-left: 15px;
        }

        #mailEditorModal {
            min-height: 150px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ced4da !important;
            background-color: #fff !important;
        }

        #mailEditorModal:focus {
            outline: none;
            border-color: #86b7fe !important;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25) !important;
        }

        #emailPreview {
            font-family: Arial, sans-serif;
            font-size: 14px;
            line-height: 1.6;
        }

        #emailPreview h4 {
            color: #59595d;
            margin-top: 15px;
            margin-bottom: 10px;
        }

        #emailPreview ul {
            padding-left: 20px;
        }

        #emailPreview li {
            margin-bottom: 5px;
        }

        .email-template-variable {
            background-color: #e7f1ff;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }
    </style>
    <!--! ================================================================ !-->
    <!--! [End] Main Content !-->
    <!--! ================================================================ !-->

    <style>
        .email-chip {
            display: flex;
            align-items: center;
            background-color: #e0e0e0;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            color: #333;
        }

        .email-chip .remove-btn {
            margin-left: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .email-chip .remove-btn:hover {
            color: red;
        }

        .email-chip .avatar {
            width: 22px;
            height: 22px;
            background-color: #9cc1f9;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
    </style>

    <!--! ================================================================ !-->
    <!--! Footer Script !-->
    <!--! ================================================================ !-->
    <!--! BEGIN: Vendors JS !-->
    <script src="./../assets/vendors/js/vendors.min.js"></script>
    <!-- vendors.min.js {always must need to be top} -->
    <script src="./../assets/vendors/js/daterangepicker.min.js"></script>
    <script src="./../assets/vendors/js/apexcharts.min.js"></script>
    <script src="./../assets/vendors/js/circle-progress.min.js"></script>
    <script src="./../assets/vendors/js/jquery.calendar.min.js"></script>
    <script src="./../assets/vendors/js/select2.min.js"></script>
    <script src="./../assets/vendors/js/select2-active.min.js"></script>
    <script src="./../assets/js/common-init.min.js"></script>
    <script src="./../assets/vendors/js/lslstrength.min.js"></script>
    <!-- <script src="./../assets/vendors/js/tagify.min.js"></script> -->
    <script src="./../assets/vendors/js/tagify-data.min.js"></script>
    <script src="./../assets/vendors/js/quill.min.js"></script>
    <!-- <script src="./../assets/js/common-init.min.js"></script> -->
    <script src="./../assets/js/apps-email-init.min.js"></script>
    <!--! END: Vendors JS !-->
    <!--! BEGIN: Apps Init  !-->
    <script src="./../assets/js/reports-project-init.min.js"></script>
    <script src="./../assets/js/widgets-charts-init.min.js"></script>
    <script src="./../assets/js/widgets-miscellaneous-init.min.js"></script>
    <!--! END: Apps Init !-->
    <!--! BEGIN: Theme Customizer  !-->
    <script src="./../assets/js/theme-customizer-init.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        document.getElementById("downloadExample").addEventListener("click", function () {
            const fileUrl = "/excel-files/CO-Upload-sheet.xlsx";

            const link = document.createElement("a");
            link.href = fileUrl;
            link.download = "CO-Upload-sheet.xlsx";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
    </script>

    <script>
        const teamManagerId = sessionStorage.getItem("user_id");
        console.log(teamManagerId);

        let analysisChart = null;

        function formatDateUI(dateStr) {
            const parts = dateStr.split("-");
            if (parts.length === 3) {
                return `${parts[2]}-${parts[1]}-${parts[0]}`;
            }
            return dateStr;
        }

        function loadAnalysisChart(startDate = null, endDate = null) {

            let url = `https://eduroom.in/api/v1/analysis/daily?teamManagerId=${teamManagerId}&startDate=${startDate}&endDate=${endDate}`;

            $.ajax({
                url: url,
                type: "GET",
                dataType: "json",
                success: function (res) {
                    console.log("barchart data:", res);

                    const jdList = $("#jdList");
                    jdList.empty();

                    if (res.success && res.dates && res.dates.length > 0) {

                        const totalDays = res.dates.length;

                        $("#chart-inner").css("min-width", `${totalDays * 55}px`);

                        const dates = res.dates.map(item => {
                            let d = new Date(item.date);
                            let day = d.getDate();
                            let month = d.toLocaleDateString("en-US", { month: "short" });
                            return `${day} ${month}`;
                        });

                        const jdCounts = res.dates.map(item => item.jdSent);

                        res.dates.forEach(item => {
                            let target = item.plannedJds || 0;
                            jdList.append(`
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <span>${formatDateUI(item.date)} (${item.day})</span>
                                    <span class="fw-bold">${item.jdSent}/${target}</span>
                                </li>
                            `);
                        });

                        if (analysisChart) {
                            analysisChart.updateOptions({
                                series: [{ name: "JDs Sent", data: jdCounts }],
                                xaxis: { categories: dates }
                            });
                        } else {
                            analysisChart = new ApexCharts(document.querySelector("#conversion-statistic-bar-chart"), {
                                series: [{ name: "JDs Sent", data: jdCounts }],
                                chart: { type: "bar", height: 200, toolbar: { show: false } },

                                plotOptions: {
                                    bar: {
                                        horizontal: false,
                                        endingShape: "rounded",
                                        columnWidth: "35%"
                                    }
                                },

                                colors: ["#fff"],
                                grid: { show: false },
                                legend: { show: false },
                                dataLabels: { enabled: false },

                                xaxis: {
                                    categories: dates,
                                    labels: {
                                        show: true,
                                        style: { colors: "#fff", fontFamily: "Roboto" },
                                        rotate: -45
                                    }
                                },

                                yaxis: { labels: { show: false } },

                                tooltip: {
                                    theme: "dark",
                                    y: { formatter: (val) => val + " JDs Sent" },
                                    style: { colors: "#000", fontFamily: "Roboto" }
                                }
                            });
                            analysisChart.render();
                        }

                    } else {
                        console.warn("No analysis data found for selected range.");
                        jdList.append(`<li><span class="date">No Data</span><span class="count">0/0</span></li>`);

                        $("#chart-inner").css("min-width", "600px");

                        if (analysisChart) {
                            analysisChart.updateOptions({
                                series: [{ name: "JDs Sent", data: [] }],
                                xaxis: { categories: [] }
                            });
                        }
                    }
                },
                error: function (err) {
                    console.error("Error fetching analysis data", err);
                }
            });
        }

        $(document).ready(function () {

            const scrollBox = document.getElementById("chartScrollWrapper");

            $("#scrollLeftBtn").click(() => {
                scrollBox.scrollLeft -= 300;
            });

            $("#scrollRightBtn").click(() => {
                scrollBox.scrollLeft += 300;
            });

        });

        function loadDashboardData(startDate = null, endDate = null) {

            const manager = sessionStorage.getItem("userName");

            const urlTargets = `https://eduroom.in/api/v1/mytarget/fetch?teamManagerId=${teamManagerId}&startDate=${startDate}&endDate=${endDate}`;
            const urlCosheet = `https://eduroom.in/api/v1/cosheet/list`;

            console.log("Targets URL:", urlTargets);
            console.log("Cosheet URL:", urlCosheet);

            $.ajax({
                url: urlTargets,
                type: "GET",
                success: function (targetRes) {

                    let targetCalls = 0;

                    if (targetRes.success && Array.isArray(targetRes.dates)) {
                        targetRes.dates.forEach(day => {
                            targetCalls += Number(day.calls || 0);
                        });
                    }

                    $.ajax({
                        url: urlCosheet,
                        type: "GET",
                        success: function (cosheetRes) {

                            if (!cosheetRes.success) return;

                            const allData = cosheetRes.data;

                            let filtered = allData.filter(x => x.connectedBy === manager);

                            if (startDate && endDate) {
                                filtered = filtered.filter(row => {
                                    if (!row.dateOfConnect) return false;
                                    const d = row.dateOfConnect.split("T")[0];
                                    return d >= startDate && d <= endDate;
                                });
                            }

                            let achievedCalls = filtered.length;

                            let counts = {
                                connected: 0,
                                notAnswered: 0,
                                busy: 0,
                                switchOff: 0,
                                invalid: 0
                            };

                            filtered.forEach(row => {
                                const res = (row.callResponse || "").toLowerCase().trim();

                                if (res === "connected") counts.connected++;
                                else if (res === "not answered") counts.notAnswered++;
                                else if (res === "busy") counts.busy++;
                                else if (res === "switch off") counts.switchOff++;
                                else if (res === "invalid") counts.invalid++;
                            });

                            const achievementPercent = targetCalls > 0
                                ? ((achievedCalls / targetCalls) * 100).toFixed(1)
                                : 0;

                            $("#totalCalls").text(achievedCalls);
                            $("#targetCalls").text(targetCalls);
                            $("#remainingCalls").text(Math.max(targetCalls - achievedCalls, 0));

                            $("#achievementPercent").text(achievementPercent + "%");
                            $("#achievementPercent2").text(achievementPercent + "%");

                            $("#connectedCount").text(counts.connected);
                            $("#connectedPercent").text(((counts.connected / (targetCalls || 1)) * 100).toFixed(1) + "%");

                            $("#notAnsweredCount").text(counts.notAnswered);
                            $("#notAnsweredPercent").text(((counts.notAnswered / (targetCalls || 1)) * 100).toFixed(1) + "%");

                            $("#busyCount").text(counts.busy);
                            $("#busyPercent").text(((counts.busy / (targetCalls || 1)) * 100).toFixed(1) + "%");

                            $("#switchOffCount").text(counts.switchOff);
                            $("#switchOffPercent").text(((counts.switchOff / (targetCalls || 1)) * 100).toFixed(1) + "%");

                            $("#invalidCount").text(counts.invalid);
                            $("#invalidPercent").text(((counts.invalid / (targetCalls || 1)) * 100).toFixed(1) + "%");

                            let card = $("#remainingCallsCard");
                            card.removeClass("bg-danger bg-warning bg-success text-white text-dark");

                            if (targetCalls === 0) {
                                card.addClass("bg-white text-dark");
                            } else if (achievementPercent < 33) {
                                card.addClass("bg-danger text-white");
                            } else if (achievementPercent >= 33 && achievementPercent <= 66) {
                                card.addClass("bg-warning text-white");
                            } else {
                                card.addClass("bg-success text-white");
                            }
                        },

                        error: function () {
                            console.error("Error fetching COSheet data");
                        }
                    });
                },

                error: function () {
                    console.error("Error fetching Target data");
                }
            });
        }

        $(document).ready(function () {
            loadAnalysisChart();
            loadDashboardData();
        });
    </script>

    <script>
        let fromDate = null;
        let toDate = null;

        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        const today = new Date();
        const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);

        fromDate = formatDate(firstDayOfMonth);
        toDate = formatDate(today);

        flatpickr("#dateRangePicker", {
            mode: "range",
            dateFormat: "Y-m-d",
            defaultDate: [firstDayOfMonth, today],
            onReady: function () {
                loadAnalysisChart(fromDate, toDate);
                loadDashboardData(fromDate, toDate);
                loadTableData2(fromDate, toDate);
            },
            onClose: function (selectedDates, dateStr, instance) {
                if (selectedDates.length === 2) {
                    fromDate = instance.formatDate(selectedDates[0], "Y-m-d");
                    toDate = instance.formatDate(selectedDates[1], "Y-m-d");

                    console.log("From:", fromDate, "To:", toDate);

                    loadAnalysisChart(fromDate, toDate);
                    loadDashboardData(fromDate, toDate);
                    loadTableData2(fromDate, toDate);
                }
            }
        });
    </script>

    <script>
        $(document).ready(function () {
            $("#excelUpload").on("change", function (e) {
                Swal.fire({
                    title: "Uploading...",
                    text: "Please wait while we process your file.",
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                let file = e.target.files[0];
                if (!file) return;

                let reader = new FileReader();
                reader.onload = function (e) {
                    let data = new Uint8Array(e.target.result);
                    let workbook = XLSX.read(data, { type: "array" });

                    let sheetName = workbook.SheetNames[0];
                    let sheet = workbook.Sheets[sheetName];

                    let rawData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                    console.log("Raw Excel Data:", rawData);

                    let rows = rawData.slice(1);

                    let jsonData = rows.map((row, i) => {

                        let dateValue = row[16];
                        if (typeof dateValue === "number") {

                            let jsDate = XLSX.SSF.parse_date_code(dateValue);
                            if (jsDate) {

                                dateValue = `${jsDate.d} ${new Date(jsDate.y, jsDate.m - 1, jsDate.d)
                                    .toLocaleString("en-US", { month: "long" })} ${jsDate.y}`;
                            }
                        }

                        return {
                            collegeDetails: {
                                sr: row[0] || i + 1,
                                collegeName: row[1] || null,
                                coordinatorName: row[2] || null,
                                mobileNumber: row[3] || null,
                                emailId: row[4] || null,
                                city: row[5] || null,
                                state: row[6] || null,
                                course: row[7] || null,
                                mbaFeeApprox: row[8] || null,
                                mbaBatchStrengthApprox: row[9] || null,
                                collegeTier: row[10] || null,
                                collegeLevel: row[11] || null,
                                comment: row[12] || null,
                                corporateRelations: row[13] || null,
                                placementCell: row[14] || null,
                            },
                            connect: {
                                connectedBy: row[15] || null,
                                dateOfConnect: dateValue || null,
                                callResponse: row[17] || null,
                                internshipType: row[18] || null,
                                detailedResponse: row[19] || null,
                            },
                            teamManagerId: teamManagerId
                        };
                    });

                    console.log("Formatted JSON:", jsonData);

                    $.ajax({
                        url: "https://eduroom.in/api/v1/cosheet/add",
                        type: "POST",
                        contentType: "application/json",
                        data: JSON.stringify(jsonData),
                        success: function (res) {
                            console.log("Response:", res);

                            let message = "College data uploaded successfully.";

                            let totalMsg = "";
                            if (res.total) {
                                totalMsg = `<br><br><strong>Total entries:</strong> <strong>${res.total}</strong>`;
                            }

                            let duplicatesMsg = "";
                            if (res.duplicates && res.duplicates > 0) {
                                duplicatesMsg = `<br><strong>Duplicate entries found:</strong> <strong style="color: red;">${res.duplicates}</strong><br>(The duplicate entries were removed.)`;
                            }

                            Swal.fire({
                                icon: "success",
                                title: "Upload Complete",
                                html: `${message}${totalMsg}${duplicatesMsg}`,
                                confirmButtonText: "Okay"
                            });
                        },

                        error: function (xhr) {
                            console.log("Error:", xhr);
                            Swal.fire({
                                icon: "error",
                                title: "Upload Failed",
                                text: xhr.responseText || "Something went wrong!",
                            });
                        },
                    });
                };
                reader.readAsArrayBuffer(file);
            });
        });
    </script>

    <script>
        const teamManagerId2 = sessionStorage.getItem("user_id");
        console.log(teamManagerId2);

        const apiBase = "https://eduroom.in/api/v1/cosheet";

        const dropdowns = {
            city: [],
            state: [],
            course: ["MBA", "PGDM", "MBA+PGDM", "BBA/BCOM", "OTHERS"],
            connectedBy: [],
            callResponse: ["connected", "not answered", "busy", "switch off", "invalid"],
            internshipType: ["fulltime", "sip", "liveproject", "wip", "others"],
            detailedResponse: [
                "Send JD", "Not Interested", "January", "February", "March", "April",
                "May", "June", "July", "August", "September", "October", "November",
                "December", "Cut the call"
            ],
            collegeTier: ["Tier 1", "Tier 2", "Tier 3", "Tier 4", "Tier 5", "Tier 6"],
            collegeLevel: ["Platinum", "Diamond", "Gold", "Silver", "Bronze", "Black"],
        };

        // const colorMap = {
        //     callResponse: {
        //         "connected": "#28a745",
        //         "not answered": "#dc3545",
        //         "busy": "#ffc107",
        //         "switch off": "#0d6efd",
        //         "invalid": "#6c757d"
        //     },
        //     internshipType: {
        //         "fulltime": "#28a745",
        //         "sip": "#0d6efd",
        //         "liveproject": "#ffc107",
        //         "wip": "#0d6efd",
        //         "others": "#adb5bd"
        //     },
        //     detailedResponse: {
        //         "send jd": "#28a745",
        //         "not interested": "#dc3545",
        //         "cut the call": "#ffc107",
        //         "january": "#0d6efd",
        //         "february": "#0d6efd",
        //         "march": "#0d6efd",
        //         "april": "#0d6efd",
        //         "may": "#0d6efd",
        //         "june": "#0d6efd",
        //         "july": "#0d6efd",
        //         "august": "#0d6efd",
        //         "september": "#0d6efd",
        //         "october": "#0d6efd",
        //         "november": "#0d6efd",
        //         "december": "#0d6efd"
        //     }
        // };

        // function getRowBgColor(detailedResponse) {
        //     if (detailedResponse === "" || detailedResponse === null) return 'background-color: #fff;';

        //     const val = detailedResponse.toLowerCase();
        //     if (val === "send jd") return 'background-color: #5cdb5c;';
        //     if (val === "not interested") return 'background-color: #ff4d4d;';
        //     return 'background-color: #ffff80;';
        // }

        function getRowBgColor(detailedResponse) {
            if (detailedResponse === null) return '';

            const val = detailedResponse.toLowerCase();
            if (val === "send jd") return 'background-color: #fff;';
            if (val === "not interested") return 'background-color: #fff;';
            return 'background-color: #fff;';
        }

        let citiesData = [];
        let tableData = [];
        let filteredData = [];
        const rowsPerPage = 10;
        let currentPage = 1;
        let currentRecord = null;
        let attachments = [];
        const MAX_TOTAL_ATTACHMENT_SIZE = 750 * 1024;

        const emailTemplate = {
            fixedTop: (record) => `
                <p>Respected <span class="email-template-variable">${record.coordinatorName || "Sir/Madam"}</span>,</p>
                <p>Warm greetings from FundsAudit!</p>
                <p>We are reaching out with an exciting collaboration opportunity for your institute <span class="email-template-variable">${record.collegeName || ""}</span>, aimed at enhancing student development through real-time industry exposure in the fintech space.</p>
                <p>Founded in 2020, FundsAudit is an ISO-certified, innovation-driven fintech startup, registered under the Startup India initiative with 400,000 active customers. We are members of AMFI, SEBI, BSE, and NSE. As part of our commitment to bridging the gap between academic learning and practical application, we propose a Student Development Program (SDP) for your MBA students (1st & 2nd year) specializing in Finance and Marketing.</p>`,

            editableMiddle: `
                <p><b>Collaboration Proposal:</b></p>
                <ul>
                    <li><b>Flexible Participation:</b> 2-hour/day commitment (1 hour training + 1 hour individual work)</li>
                    <li><b>Performance-Based Stipend:</b> INR 1,000 to INR 7,000 based on quality, innovation, and project delivery</li>
                    <li><b>Value-Added Certifications:</b> Specialized certificates + POWER-Bi & Financial/Marketing Modelling certificate; recognition for top performers</li>
                    <li><b>Open to:</b> MBA 1st & 2nd year students (Finance & Marketing)</li>
                </ul>
                <p>Next Steps: JD for the Internship is attached. If your institution is interested, we can formalize this collaboration by signing a Memorandum of Understanding (MoU). Upon signing, eligible students will be onboarded with orientation and training to commence the live project.</p>
                <p>As discussed on the call, kindly share your response by <b>23rd August 2025, 11 AM</b>. Preplacement interviews will be conducted on the same day, with joining on <b>25th August 2025</b>.</p>
                <p><b>Role:</b> Marketing Analyst & Financial Analyst<br/>
                <b>Eligibility:</b> Management Students</p>
                <p>Following the live project, students may also be considered for:</p>
                <ul>
                    <li>Summer/Winter Internships</li>
                    <li>Pre-placement offers (PPOs)</li>
                    <li>Final placement opportunities</li>
                </ul>
                <p>Perks of the collaboration:</p>
                <ul>
                    <li>Exposure to real-time fintech operations</li>
                    <li>Skill development aligned with industry expectations</li>
                    <li>Improved employability and practical insight alongside academics</li>
                    <li>Final placement opportunities</li>
                </ul>`,

            fixedBottom: `
                <p>Looking forward to a meaningful and mutually beneficial association.</p>
                <p>Pooja M. Shedge<br/>
                Branch Manager - Pune<br/>
                +91 7385234536 | +91 7420861507<br/>
                Pune, Maharashtra<br/>
                <a href="https://www.fundsaudit.in/">https://www.fundsaudit.in/</a><br/>
                <a href="https://www.fundsweb.in/sub_sectors/subsector">https://www.fundsweb.in/sub_sectors/subsector</a>
                </p>`
        };

        function loadCities() {
            return fetch("/profile/dashboard/cities.json")
                .then(res => res.json())
                .then(data => {
                    citiesData = data;
                    dropdowns.state = [...new Set(data.map(item => item.state))];
                })
                .catch(err => console.error("Failed to load cities.json:", err));
        }

        function loadTableData() {
            $.ajax({
                url: apiBase + "/list",
                method: "GET",
                success: function (res) {
                    console.log("master sheet:", res);
                    if (res.success && res.managers) {
                        tableData = res.data.map((row, index) => ({
                            sno: index + 1,
                            id: row.id,
                            collegeName: row.collegeName || "",
                            coordinatorName: row.coordinatorName || "",
                            mobileNumber: row.mobileNumber || "",
                            emailId: row.emailId || "",
                            placementCell: row.placementCell || "",
                            mbaFeeApprox: row.mbaFeeApprox || "",
                            mbaBatchStrengthApprox: row.mbaBatchStrengthApprox || "",
                            state: row.state || "",
                            city: row.city || "",
                            collegeTier: row.collegeTier || "",
                            collegeLevel: row.collegeLevel || "",
                            comment: row.comment || "",
                            corporateRelations: row.corporateRelations || "",
                            course: row.course || "",
                            connectedBy: row.connectedBy || "",
                            dateOfConnect: row.dateOfConnect || "",
                            callResponse: row.callResponse || "",
                            internshipType: row.internshipType || "",
                            detailedResponse: row.detailedResponse || "",
                        }));

                        dropdowns.connectedBy = res.managers.map(u => u.name);
                        dropdowns.connectedBy.push("Other");
                        console.log("ConnectedBy options:", dropdowns.connectedBy);

                        sessionStorage.setItem("users_list", JSON.stringify(res.managers));

                        const totalColleges = tableData.length;
                        document.getElementById("collegeCount").textContent = totalColleges;

                        filteredData = [...tableData];
                        renderTable();
                        renderPagination();
                        renderColumnFilters();

                        initEmailModalEvents();
                    }
                }
            });
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    const base64String = reader.result.split(',')[1];
                    resolve(base64String);
                };
                reader.onerror = error => reject(error);
            });
        }

        function initEmailModalEvents() {
            $('#composeMail').on('show.bs.modal', function (e) {
                attachments = [];
                $('#attachmentContainer').empty();

                const button = $(e.relatedTarget);
                const recordId = button.data('id');
                const record = tableData.find(row => row.id == recordId);

                if (record) {
                    currentRecord = record;
                    loadEmailModal(record);

                    setTimeout(() => {
                        const editableDiv = document.getElementById('mailEditorModal');
                        if (editableDiv) {
                            editableDiv.focus();
                            const range = document.createRange();
                            range.selectNodeContents(editableDiv);
                            range.collapse(true);
                            const selection = window.getSelection();
                            selection.removeAllRanges();
                            selection.addRange(range);
                        }
                    }, 100);
                }
            });

            $('#addAttachmentBtn').off('click').on('click', function () {
                $('#fileInput').click();
            });

            $('#fileInput').off('change').on('change', function (e) {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;

                const totalCurrentSize = attachments.reduce((sum, att) => sum + att.size, 0);
                const newFilesTotalSize = files.reduce((sum, file) => sum + file.size, 0);
                const projectedTotalSize = totalCurrentSize + newFilesTotalSize;

                if (projectedTotalSize > MAX_TOTAL_ATTACHMENT_SIZE) {
                    Swal.fire({
                        icon: 'error',
                        title: 'File Size Limit Exceeded',
                        html: `Cannot add these files. Total size would be ${formatFileSize(projectedTotalSize)}, which exceeds the limit of ${formatFileSize(MAX_TOTAL_ATTACHMENT_SIZE)}.<br><br>
                           Current attachments: ${formatFileSize(totalCurrentSize)}<br>
                           New files: ${formatFileSize(newFilesTotalSize)}<br>
                           Please reduce file sizes or select fewer files.`,
                        confirmButtonText: 'OK'
                    });
                    $(this).val('');
                    return;
                }

                files.forEach(file => {
                    addAttachment(file);
                });

                $(this).val('');
            });

            $('#mailEditorModal').on('input', function () {
                updateEmailPreview();
            });

            $('#sendEmailBtn').off('click').on('click', function () {
                sendJDEmail();
            });

            $('#copyEmailBtn').off('click').on('click', function () {
                copyEmailBody();
            });
        }

        function getTotalAttachmentSize() {
            return attachments.reduce((total, att) => total + att.size, 0);
        }

        async function addAttachment(file) {
            try {
                const fileId = Date.now() + Math.random().toString(36).substr(2, 9);

                const base64Content = await fileToBase64(file);
                attachments.push({
                    id: fileId,
                    filename: file.name,
                    size: file.size,
                    type: file.type,
                    content: base64Content,
                    file: file
                });

                const attachmentElement = `
                    <div class="attachment-item d-flex align-items-center justify-content-between p-2 mb-1 border rounded" data-id="${fileId}">
                        <div class="d-flex align-items-center">
                            <i class="feather-file-text me-2 text-primary"></i>
                            <div>
                                <div class="small fw-semibold">${file.name}</div>
                                <div class="text-muted small">${formatFileSize(file.size)}</div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-sm btn-link text-danger remove-attachment" data-id="${fileId}">
                            <i class="feather-x"></i>
                        </button>
                    </div>
                `;

                $('#attachmentContainer').append(attachmentElement);

                $(`.remove-attachment[data-id="${fileId}"]`).off('click').on('click', function () {
                    const id = $(this).data('id');
                    removeAttachment(id);
                });

                updateAttachmentSizeInfo();

            } catch (error) {
                console.error('Error adding attachment:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to add attachment. Please try again.'
                });
            }
        }

        function removeAttachment(fileId) {
            attachments = attachments.filter(att => att.id !== fileId);
            $(`.attachment-item[data-id="${fileId}"]`).remove();
            updateAttachmentSizeInfo();
        }

        function updateAttachmentSizeInfo() {
            const totalSize = getTotalAttachmentSize();
            const sizeInfo = `Total: ${formatFileSize(totalSize)} / ${formatFileSize(MAX_TOTAL_ATTACHMENT_SIZE)}`;

            let sizeInfoElement = $('#attachmentSizeInfo');
            if (sizeInfoElement.length === 0) {
                $('#attachmentContainer').before(`
                <div id="attachmentSizeInfo" class="small text-muted mb-2 px-1">
                    ${sizeInfo}
                </div>
            `);
            } else {
                sizeInfoElement.text(sizeInfo);
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function loadEmailModal(record) {
            $('#currentRecordId').val(record.id);
            $('#email-input').val(record.emailId || '');
            $('#email-fixed-top').html(emailTemplate.fixedTop(record));
            $('#mailEditorModal').html(emailTemplate.editableMiddle);
            $('#email-fixed-bottom').html(emailTemplate.fixedBottom);
            updateEmailPreview();
        }

        function updateEmailPreview() {
            const record = currentRecord;
            if (!record) return;

            const editableContent = $('#mailEditorModal').html();

            const fullEmailBody = `
            ${emailTemplate.fixedTop(record)}
            ${editableContent}
            ${emailTemplate.fixedBottom}
        `;

            $('#emailPreview').html(fullEmailBody);
        }

        function getFullEmailBody() {
            const record = currentRecord;
            if (!record) return '';

            const editableContent = $('#mailEditorModal').html();

            const fixedTopHtml = emailTemplate.fixedTop(record)
                .replace(/<span class="email-template-variable">/g, '')
                .replace(/<\/span>/g, '');

            return `
            ${editableContent}
        `;
        }

        async function sendJDEmail() {
            const recordId = $('#currentRecordId').val();
            const record = tableData.find(row => row.id == recordId);

            if (!record) {
                Swal.fire({
                    icon: "error",
                    title: "Error",
                    text: "Record not found!"
                });
                return;
            }

            const cc = $('[name="ccmailmodal"]').val() ? [$('[name="ccmailmodal"]').val()] : [];
            const bcc = $('[name="bccmailmodal"]').val() ? [$('[name="bccmailmodal"]').val()] : [];
            const emailBody = getFullEmailBody();
            const subject = $('#subject-input').val() || "Internship Opportunity - FundsAudit Student Development Program";

            const totalAttachmentSize = getTotalAttachmentSize();
            if (totalAttachmentSize > MAX_TOTAL_ATTACHMENT_SIZE) {
                Swal.fire({
                    icon: "error",
                    title: "Attachment Size Limit Exceeded",
                    html: `Total attachment size (${formatFileSize(totalAttachmentSize)}) exceeds the limit of ${formatFileSize(MAX_TOTAL_ATTACHMENT_SIZE)}.<br><br>
                       Please remove some attachments to proceed.`,
                    confirmButtonText: "OK"
                });
                return;
            }

            const attachmentPayload = [];
            for (const att of attachments) {
                attachmentPayload.push({
                    filename: att.filename,
                    content: att.content
                });
            }

            Swal.fire({
                title: "Send JD Mail?",
                html: `<div class="text-start">
                    <p>Send internship JD to ${record.coordinatorName || 'coordinator'} at ${record.collegeName || 'college'}?</p>
                    ${attachments.length > 0 ? `
                    <p><strong>Attachments (${attachments.length}):</strong></p>
                    <ul class="small mb-0">
                        ${attachments.map(att => `<li>${att.filename} (${formatFileSize(att.size)})</li>`).join('')}
                    </ul>
                    <p class="small text-muted mt-2">Total size: ${formatFileSize(totalAttachmentSize)} / ${formatFileSize(MAX_TOTAL_ATTACHMENT_SIZE)}</p>
                    ` : ''}
                </div>`,
                icon: "question",
                showCancelButton: true,
                confirmButtonText: "Yes, Send",
                cancelButtonText: "Cancel",
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33"
            }).then(async (result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: "Sending...",
                        text: attachments.length > 0 ? "Sending email with attachments..." : "Sending email...",
                        allowOutsideClick: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });

                    const payload = {
                        cc: cc,
                        bcc: bcc,
                        teamManagerId: teamManagerId2,
                        subject: subject,
                        body: emailBody,
                        attachment: attachmentPayload
                    };

                    console.log("Sending payload with attachments:", {
                        ...payload,
                        attachment: attachmentPayload.map(att => ({
                            filename: att.filename,
                            content: att.content.substring(0, 50) + '...'
                        }))
                    });

                    $.ajax({
                        url: apiBase + "/" + recordId + "/send-jd",
                        method: "POST",
                        contentType: "application/json",
                        data: JSON.stringify(payload),
                        success: function (res) {
                            Swal.fire({
                                icon: "success",
                                title: "Mail Sent!",
                                text: attachments.length > 0 ?
                                    `Email with ${attachments.length} attachment(s) sent successfully.` :
                                    "The JD mail was sent successfully."
                            });

                            attachments = [];
                            $('#attachmentContainer').empty();
                            $('#attachmentSizeInfo').remove();

                            $('#composeMail').modal('hide');
                            updateDetailedResponse(recordId);
                        },
                        error: function (err) {
                            console.error("Error sending email:", err);
                            Swal.fire({
                                icon: "error",
                                title: "Error",
                                text: "Failed to send the JD mail. Please try again."
                            });
                        }
                    });
                }
            });
        }

        function updateDetailedResponse(recordId) {
            const payload = {
                detailedResponse: "Send JD"
            };

            $.ajax({
                url: apiBase + "/update/" + recordId,
                method: "PUT",
                contentType: "application/json",
                data: JSON.stringify(payload),
                success: function (res) {
                    console.log("Updated detailed response to 'Send JD'");
                    loadTableData();
                },
                error: function (err) {
                    console.error("Failed to update detailed response", err);
                }
            });
        }

        function copyEmailBody() {
            const emailBody = getFullEmailBody();
            const plainText = emailBody.replace(/<[^>]*>/g, '')
                .replace(/&nbsp;/g, ' ')
                .replace(/&lt;/g, '<')
                .replace(/&gt;/g, '>')
                .replace(/&amp;/g, '&')
                .trim();

            navigator.clipboard.writeText(plainText).then(() => {
                Swal.fire({
                    icon: "success",
                    title: "Copied!",
                    text: "Email body copied to clipboard",
                    timer: 2000,
                    showConfirmButton: false
                });
            }).catch(err => {
                console.error("Failed to copy:", err);
                Swal.fire({
                    icon: "error",
                    title: "Error",
                    text: "Failed to copy to clipboard"
                });
            });
        }

        function renderTable() {
            filteredData.sort((a, b) => b.id - a.id);
            let tbody = $("#leadsTable tbody");
            tbody.empty();

            const start = (currentPage - 1) * rowsPerPage;
            const end = start + rowsPerPage;
            const rows = filteredData.slice(start, end);

            rows.forEach((row, index) => {
                const rowBgStyle = getRowBgColor(row.detailedResponse);
                let tr = `<tr data-id="${row.id}" style="${rowBgStyle}">
                    <td>
                        <button class="btn btn-sm btn-danger delete-record" data-id="${row.id}" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                    <td>${start + index + 1}</td>
                    ${makeCell("collegeName", row.collegeName)}
                    ${makeCell("coordinatorName", row.coordinatorName)}
                    ${makeCell("mobileNumber", row.mobileNumber)}
                    ${makeCell("emailId", row.emailId)}
                    ${makeCell("placementCell", row.placementCell)}
                    ${makeCell("mbaFeeApprox", row.mbaFeeApprox)}
                    ${makeCell("mbaBatchStrengthApprox", row.mbaBatchStrengthApprox)}
                    ${makeDropdownCell("state", row.state)}
                    ${makeDropdownCell("city", row.city, row.state)}
                    ${makeDropdownCell("collegeTier", row.collegeTier)}
                    ${makeDropdownCell("collegeLevel", row.collegeLevel)}
                    ${makeCell("comment", row.comment)}
                    ${makeCell("corporateRelations", row.corporateRelations)}
                    ${makeDropdownCell("course", row.course)}
                    ${makeDropdownCell("connectedBy", row.connectedBy)}
                    ${makeDateCell("dateOfConnect", row.dateOfConnect)}
                    ${makeDropdownCell("callResponse", row.callResponse)}
                    ${makeDropdownCell("internshipType", row.internshipType)}
                    ${makeDropdownCell("detailedResponse", row.detailedResponse)} 
                    <td>
                        <button class="btn btn-sm btn-success" data-id="${row.id}" data-bs-toggle="modal" 
                                data-bs-target="#composeMail" title="Send JD">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </td>
                    </tr>`;
                tbody.append(tr);
            });

            attachCellEvents();
            setStickyColumns();
        }

        function renderPagination() {
            const totalPages = Math.ceil(filteredData.length / rowsPerPage);
            const pagination = $("#pagination");
            pagination.empty();

            const visiblePageCount = 3;
            let startPage = Math.max(currentPage - 1, 1);
            let endPage = startPage + visiblePageCount - 1;
            if (endPage > totalPages) {
                endPage = totalPages;
                startPage = Math.max(endPage - visiblePageCount + 1, 1);
            }

            const prevDisabled = currentPage === 1 ? 'disabled' : '';
            const nextDisabled = currentPage === totalPages ? 'disabled' : '';

            pagination.append(`<li><a href="javascript:void(0);" class="${prevDisabled}" onclick="changePage(${currentPage - 1})">&laquo;</a></li>`);

            for (let i = startPage; i <= endPage; i++) {
                const active = i === currentPage ? "active" : "";
                pagination.append(`<li><a href="javascript:void(0);" class="${active}" onclick="changePage(${i})">${i}</a></li>`);
            }

            pagination.append(`<li><a href="javascript:void(0);" class="${nextDisabled}" onclick="changePage(${currentPage + 1})">&raquo;</a></li>`);
        }

        window.changePage = function (page) {
            const totalPages = Math.ceil(filteredData.length / rowsPerPage);
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            renderTable();
            renderPagination();
        };

        function renderColumnFilters() {
            const headerRow = $("#leadsTable thead tr.filters");
            headerRow.remove();

            let filterRow = "<tr class='filters'>";
            $("#leadsTable thead tr:first th").each(function (i, th) {
                if (i === 0 || i === 1 || i === 21) {
                    filterRow += "<th></th>";
                } else {
                    filterRow += `<th><select class="column-filter form-select form-select-sm" data-index="${i}">
                    <option value="">All</option>
                </select></th>`;
                }
            });
            filterRow += "</tr>";
            $("#leadsTable thead").append(filterRow);

            populateColumnFilterOptions();
        }

        function populateColumnFilterOptions() {
            $("#leadsTable thead .column-filter").each(function () {
                const index = $(this).data("index");
                let values = [...new Set(tableData.map(row => Object.values(row)[index]))];

                values = values.filter(v => v && v.trim() !== "");

                let formattedValues = values;

                if ($("#leadsTable thead tr:first th").eq(index).text().toLowerCase().includes("date")) {
                    formattedValues = values.map(v => {
                        let d = new Date(v);
                        if (!isNaN(d)) {
                            return {
                                raw: v,
                                display: d.toLocaleDateString("en-GB", {
                                    day: "numeric",
                                    month: "long",
                                    year: "numeric"
                                })
                            };
                        }
                        return { raw: v, display: v };
                    });
                } else {
                    formattedValues = values.map(v => ({ raw: v, display: v }));
                }

                formattedValues.sort((a, b) => a.display.localeCompare(b.display));

                formattedValues.forEach(v => {
                    $(this).append(`<option value="${v.raw}">${v.display}</option>`);
                });
            });

            $(".column-filter").off("change").on("change", function () {
                applyFilters();
            });
        }

        function applyFilters() {
            filteredData = [...tableData];
            $("#leadsTable thead .column-filter").each(function () {
                const value = $(this).val();
                const index = $(this).data("index");
                if (value) {
                    filteredData = filteredData.filter(row => {
                        const cellValue = Object.values(row)[index] || "";
                        return cellValue.toLowerCase() === value.toLowerCase();
                    });
                }
            });
            currentPage = 1;
            renderTable();
            renderPagination();
        }

        function makeCell(field, value) {
            let displayValue = value || "";

            if (field === "mobileNumber" && value) {
                const numbers = value.split("/").map(num => num.trim());

                const links = numbers.map(num =>
                    `<a href="tel:${num}" class="text-primary text-decoration-none me-2">${num}</a>`
                ).join(" | ");

                return `<td data-field="${field}">
                <span>${links}</span>
                <input type="text" value="${displayValue}">
            </td>`;
            }

            return `<td data-field="${field}">
            <span>${displayValue}</span>
            <input type="text" value="${displayValue}">
            </td>`;
        }

        function makeDateCell(field, value) {
            let displayValue = formatDate(value);
            let rawValue = value ? new Date(value).toISOString().split("T")[0] : "";
            return `<td data-field="${field}">
            <span>${displayValue}</span>
            <input type="text" class="date-picker" value="${rawValue}">
            </td>`;
        }

        function formatDate(dateStr) {
            if (!dateStr) return "";
            let date = new Date(dateStr);
            if (isNaN(date)) return dateStr;
            return date.toLocaleDateString("en-GB", {
                day: "numeric",
                month: "long",
                year: "numeric"
            });
        }

        function makeDropdownCell(field, selectedValue, stateFilter = null) {
            let options = dropdowns[field] || [];

            if (field === "city" && stateFilter) {
                options = citiesData.filter(c => c.state === stateFilter).map(c => c.name);
            }

            function capitalize(str) {
                return str.replace(/\b\w/g, c => c.toUpperCase());
            }

            let displaySelected = selectedValue ? capitalize(selectedValue) : "";

            let bgColor = "";
            // if (colorMap[field] && selectedValue) {
            //     bgColor = colorMap[field][selectedValue.toLowerCase()] || "";
            // }

            let html = `<td data-field="${field}" style="background-color:${bgColor};">
            <span style="color:black; font-weight:bold;">${displaySelected}</span>
            <select class="form-control select2">`;

            html += `<option value="" ${!selectedValue ? "selected" : ""}></option>`;

            options.forEach(opt => {
                let sel = (opt === selectedValue) ? "selected" : "";
                html += `<option value="${opt}" ${sel}>${capitalize(opt)}</option>`;
            });

            html += `</select></td>`;
            return html;
        }

        function attachCellEvents() {
            $("#leadsTable td").off("dblclick").on("dblclick", function () {
                let td = $(this);
                td.addClass("editing");
                td.find("input,select").focus();
            });

            $("#leadsTable td[data-field='mobileNumber']").off("dblclick").on("dblclick", function (e) {
                e.preventDefault();
                let td = $(this);
                td.addClass("editing");
                td.find("input").focus();
            });

            $("#leadsTable td input, #leadsTable td select")
                .off("blur change")
                .on("blur change", function () {
                    if ($(this).hasClass("date-picker")) return;

                    let td = $(this).closest("td");
                    let tr = $(this).closest("tr");
                    let id = tr.data("id");
                    let field = td.data("field");
                    let value = $(this).val();

                    function capitalize(str) {
                        return str.replace(/\b\w/g, c => c.toUpperCase());
                    }

                    if ($(this).is("select")) {
                        let displayText = capitalize(value);
                        let bgColor = "";
                        // if (colorMap[field] && value) {
                        //     bgColor = colorMap[field][value.toLowerCase()] || "";
                        // }
                        td.css("background-color", bgColor);
                        td.find("span").css("color", "black").css("font-weight", "bold").text(displayText);
                    } else {
                        td.find("span").text(value);
                    }
                    td.removeClass("editing");

                    let payload = {};
                    payload[field] = value;

                    $.ajax({
                        url: apiBase + "/update/" + id,
                        method: "PUT",
                        contentType: "application/json",
                        data: JSON.stringify(payload),
                        success: function (res) {
                            console.log("Updated:", res);

                            if (field === "state") {
                                const cityTd = tr.find("td[data-field='city']");
                                const newCityDropdown = makeDropdownCell("city", "", value);
                                cityTd.replaceWith(newCityDropdown);
                                attachCellEvents();
                            }
                        },
                        error: function (err) {
                            console.error("Update failed", err);
                        }
                    });
                });

            $(".date-picker").each(function () {
                const input = $(this);
                input.flatpickr({
                    dateFormat: "Y-m-d",
                    onChange: function (selectedDates, dateStr) {
                        if (!dateStr) return;

                        let td = input.closest("td");
                        let tr = input.closest("tr");
                        let id = tr.data("id");
                        let field = td.data("field");
                        let value = new Date(dateStr).toISOString().split("T")[0];

                        td.find("span").text(formatDate(value));
                        td.removeClass("editing");

                        let payload = {};
                        payload[field] = value;

                        $.ajax({
                            url: apiBase + "/update/" + id,
                            method: "PUT",
                            contentType: "application/json",
                            data: JSON.stringify(payload),
                            success: function (res) {
                                console.log("Updated:", res);
                            },
                            error: function (err) {
                                console.error("Update failed", err);
                            }
                        });
                    }
                });
            });
        }

        window.filterTable = function () {
            const value = $("#searchInput").val().toLowerCase().trim();
            if (!value) {
                renderTable();
                renderPagination();
                return;
            }

            const filtered = tableData.filter((row) =>
                Object.values(row).some((field) => {
                    const plainText = $('<div>').html(field).text().toLowerCase().trim();
                    return plainText.includes(value);
                })
            );

            const tbody = $("#leadsTable tbody");
            tbody.empty();
            filtered.forEach((row, index) => {
                const tr = `<tr data-id="${row.id}">
                    <td>
                        <button class="btn btn-sm btn-danger delete-record" data-id="${row.id}" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                    <td>${index + 1}</td>
                    ${makeCell("collegeName", row.collegeName)}
                    ${makeCell("coordinatorName", row.coordinatorName)}
                    ${makeCell("mobileNumber", row.mobileNumber)}
                    ${makeCell("emailId", row.emailId)}
                    ${makeCell("placementCell", row.placementCell)}
                    ${makeCell("mbaFeeApprox", row.mbaFeeApprox)}
                    ${makeCell("mbaBatchStrengthApprox", row.mbaBatchStrengthApprox)}
                    ${makeDropdownCell("state", row.state)}
                    ${makeDropdownCell("city", row.city, row.state)}
                    ${makeDropdownCell("collegeTier", row.collegeTier)}
                    ${makeDropdownCell("collegeLevel", row.collegeLevel)}
                    ${makeCell("comment", row.comment)}
                    ${makeDropdownCell("corporateRelations", row.corporateRelations)}
                    ${makeDropdownCell("course", row.course)}
                    ${makeDropdownCell("connectedBy", row.connectedBy)}
                    ${makeDateCell("dateOfConnect", row.dateOfConnect)}
                    ${makeDropdownCell("callResponse", row.callResponse)}
                    ${makeDropdownCell("internshipType", row.internshipType)}
                    ${makeDropdownCell("detailedResponse", row.detailedResponse)}
                    <td>
                        <button class="btn btn-sm btn-success" data-id="${row.id}" data-bs-toggle="modal" 
                                data-bs-target="#composeMail" title="Send JD">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </td>
                </tr>`;
                tbody.append(tr);
            });

            $("#pagination").hide();
            attachCellEvents();
        };

        window.printTable = function () {
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write('<html><head><title>Print Table</title></head><body>');
            printWindow.document.write($("#leadsTable")[0].outerHTML);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        };

        window.exportToExcel = async function () {
            const isVerified = sessionStorage.getItem("excel_export_verified");

            if (!isVerified) {
                try {
                    const response = await fetch("/config.json");
                    const config = await response.json();
                    const correctPassword = config.exportPassword;

                    const { value: enteredPassword } = await Swal.fire({
                        title: "Enter Export Password",
                        input: "password",
                        inputPlaceholder: "Enter password",
                        showCancelButton: true,
                        confirmButtonText: "Verify",
                        cancelButtonText: "Cancel",
                        inputValidator: (value) => {
                            if (!value) {
                                return "Password is required";
                            }
                        }
                    });

                    if (!enteredPassword) return;

                    if (enteredPassword !== correctPassword) {
                        Swal.fire({
                            icon: "error",
                            title: "Invalid Password",
                            text: "You are not authorized to export this data"
                        });
                        return;
                    }

                    sessionStorage.setItem("excel_export_verified", "true");

                } catch (error) {
                    Swal.fire({
                        icon: "error",
                        title: "Error",
                        text: "Unable to verify password"
                    });
                    return;
                }
            }

            const headers = [
                "S No.",
                "College Name",
                "Coordinator Name",
                "Mobile Number",
                "Email ID",
                "Placement Cell",
                "MBA Fee Approx",
                "MBA Batch Strength Approx",
                "State",
                "City",
                "College Tier",
                "College Level",
                "Comment",
                "Corporate Relations",
                "Course",
                "Connected By",
                "Date of Connect",
                "Call Response",
                "Internship Type",
                "Detailed Response"
            ];

            const data = [headers];

            tableData.forEach((row, index) => {
                data.push([
                    index + 1,
                    row.collegeName,
                    row.coordinatorName,
                    row.mobileNumber,
                    row.emailId,
                    row.placementCell,
                    row.mbaFeeApprox,
                    row.mbaBatchStrengthApprox,
                    row.state,
                    row.city,
                    row.collegeTier,
                    row.collegeLevel,
                    row.comment,
                    row.corporateRelations,
                    row.course,
                    row.connectedBy,
                    row.dateOfConnect,
                    row.callResponse,
                    row.internshipType,
                    row.detailedResponse
                ]);
            });

            const worksheet = XLSX.utils.aoa_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "CollegeDetails");
            XLSX.writeFile(workbook, "CollegeDetails_All.xlsx");
        };

        $(document).ready(function () {
            loadCities().then(() => {
                loadTableData();
            });
        });
    </script>

    <script>
        var userData2 = JSON.parse(sessionStorage.getItem("user_data"));
        var userName = sessionStorage.getItem("userName");
        console.log(userData2);

        const apiBase2 = "https://eduroom.in/api/v1/cosheet";

        const dropdowns2 = {
            city: [],
            state: [],
            course: ["MBA", "PGDM", "MBA+PGDM", "BBA/BCOM", "OTHERS"],
            connectedBy: [],
            callResponse: ["connected", "not answered", "busy", "switch off", "invalid"],
            internshipType: ["fulltime", "sip", "liveproject", "wip", "others"],
            detailedResponse: [
                "Send JD", "Not Interested", "January", "February", "March", "April",
                "May", "June", "July", "August", "September", "October", "November",
                "December", "Cut the call"
            ]
        };

        // const colorMap2 = {
        //     callResponse: {
        //         "connected": "#28a745",
        //         "not answered": "#dc3545",
        //         "busy": "#ffc107",
        //         "switch off": "#0d6efd",
        //         "invalid": "#6c757d"
        //     },
        //     internshipType: {
        //         "fulltime": "#28a745",
        //         "sip": "#0d6efd",
        //         "liveproject": "#ffc107",
        //         "wip": "#0d6efd",
        //         "others": "#adb5bd"
        //     },
        //     detailedResponse: {
        //         "send jd": "#28a745",
        //         "not interested": "#dc3545",
        //         "cut the call": "#ffc107",
        //         "january": "#0d6efd",
        //         "february": "#0d6efd",
        //         "march": "#0d6efd",
        //         "april": "#0d6efd",
        //         "may": "#0d6efd",
        //         "june": "#0d6efd",
        //         "july": "#0d6efd",
        //         "august": "#0d6efd",
        //         "september": "#0d6efd",
        //         "october": "#0d6efd",
        //         "november": "#0d6efd",
        //         "december": "#0d6efd"
        //     }
        // };

        // function getRowBgColor2(detailedResponse) {
        //     if (detailedResponse === null || detailedResponse === "") return 'background-color: #fff;';

        //     const val = detailedResponse.toLowerCase();
        //     if (val === "send jd") return 'background-color: #5cdb5c;';
        //     if (val === "not interested") return 'background-color: #ff4d4d;';
        //     return 'background-color: #ffff80;';
        // }

        function getRowBgColor2(detailedResponse) {
            if (detailedResponse === null || detailedResponse === "") return 'background-color: #fff;';

            const val = detailedResponse.toLowerCase();
            if (val === "send jd") return 'background-color: #fff;';
            if (val === "not interested") return 'background-color: #fff;';
            return 'background-color: #fff;';
        }

        let citiesData2 = [];
        let tableData2 = [];
        let filteredData2 = [];
        const rowsPerPage2 = 10;
        let currentPage2 = 1;

        function loadCities2() {
            return fetch("/profile/dashboard/cities.json")
                .then(res => res.json())
                .then(data => {
                    citiesData2 = data;
                    dropdowns2.state = [...new Set(data.map(item => item.state))];
                })
                .catch(err => console.error("Failed to load cities.json:", err));
        }

        function loadTableData2(startDate = null, endDate = null) {
            $.ajax({
                url: `https://eduroom.in/api/v1/cosheet/list/${userName}`,
                method: "GET",
                success: function (res) {
                    console.log("master sheet 2:", res);
                    if (res.success && res.managers) {

                        tableData2 = res.data.map((row, index) => ({
                            sno: index + 1,
                            id: row.id,
                            collegeName: row.collegeName || "",
                            coordinatorName: row.coordinatorName || "",
                            mobileNumber: row.mobileNumber || "",
                            emailId: row.emailId || "",
                            // placementCell: row.placementCell || "",
                            // mbaFeeApprox: row.mbaFeeApprox || "",
                            // mbaBatchStrengthApprox: row.mbaBatchStrengthApprox || "",
                            state: row.state || "",
                            city: row.city || "",
                            // collegeTier: row.collegeTier || "",
                            // collegeLevel: row.collegeLevel || "",
                            // comment: row.comment || "",
                            // corporateRelations: row.corporateRelations || "",
                            course: row.course || "",
                            connectedBy: row.connectedBy || "",
                            dateOfConnect: row.dateOfConnect || "",
                            callResponse: row.callResponse || "",
                            internshipType: row.internshipType || "",
                            detailedResponse: row.detailedResponse || "",
                        }));

                        dropdowns2.connectedBy = res.managers.map(u => u.name);
                        dropdowns2.connectedBy.push("Other");
                        console.log("ConnectedBy options 2:", dropdowns2.connectedBy);

                        sessionStorage.setItem("users_list2", JSON.stringify(res.managers));

                        filteredData2 = [...tableData2];

                        if (managerName2) {
                            filteredData2 = filteredData2.filter(row => row.connectedBy === managerName2);
                        }

                        if (startDate && endDate) {
                            filteredData2 = filteredData2.filter(row => {
                                if (!row.dateOfConnect) return false;
                                let d = new Date(row.dateOfConnect);
                                let s = new Date(startDate);
                                let e = new Date(endDate);
                                return d >= s && d <= e;
                            });
                        }

                        filteredData2 = filteredData2.filter(row => row.callResponse && row.callResponse.toLowerCase() === "connected");

                        filteredData2 = filteredData2.map((row, index) => ({
                            ...row,
                            sno: index + 1
                        }));

                        const totalColleges = filteredData2.length;
                        const countEl = document.getElementById("collegeCount2");
                        if (countEl) countEl.textContent = totalColleges;

                        renderTable2();
                        renderPagination2();
                        renderColumnFilters2();
                    }
                }
            });
        }

        function getBaseFilteredData2() {
            let base = [...tableData2];

            if (userData2 && userData2.name) {
                base = base.filter(row => row.connectedBy === userData2.name);
            }

            base = base.filter(row => row.callResponse && row.callResponse.toLowerCase() === "connected");

            return base;
        }

        function renderTable2() {
            let tbody = $("#leadsTable2 tbody");
            tbody.empty();

            filteredData2.sort((a, b) => b.id - a.id);

            const start = (currentPage2 - 1) * rowsPerPage2;
            const end = start + rowsPerPage2;
            const rows = filteredData2.slice(start, end);

            rows.forEach((row, index) => {
                const rowBgStyle = getRowBgColor2(row.detailedResponse);
                let srNo = start + index + 1;
                let tr = `<tr data-id="${row.id}" style="${rowBgStyle}">
            <td>
                <button class="btn btn-sm btn-danger delete-record" data-id="${row.id}" title="Delete">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
            <td>${srNo}</td>
            ${makeCell2("collegeName", row.collegeName)}
            ${makeCell2("coordinatorName", row.coordinatorName)}
            ${makeCell2("mobileNumber", row.mobileNumber)}
            ${makeCell2("emailId", row.emailId)}
            ${makeDropdownCell2("state", row.state)}
            ${makeDropdownCell2("city", row.city, row.state)}
            ${makeDropdownCell2("course", row.course)}
            ${makeDropdownCell2("connectedBy", row.connectedBy)}
            ${makeDateCell2("dateOfConnect", row.dateOfConnect)}
            ${makeDropdownCell2("callResponse", row.callResponse)}
            ${makeDropdownCell2("internshipType", row.internshipType)}
            ${makeDropdownCell2("detailedResponse", row.detailedResponse)}   
            <td>
                <button class="btn btn-sm btn-success" data-id="${row.id}" data-bs-toggle="modal" 
                        data-bs-target="#composeMail" title="Send JD">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </td>
            </tr>`;
                tbody.append(tr);
            });

            attachCellEvents2();
            attachSendMailEvents2();
            setStickyColumns2();
        }

        function renderPagination2() {
            const totalPages = Math.ceil(filteredData2.length / rowsPerPage2);
            const pagination = $("#pagination2");
            pagination.empty();

            const visiblePageCount = 3;
            let startPage = Math.max(currentPage2 - 1, 1);
            let endPage = startPage + visiblePageCount - 1;
            if (endPage > totalPages) {
                endPage = totalPages;
                startPage = Math.max(endPage - visiblePageCount + 1, 1);
            }

            const prevDisabled = currentPage2 === 1 ? 'disabled' : '';
            const nextDisabled = currentPage2 === totalPages ? 'disabled' : '';

            pagination.append(`<li><a href="javascript:void(0);" class="${prevDisabled}" onclick="changePage2(${currentPage2 - 1})">&laquo;</a></li>`);

            for (let i = startPage; i <= endPage; i++) {
                const active = i === currentPage2 ? "active" : "";
                pagination.append(`<li><a href="javascript:void(0);" class="${active}" onclick="changePage2(${i})">${i}</a></li>`);
            }

            pagination.append(`<li><a href="javascript:void(0);" class="${nextDisabled}" onclick="changePage2(${currentPage2 + 1})">&raquo;</a></li>`);
        }

        window.changePage2 = function (page) {
            const totalPages = Math.ceil(filteredData2.length / rowsPerPage2);
            if (page < 1 || page > totalPages) return;
            currentPage2 = page;
            renderTable2();
            renderPagination2();
        };

        function renderColumnFilters2() {
            const headerRow = $("#leadsTable2 thead tr.filters");
            headerRow.remove();

            let filterRow = "<tr class='filters'>";
            $("#leadsTable2 thead tr:first th").each(function (i, th) {
                if (i === 0 || i === 1 || i === 14) {
                    filterRow += "<th></th>";
                } else {
                    filterRow += `<th><select class="column-filter2 form-select form-select-sm" data-index="${i}">
                <option value="">All</option>
            </select></th>`;
                }
            });
            filterRow += "</tr>";
            $("#leadsTable2 thead").append(filterRow);

            populateColumnFilterOptions2();
        }

        function populateColumnFilterOptions2() {
            $("#leadsTable2 thead .column-filter2").each(function () {
                const index = $(this).data("index");
                let values = [...new Set(filteredData2.map(row => Object.values(row)[index]))];

                values = values.filter(v => v && v.trim() !== "");

                let formattedValues = values;

                if ($("#leadsTable2 thead tr:first th").eq(index).text().toLowerCase().includes("date")) {
                    formattedValues = values.map(v => {
                        let d = new Date(v);
                        if (!isNaN(d)) {
                            return {
                                raw: v,
                                display: d.toLocaleDateString("en-GB", {
                                    day: "numeric",
                                    month: "long",
                                    year: "numeric"
                                })
                            };
                        }
                        return { raw: v, display: v };
                    });
                } else {
                    formattedValues = values.map(v => ({ raw: v, display: v }));
                }

                formattedValues.sort((a, b) => a.display.localeCompare(b.display));

                formattedValues.forEach(v => {

                    $(this).append(`<option value="${v.raw}">${v.display}</option>`);
                });
            });

            $(".column-filter2").off("change").on("change", function () {
                applyFilters2();
            });
        }

        function applyFilters2() {
            filteredData2 = [...getBaseFilteredData2()];
            $("#leadsTable2 thead .column-filter2").each(function () {
                const value = $(this).val();
                const index = $(this).data("index");
                if (value) {
                    filteredData2 = filteredData2.filter(row => {
                        const cellValue = Object.values(row)[index] || "";
                        return cellValue.toLowerCase() === value.toLowerCase();
                    });
                }
            });
            currentPage2 = 1;
            renderTable2();
            renderPagination2();
        }

        function makeCell2(field, value) {
            let displayValue = value || "";

            if (field === "mobileNumber" && value) {
                const numbers = value.split("/").map(num => num.trim());

                const links = numbers.map(num =>
                    `<a href="tel:${num}" class="text-primary text-decoration-none me-2">${num}</a>`
                ).join(" | ");

                return `<td data-field="${field}">
                <span>${links}</span>
                <input type="text" value="${displayValue}">
            </td>`;
            }

            return `<td data-field="${field}">
        <span>${displayValue}</span>
        <input type="text" value="${displayValue}">
        </td>`;
        }

        function makeDateCell2(field, value) {
            let displayValue = formatDate2(value);
            let rawValue = value ? new Date(value).toISOString().split("T")[0] : "";
            return `<td data-field="${field}">
        <span>${displayValue}</span>
        <input type="text" class="date-picker2" value="${rawValue}">
        </td>`;
        }

        function formatDate2(dateStr) {
            if (!dateStr) return "";
            let date = new Date(dateStr);
            if (isNaN(date)) return dateStr;
            return date.toLocaleDateString("en-GB", {
                day: "numeric",
                month: "long",
                year: "numeric"
            });
        }

        function makeDropdownCell2(field, selectedValue, stateFilter = null) {
            let options = dropdowns2[field] || [];

            if (field === "city" && stateFilter) {
                options = citiesData2.filter(c => c.state === stateFilter).map(c => c.name);
            }

            function capitalize(str) {
                return str.replace(/\b\w/g, c => c.toUpperCase());
            }

            let displaySelected = selectedValue ? capitalize(selectedValue) : "";

            let bgColor = "";
            // if (colorMap2[field] && selectedValue) {
            //     bgColor = colorMap2[field][selectedValue.toLowerCase()] || "";
            // }

            let html = `<td data-field="${field}" style="background-color:${bgColor};">
            <span style="color:black; font-weight:bold;">${displaySelected}</span>
            <select class="form-control select22">`;

            html += `<option value="" ${!selectedValue ? "selected" : ""}></option>`;

            options.forEach(opt => {
                let sel = (opt === selectedValue) ? "selected" : "";
                html += `<option value="${opt}" ${sel}>${capitalize(opt)}</option>`;
            });

            html += `</select></td>`;
            return html;
        }

        function attachCellEvents2() {
            $("#leadsTable2 td").off("dblclick").on("dblclick", function () {
                let td = $(this);
                td.addClass("editing");
                td.find("input,select").focus();
            });

            $("#leadsTable2 td[data-field='mobileNumber']").off("dblclick").on("dblclick", function (e) {
                e.preventDefault();
                let td = $(this);
                td.addClass("editing");
                td.find("input").focus();
            });

            $("#leadsTable2 td input, #leadsTable2 td select")
                .off("blur change")
                .on("blur change", function () {

                    if ($(this).hasClass("date-picker2")) return;

                    let td = $(this).closest("td");
                    let tr = $(this).closest("tr");
                    let id = tr.data("id");
                    let field = td.data("field");
                    let value = $(this).val();

                    function capitalize(str) {
                        return str.replace(/\b\w/g, c => c.toUpperCase());
                    }

                    if ($(this).is("select")) {
                        let displayText = capitalize(value);
                        let bgColor = "";
                        // if (colorMap2[field] && value) {
                        //     bgColor = colorMap2[field][value.toLowerCase()] || "";
                        // }
                        td.css("background-color", bgColor);
                        td.find("span").css("color", "black").css("font-weight", "bold").text(displayText);
                    } else {
                        td.find("span").text(value);
                    }
                    td.removeClass("editing");

                    let payload = {};
                    payload[field] = value;

                    $.ajax({
                        url: apiBase2 + "/update/" + id,
                        method: "PUT",
                        contentType: "application/json",
                        data: JSON.stringify(payload),
                        success: function (res) {
                            console.log("Updated 2:", res);

                            if (field === "state") {
                                const cityTd = tr.find("td[data-field='city']");
                                const newCityDropdown = makeDropdownCell2("city", "", value);
                                cityTd.replaceWith(newCityDropdown);
                                attachCellEvents2();
                            }
                        },
                        error: function (err) {
                            console.error("Update failed 2", err);
                        }
                    });
                });

            $(".date-picker2").each(function () {
                const input = $(this);
                input.flatpickr({
                    dateFormat: "Y-m-d",
                    onChange: function (selectedDates, dateStr) {
                        if (!dateStr) return;

                        let td = input.closest("td");
                        let tr = input.closest("tr");
                        let id = tr.data("id");
                        let field = td.data("field");
                        let value = new Date(dateStr).toISOString().split("T")[0];

                        td.find("span").text(formatDate2(value));
                        td.removeClass("editing");

                        let payload = {};
                        payload[field] = value;

                        $.ajax({
                            url: apiBase2 + "/update/" + id,
                            method: "PUT",
                            contentType: "application/json",
                            data: JSON.stringify(payload),
                            success: function (res) {
                                console.log("Updated 2:", res);
                            },
                            error: function (err) {
                                console.error("Update failed 2", err);
                            }
                        });
                    }
                });
            });
        }

        function attachSendMailEvents2() {
            $(".send-mail2").off("click").on("click", function () {
                const id = $(this).data("id");

                Swal.fire({
                    title: "Are you sure?",
                    text: "Do you want to send the JD mail?",
                    icon: "question",
                    showCancelButton: true,
                    confirmButtonText: "Yes, Send",
                    cancelButtonText: "Cancel"
                }).then((result) => {
                    if (result.isConfirmed) {
                        Swal.fire({
                            title: "Sending...",
                            text: "Please wait while the mail is being sent",
                            allowOutsideClick: false,
                            didOpen: () => {
                                Swal.showLoading();
                            }
                        });

                        $.ajax({
                            url: "https://eduroom.in/api/v1/cosheet/" + id + "/send-jd",
                            method: "POST",
                            contentType: "application/json",
                            data: JSON.stringify({ cc: [], bcc: [], teamManagerId: teamManagerId }),
                            success: function (res) {
                                Swal.fire({
                                    icon: "success",
                                    title: "Mail Sent!",
                                    text: "The JD mail was sent successfully."
                                });
                            },
                            error: function (err) {
                                Swal.fire({
                                    icon: "error",
                                    title: "Error",
                                    text: "Failed to send the JD mail."
                                });
                            }
                        });
                    }
                });
            });
        }

        window.filterTable2 = function () {
            const value = $("#searchInput2").val().toLowerCase().trim();
            if (!value) {
                renderTable2();
                renderPagination2();
                return;
            }

            const filtered = getBaseFilteredData2().filter((row) =>
                Object.values(row).some((field) => {
                    const plainText = $('<div>').html(field).text().toLowerCase().trim();
                    return plainText.includes(value);
                })
            );

            const tbody = $("#leadsTable2 tbody");
            tbody.empty();
            filtered.forEach((row, index) => {
                const tr = `<tr data-id="${row.id}">
                <td>
                    <button class="btn btn-sm btn-danger delete-record2" data-id="${row.id}" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
                <td>${index + 1}</td>
                ${makeCell2("collegeName", row.collegeName)}
                ${makeCell2("coordinatorName", row.coordinatorName)}
                ${makeCell2("mobileNumber", row.mobileNumber)}
                ${makeCell2("emailId", row.emailId)}
                ${makeDropdownCell2("state", row.state)}
                ${makeDropdownCell2("city", row.city, row.state)}
                ${makeDropdownCell2("course", row.course)}
                ${makeDropdownCell2("connectedBy", row.connectedBy)}
                ${makeDateCell2("dateOfConnect", row.dateOfConnect)}
                    ${makeDropdownCell2("callResponse", row.callResponse)}
                    ${makeDropdownCell2("internshipType", row.internshipType)}
                    ${makeDropdownCell2("detailedResponse", row.detailedResponse)}
                    <td>
                        <button class="btn btn-sm btn-danger delete-record" data-id="${row.id}" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>`;
                tbody.append(tr);
            });

            $("#pagination2").hide();
            attachCellEvents2();
            attachSendMailEvents2();
        };

        window.printTable2 = function () {
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write('<html><head><title>Print Table</title></head><body>');
            printWindow.document.write($("#leadsTable2")[0].outerHTML);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        };

        window.exportToExcel2 = async function () {
            const isVerified = sessionStorage.getItem("excel_export_verified");

            if (!isVerified) {
                try {
                    const response = await fetch("/config.json");
                    const config = await response.json();
                    const correctPassword = config.exportPassword;

                    const { value: enteredPassword } = await Swal.fire({
                        title: "Enter Export Password",
                        input: "password",
                        inputPlaceholder: "Enter password",
                        showCancelButton: true,
                        confirmButtonText: "Verify",
                        cancelButtonText: "Cancel",
                        inputValidator: (value) => {
                            if (!value) {
                                return "Password is required";
                            }
                        }
                    });

                    if (!enteredPassword) return;

                    if (enteredPassword !== correctPassword) {
                        Swal.fire({
                            icon: "error",
                            title: "Invalid Password",
                            text: "You are not authorized to export this data"
                        });
                        return;
                    }

                    sessionStorage.setItem("excel_export_verified", "true");

                } catch (error) {
                    Swal.fire({
                        icon: "error",
                        title: "Error",
                        text: "Unable to verify password"
                    });
                    return;
                }
            }

            const headers = [
                "S No.",
                "College Name",
                "Coordinator Name",
                "Mobile Number",
                "Email ID",
                "State",
                "City",
                "Course",
                "Connected By",
                "Date of Connect",
                "Call Response",
                "Internship Type",
                "Detailed Response"
            ];

            const data = [headers];

            tableData2.forEach((row, index) => {
                data.push([
                    index + 1,
                    row.collegeName,
                    row.coordinatorName,
                    row.mobileNumber,
                    row.emailId,
                    row.state,
                    row.city,
                    row.course,
                    row.connectedBy,
                    row.dateOfConnect,
                    row.callResponse,
                    row.internshipType,
                    row.detailedResponse
                ]);
            });

            const worksheet = XLSX.utils.aoa_to_sheet(data);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "CollegeDetails2");
            XLSX.writeFile(workbook, "CollegeDetails_All2.xlsx");
        };

        $(document).ready(function () {
            loadCities2().then(() => {
                loadTableData2();
            });
        });
    </script>

    <script>
        let leadsData3 = [];
        let leadsMasterData3 = [];
        let leadsPage3 = 1;
        const leadsRowsPerPage3 = 10;

        function getMonthName(monthYear) {
            const monthIndex = parseInt(monthYear.split("-")[1], 10) - 1;
            return new Date(2000, monthIndex).toLocaleString("en-GB", { month: "long" });
        }

        function fetchLeadsData3(monthYear = null) {
            let url = "https://eduroom.in/api/v1/cosheet/list";

            $.ajax({
                url: url,
                type: "GET",
                dataType: "json",
                success: function (res) {
                    console.log("Future College Data:", res);
                    if (res.success && res.data.length > 0) {

                        const managerName2 = sessionStorage.getItem("userName");
                        console.log("managerName2:", managerName2);

                        leadsMasterData3 = res.data.filter(item => {
                            if (!managerName2 || item.connectedBy !== managerName2) return false;

                            if (!monthYear) return true;

                            const monthName = getMonthName(monthYear);
                            return item.detailedResponse && item.detailedResponse.toLowerCase().includes(monthName.toLowerCase());
                        });

                        leadsData3 = [...leadsMasterData3];
                        renderLeadsTable3();
                        renderLeadsPagination3();
                    } else {
                        $("#leadsTable3 tbody").html(
                            `<tr><td colspan="14" class="text-center text-muted">No records found</td></tr>`
                        );
                        $("#pagination3").html("");
                    }
                },
                error: function () {
                    alert("Failed to load leads data.");
                }
            });
        }

        function formatDate(dateStr) {
            if (!dateStr) return "";
            let d = new Date(dateStr);
            if (isNaN(d)) return dateStr;
            return d.toLocaleDateString("en-GB", {
                day: "numeric",
                month: "long",
                year: "numeric"
            });
        }

        function capitalize(str) {
            if (!str) return "";
            return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
        }

        function renderLeadsTable3() {
            let start = (leadsPage3 - 1) * leadsRowsPerPage3;
            let end = start + leadsRowsPerPage3;
            let pageData = leadsData3.slice(start, end);

            let rows = "";
            pageData.forEach((item, index) => {
                let srNo = start + index + 1;
                rows += `
            <tr>
                <td>${srNo}</td>
                <td>${item.collegeName || ""}</td>
                <td>${item.coordinatorName || ""}</td>
                <td>${item.mobileNumber || ""}</td>
                <td>${item.emailId || ""}</td>
                <td>${item.city || ""}</td>
                <td>${item.state || ""}</td>
                <td>${item.course || ""}</td>
                <td>${item.connectedBy || ""}</td>
                <td>${formatDate(item.dateOfConnect) || ""}</td>
                <td>${capitalize(item.callResponse)}</td>
                <td>${capitalize(item.internshipType)}</td>
                <td>${item.detailedResponse || ""}</td>
            </tr>`;
            });

            $("#leadsTable3 tbody").html(rows);
        }

        function renderLeadsPagination3() {
            const totalPages = Math.ceil(leadsData3.length / leadsRowsPerPage3);
            const pagination = $("#pagination3");
            pagination.empty();

            if (totalPages <= 1) return;

            const visibleCount = 3;
            let startPage = Math.max(leadsPage3 - 1, 1);
            let endPage = startPage + visibleCount - 1;

            if (endPage > totalPages) {
                endPage = totalPages;
                startPage = Math.max(endPage - visibleCount + 1, 1);
            }

            const prevDisabled = leadsPage3 === 1 ? "disabled" : "";
            const nextDisabled = leadsPage3 === totalPages ? "disabled" : "";

            pagination.append(
                `<li><a href="javascript:void(0);" class="${prevDisabled}" onclick="changeLeadsPage3(${leadsPage3 - 1})">&laquo;</a></li>`
            );

            for (let i = startPage; i <= endPage; i++) {
                const active = i === leadsPage3 ? "active" : "";
                pagination.append(
                    `<li><a href="javascript:void(0);" class="${active}" onclick="changeLeadsPage3(${i})">${i}</a></li>`
                );
            }

            pagination.append(
                `<li><a href="javascript:void(0);" class="${nextDisabled}" onclick="changeLeadsPage3(${leadsPage3 + 1})">&raquo;</a></li>`
            );
        }

        function changeLeadsPage3(page) {
            const totalPages = Math.ceil(leadsData3.length / leadsRowsPerPage3);
            if (page < 1 || page > totalPages) return;
            leadsPage3 = page;
            renderLeadsTable3();
            renderLeadsPagination3();
        }

        function filterTable3() {
            let input = document.getElementById("searchInput3").value.toLowerCase();

            if (input === "") {
                leadsData3 = [...leadsMasterData3];
            } else {
                leadsData3 = leadsMasterData3.filter(item => {
                    return (
                        (item.collegeName || "").toLowerCase().includes(input) ||
                        (item.coordinatorName || "").toLowerCase().includes(input) ||
                        (item.mobileNumber || "").toLowerCase().includes(input) ||
                        (item.emailId || "").toLowerCase().includes(input) ||
                        (item.city || "").toLowerCase().includes(input) ||
                        (item.state || "").toLowerCase().includes(input) ||
                        (item.course || "").toLowerCase().includes(input) ||
                        (item.connectedBy || "").toLowerCase().includes(input) ||
                        (item.dateOfConnect || "").toLowerCase().includes(input) ||
                        (item.callResponse || "").toLowerCase().includes(input) ||
                        (item.internshipType || "").toLowerCase().includes(input) ||
                        (item.detailedResponse || "").toLowerCase().includes(input)
                    );
                });
            }

            leadsPage3 = 1;
            renderLeadsTable3();
            renderLeadsPagination3();
        }

        function printTable3() {
            let printContents = document.getElementById("leadsTable3").outerHTML;
            let win = window.open("", "", "width=900,height=650");
            win.document.write("<html><head><title>Print Leads</title></head><body>");
            win.document.write(printContents);
            win.document.write("</body></html>");
            win.document.close();
            win.print();
        }

        async function exportToExcel3() {
            const isVerified = sessionStorage.getItem("excel_export_verified");

            if (!isVerified) {
                try {
                    const response = await fetch("/config.json");
                    const config = await response.json();
                    const correctPassword = config.exportPassword;

                    const { value: enteredPassword } = await Swal.fire({
                        title: "Enter Export Password",
                        input: "password",
                        inputPlaceholder: "Enter password",
                        showCancelButton: true,
                        confirmButtonText: "Verify",
                        cancelButtonText: "Cancel",
                        inputValidator: (value) => {
                            if (!value) {
                                return "Password is required";
                            }
                        }
                    });

                    if (!enteredPassword) return;

                    if (enteredPassword !== correctPassword) {
                        Swal.fire({
                            icon: "error",
                            title: "Invalid Password",
                            text: "You are not authorized to export this data"
                        });
                        return;
                    }

                    sessionStorage.setItem("excel_export_verified", "true");

                } catch (error) {
                    Swal.fire({
                        icon: "error",
                        title: "Error",
                        text: "Unable to verify password"
                    });
                    return;
                }
            }

            let table = document.getElementById("leadsTable3");
            let wb = XLSX.utils.table_to_book(table, { sheet: "FutureColleges" });
            XLSX.writeFile(wb, "FutureColleges.xlsx");
        }

        $(document).ready(function () {
            if (selectedMonthYear3) {
                fetchLeadsData3(selectedMonthYear3);
            } else {
                fetchLeadsData3();
            }
        });
    </script>

    <script>
        let selectedMonthYear3 = "";

        (function populateYearMonthDropdowns3() {
            const yearSelect = document.getElementById("yearSelect3");
            const monthSelect = document.getElementById("monthSelect3");

            const now = new Date();
            let nextMonth = now.getMonth() + 2;
            let nextMonthYear = now.getFullYear();

            if (nextMonth > 12) {
                nextMonth = 1;
                nextMonthYear += 1;
            }

            const currentYear = now.getFullYear();
            for (let y = currentYear - 2; y <= currentYear + 2; y++) {
                let option = document.createElement("option");
                option.value = y;
                option.textContent = y;
                if (y === nextMonthYear) option.selected = true;
                yearSelect.appendChild(option);
            }

            for (let m = 1; m <= 12; m++) {
                let option = document.createElement("option");
                option.value = String(m).padStart(2, "0");
                let d = new Date(2000, m - 1, 1);
                option.textContent = d.toLocaleDateString("en-GB", { month: "long" });
                if (m === nextMonth) option.selected = true;
                monthSelect.appendChild(option);
            }

            selectedMonthYear3 = `${nextMonthYear}-${String(nextMonth).padStart(2, "0")}`;
            document.getElementById("selectedMonthDisplay3").textContent =
                new Date(nextMonthYear, nextMonth - 1, 1).toLocaleDateString("en-GB", { month: "long", year: "numeric" });
            document.getElementById("selectedMonthDisplay3").style.display = "inline-block";

            console.log("Initial Selection (Next Month):", selectedMonthYear3);
        })();

        function setSelectedMonthYear3() {
            const year = document.getElementById("yearSelect3").value;
            const month = document.getElementById("monthSelect3").value;
            const display = document.getElementById("selectedMonthDisplay3");

            if (year && month) {
                selectedMonthYear3 = `${year}-${month}`;
                let d = new Date(year, month - 1, 1);
                display.textContent = d.toLocaleDateString("en-GB", { month: "long", year: "numeric" });
                display.style.display = "inline-block";

                console.log("Selected Month-Year:", selectedMonthYear3);

                fetchLeadsData3(selectedMonthYear3);
            } else {
                selectedMonthYear3 = "";
                display.style.display = "none";
                console.log("Selection cleared, loading all data...");
                fetchLeadsData3();
            }
        }
    </script>

    <script>
        document.addEventListener("click", function (e) {
            if (e.target.closest(".delete-record")) {
                let button = e.target.closest(".delete-record");
                let recordId = button.getAttribute("data-id");

                Swal.fire({
                    title: "Are you sure?",
                    text: "This action cannot be undone!",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#d33",
                    cancelButtonColor: "#6c757d",
                    confirmButtonText: "Yes, delete it!"
                }).then((result) => {
                    if (result.isConfirmed) {
                        console.log("Deleting record with ID:", recordId);

                        $.ajax({
                            url: `https://eduroom.in/api/v1/cosheet/cosheet/${recordId}`,
                            method: "DELETE",
                            success: function (res) {
                                Swal.fire(
                                    "Deleted!",
                                    "The record has been deleted.",
                                    "success"
                                ).then(() => {
                                    $(button).closest("tr").remove();
                                });
                            },
                            error: function (err) {
                                console.error("Delete failed", err);
                                Swal.fire(
                                    "Error!",
                                    "Failed to delete the record.",
                                    "error"
                                );
                            }
                        });
                    }
                });
            }
        });
    </script>

    <script>
        let fromDate2 = null;
        let toDate2 = null;

        function loadAnalysisCounts() {
            let apiUrl = `https://eduroom.in/api/v1/analysis/counts/${teamManagerId}`;

            if (fromDate2 && toDate2) {
                apiUrl += `?fromDate=${fromDate2}&toDate=${toDate2}`;
            }

            $.ajax({
                url: apiUrl,
                method: "GET",
                success: function (res) {
                    if (res.success && res.counts) {
                        console.log("analytics metrics response:", res);
                        const counts = res.counts;

                        const cnaCount = counts.notAnswered.count || 0;
                        $(".card:has(p:contains('CNA')) h1").text(cnaCount);

                        const busyCount = counts.busy.count || 0;
                        $(".card:has(p:contains('Busy')) h1").text(busyCount);

                        const invalidCount = counts.invalid.count || 0;
                        $(".card:has(p:contains('Invalid')) h1").text(invalidCount);

                        const switchOffCount = counts.switchOff.count || 0;
                        $(".card:has(p:contains('Switch off')) h1").text(switchOffCount);

                        // const total = Object.values(counts).reduce((a, b) => a + b, 0) || 1;
                        // $(".card:has(p:contains('CNA')) .badge").text(Math.round((cnaCount / total) * 100) + "%");
                        // $(".card:has(p:contains('Busy')) .badge").text(Math.round((busyCount / total) * 100) + "%");
                        // $(".card:has(p:contains('Invalid')) .badge").text(Math.round((invalidCount / total) * 100) + "%");
                        // $(".card:has(p:contains('Switch off')) .badge").text(Math.round((switchOffCount / total) * 100) + "%");
                    } else {
                        console.error("No counts found in response", res);
                    }
                },
                error: function (err) {
                    console.error("Error fetching analysis counts:", err);
                }
            });
        }

        $(document).ready(function () {
            loadAnalysisCounts();
        });

        flatpickr("#dateRangePicker2", {
            mode: "range",
            dateFormat: "Y-m-d",
            onClose: function (selectedDates, dateStr, instance) {
                if (selectedDates.length === 2) {
                    fromDate2 = instance.formatDate(selectedDates[0], "Y-m-d");
                    toDate2 = instance.formatDate(selectedDates[1], "Y-m-d");

                    console.log("date picker 2:", "From:", fromDate2, "To:", toDate2);

                    loadAnalysisCounts();
                }
            }
        });
    </script>

    <div class="modal fade" id="manualEntryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Manual College Entry</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Connected By</label>
                            <select class="form-select" id="connectedBy">
                                <option value="">Select</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Date of Connect</label>
                            <input type="text" class="form-control flatpickr" id="dateOfConnect"
                                placeholder="Select Date">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">College Name</label>
                            <input type="text" class="form-control" id="collegeName">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Coordinator Name</label>
                            <input type="text" class="form-control" id="coordinatorName">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Mobile Number</label>
                            <input type="text" class="form-control" id="mobileNumber">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Email ID</label>
                            <input type="email" class="form-control" id="emailId">
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">State</label>
                            <select class="form-select" id="stateDropdown">
                                <option value="">Select state</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">City</label>
                            <select class="form-select" id="cityDropdown">
                                <option value="">Please select state first</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Course</label>
                            <select class="form-select" id="course">
                                <option value="">Select</option>
                                <option value="MBA">MBA</option>
                                <option value="PGDM">PGDM</option>
                                <option value="MBA+PGDM">MBA+PGDM</option>
                                <option value="BBA/BCOM">BBA/BCOM</option>
                                <option value="OTHERS">OTHERS</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Call Response</label>
                            <select class="form-select" id="callResponse">
                                <option value="">Select</option>
                                <option value="connected">Connected</option>
                                <option value="not answered">Not Answered</option>
                                <option value="busy">Busy</option>
                                <option value="switch off">Switch off</option>
                                <option value="invalid">Invalid</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Internship Type</label>
                            <select class="form-select" id="internshipType">
                                <option value="">Select</option>
                                <option value="fulltime">Fulltime</option>
                                <option value="sip">SIP</option>
                                <option value="liveproject">Live Project</option>
                                <option value="wip">WIP</option>
                                <option value="others">Others</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Detailed Response</label>
                            <select class="form-select" id="detailedResponse">
                                <option value="">Select</option>
                                <option value="Send JD">Send JD</option>
                                <option value="Not Interested">Not Interested</option>
                                <option value="January">January</option>
                                <option value="February">February</option>
                                <option value="March">March</option>
                                <option value="April">April</option>
                                <option value="May">May</option>
                                <option value="June">June</option>
                                <option value="July">July</option>
                                <option value="August">August</option>
                                <option value="September">September</option>
                                <option value="October">October</option>
                                <option value="November">November</option>
                                <option value="December">December</option>
                                <option value="Cut the call">Cut the call</option>
                            </select>
                        </div>

                    </div>

                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-primary" id="submitCollegeBtn">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            $(".flatpickr").flatpickr({
                dateFormat: "d-m-Y"
            });

            let citiesData = [];
            $.getJSON("cities.json", function (data) {
                citiesData = data;
                let states = [...new Set(data.map(c => c.state))];
                states.forEach(st => {
                    $("#stateDropdown").append(`<option value="${st}">${st}</option>`);
                });
            });

            $("#stateDropdown").on("change", function () {
                let selectedState = $(this).val();
                $("#cityDropdown").empty().append(`<option value="">Select City</option>`);
                citiesData
                    .filter(c => c.state === selectedState)
                    .forEach(city => {
                        $("#cityDropdown").append(`<option value="${city.name}">${city.name}</option>`);
                    });
            });

            let usersList = JSON.parse(sessionStorage.getItem("users_list")) || [];
            usersList.forEach(u => {
                $("#connectedBy").append(`<option value="${u.name}">${u.name}</option>`);
            });

            $("#submitCollegeBtn").on("click", function () {
                let collegeName = $("#collegeName").val();
                let coordinatorName = $("#coordinatorName").val();
                let mobileNumber = $("#mobileNumber").val();
                let emailId = $("#emailId").val();
                let city = $("#cityDropdown").val();
                let state = $("#stateDropdown").val();
                let course = $("#course").val();
                let connectedBy = $("#connectedBy").val();
                let dateOfConnect = $("#dateOfConnect").val();
                let callResponse = $("#callResponse").val();
                let internshipType = $("#internshipType").val();
                let detailedResponse = $("#detailedResponse").val();

                if (!collegeName || !coordinatorName || !mobileNumber || !emailId || !city || !state || !course || !connectedBy || !dateOfConnect || !callResponse || !internshipType || !detailedResponse) {
                    Swal.fire({
                        icon: "warning",
                        title: "Missing Fields",
                        text: "All fields are required. Please fill in all details before submitting."
                    });
                    return;
                }

                let payload = [{
                    collegeDetails: {
                        sr: 1,
                        collegeName: collegeName,
                        coordinatorName: coordinatorName,
                        mobileNumber: mobileNumber,
                        emailId: emailId,
                        city: city,
                        state: state,
                        course: course,
                    },
                    connect: {
                        connectedBy: connectedBy,
                        dateOfConnect: new Date(dateOfConnect.split("-").reverse().join("-")).getTime(),
                        callResponse: callResponse,
                        internshipType: internshipType,
                        detailedResponse: detailedResponse,
                    },
                    teamManagerId: teamManagerId,
                }];

                console.log("Manual Payload:", payload);

                Swal.fire({
                    title: "Submitting...",
                    text: "Please wait while we send your data.",
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    didOpen: () => Swal.showLoading()
                });

                $.ajax({
                    url: "https://eduroom.in/api/v1/cosheet/add",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(payload),
                    success: function (res) {
                        console.log("Response:", res);
                        let message = "College data uploaded successfully.";
                        let totalMsg = res.total ? `<br><br><strong>Total entries:</strong> <strong>${res.total}</strong>` : "";
                        let duplicatesMsg = res.duplicates && res.duplicates > 0
                            ? `<br><strong>Duplicate entries found:</strong> <strong style="color: red;">${res.duplicates}</strong><br>(Removed automatically)`
                            : "";

                        Swal.fire({
                            icon: "success",
                            title: "Upload Complete",
                            html: `${message}${totalMsg}${duplicatesMsg}`,
                            confirmButtonText: "Okay"
                        }).then(() => {
                            $("#manualEntryModal").modal("hide");
                        });
                    },
                    error: function (xhr) {
                        console.log("Error:", xhr);
                        Swal.fire({
                            icon: "error",
                            title: "Upload Failed",
                            text: xhr.responseText || "Something went wrong!",
                        });
                    }
                });
            });
        });
    </script>

    <script>
        window.addEventListener("pageshow", function (event) {
            if (event.persisted || (window.performance && window.performance.getEntriesByType("navigation")[0].type === "back_forward")) {
                window.location.reload();
            }
        });

        $(document).ready(function () {
            const userId = sessionStorage.getItem("user_id");

            if (!userId) {
                Swal.fire({
                    icon: "warning",
                    title: "Login Required",
                    text: "You must log in to access this page.",
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    showConfirmButton: true,
                    confirmButtonText: "Go to Login"
                }).then(() => {
                    window.top.location.href = "/login.html";
                });
                return;
            }

            $(document).on("click", "#logoutBtn", function () {
                Swal.fire({
                    title: "Logging out...",
                    text: "Please wait",
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                $.ajax({
                    url: "https://eduroom.in/api/v1/user/logout",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({ id: userId }),
                    success: function (res) {
                        console.log("Logout success:", res);
                        sessionStorage.clear();

                        Swal.fire({
                            icon: "success",
                            title: "Logged Out",
                            text: "You have been logged out successfully!",
                            showConfirmButton: false,
                            timer: 2000
                        }).then(() => {
                            window.top.location.href = "/login.html";
                        });
                    },
                    error: function (err) {
                        console.error("Logout error:", err);
                        Swal.fire({
                            icon: "error",
                            title: "Logout Failed",
                            text: "Something went wrong. Please try again!",
                            allowOutsideClick: false,
                            confirmButtonText: "OK"
                        });
                    }
                });
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        fetch("/config.json")
            .then(response => response.json())
            .then(config => {
                const HARD_CODED_PASSWORD = config.HARD_CODED_PASSWORD || "";
                const SESSION_KEY = "coursePasswordVerified";

                const protectedLi = document.getElementById("protectedDropdown");
                const trigger = document.getElementById("protectedTrigger");
                const submenu = protectedLi.querySelector(".protected-submenu");

                function openProtectedMenu() {
                    protectedLi.classList.add("is-open");
                    submenu.style.display = "block";
                }

                function closeProtectedMenu() {
                    protectedLi.classList.remove("is-open");
                    submenu.style.display = "none";
                }

                if (sessionStorage.getItem(SESSION_KEY) === "true") {
                    openProtectedMenu();
                } else {
                    closeProtectedMenu();
                }

                trigger.addEventListener("click", function (ev) {
                    ev.preventDefault();
                    ev.stopPropagation();
                    ev.stopImmediatePropagation();

                    if (sessionStorage.getItem(SESSION_KEY) === "true") {
                        if (protectedLi.classList.contains("is-open")) {
                            closeProtectedMenu();
                        } else {
                            openProtectedMenu();
                        }
                        return;
                    }

                    Swal.fire({
                        title: "Enter Password",
                        input: "password",
                        inputPlaceholder: "Enter access password",
                        showCancelButton: true,
                        confirmButtonText: "Submit",
                        allowOutsideClick: false,
                        inputValidator: (value) => {
                            if (!value) return "Password cannot be empty!";
                            return null;
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            const userPassword = result.value;

                            if (userPassword === HARD_CODED_PASSWORD) {
                                sessionStorage.setItem(SESSION_KEY, "true");
                                Swal.fire({
                                    icon: "success",
                                    title: "Access Granted",
                                    timer: 1000,
                                    showConfirmButton: false
                                }).then(() => openProtectedMenu());
                            } else {
                                Swal.fire({
                                    icon: "error",
                                    title: "Invalid Password",
                                    text: "You are not allowed to access this section."
                                });
                                closeProtectedMenu();
                            }
                        } else {
                            closeProtectedMenu();
                        }
                    });
                });

                document.addEventListener("click", function (e) {
                    const inside = protectedLi.contains(e.target);
                    if (!inside && !sessionStorage.getItem(SESSION_KEY)) {
                        closeProtectedMenu();
                    }
                });

            })
            .catch(err => {
                console.error("Could not load config.json:", err);
            });
    </script>

    <style>
        #protectedDropdown.is-open>.protected-submenu {
            display: block !important;
        }
    </style>

    <script>
        let passwords = {};

        $(document).ready(function () {
            $.getJSON("/config.json", function (data) {
                passwords = data;
            });

            $("#hrTargetsBtn").click(function () {
                handleProtectedPage(
                    "HR_PASSWORD",
                    "hr_verified",
                    "/profile/dashboard/targets.html"
                );
            });

            $("#bdTargetsBtn").click(function () {
                handleProtectedPage(
                    "BD_PASSWORD",
                    "bd_verified",
                    "/profile/dashboard/bd-targets.html"
                );
            });
        });

        function handleProtectedPage(passwordKey, sessionKey, redirectUrl) {
            if (sessionStorage.getItem(sessionKey) === "true") {
                window.location.href = redirectUrl;
                return;
            }

            Swal.fire({
                title: "Enter Password",
                input: "password",
                inputPlaceholder: "Enter access password",
                showCancelButton: true,
                confirmButtonText: "Verify",
            }).then(result => {
                if (!result.value) return;

                const enteredPassword = result.value.trim();
                const correctPassword = passwords[passwordKey];

                if (enteredPassword === correctPassword) {
                    sessionStorage.setItem(sessionKey, "true");

                    Swal.fire({
                        icon: "success",
                        title: "Access Granted",
                        timer: 1200,
                        showConfirmButton: false
                    }).then(() => {
                        window.location.href = redirectUrl;
                    });
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "Invalid Password",
                        text: "Access denied!"
                    });
                }
            });
        }
    </script>

    <script>
        // Make functions accessible globally
        let addEmailChip;

        document.addEventListener("DOMContentLoaded", function () {
            const emailInput = document.getElementById("email-input");
            const chipWrapper = document.getElementById("email-chip-wrapper");

            emailInput.addEventListener("keydown", function (e) {
                if (e.key === "Enter" || e.key === "," || e.key === " ") {
                    e.preventDefault();
                    const email = emailInput.value.trim().replace(/,$/, "");
                    if (email && validateEmail(email)) {
                        addEmailChip(email);
                        emailInput.value = "";
                    }
                }
            });

            function validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }

            addEmailChip = function (email) {
                const chip = document.createElement("div");
                chip.className = "email-chip";

                chip.innerHTML = `
                <span class="avatar bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center me-2" style="width: 24px; height: 24px; font-size: 12px;">
                    ${email.charAt(0).toUpperCase()}
                </span>
                <span>${email}</span>
                <span class="remove-btn">&times;</span>
            `;

                chip.querySelector(".remove-btn").addEventListener("click", () => {
                    chip.remove();
                });

                chipWrapper.insertBefore(chip, emailInput);
            };
        });
    </script>

</body>

</html>