<!DOCTYPE html>
<html lang="zxx">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="" />
  <meta name="keyword" content="" />
  <meta name="author" content="" />
  <!--! The above 6 meta tags *must* come first in the head; any other head content must come *after* these tags !-->
  <!--! BEGIN: Apps Title-->
  <title>Eduroom || Dashboard</title>
  <!--! END:  Apps Title-->
  <!--! BEGIN: Favicon-->
  <link rel="shortcut icon" type="image/x-icon" href="/assets/images/FundsAuditLogo.png" />
  <!--! END: Favicon-->
  <!--! BEGIN: Bootstrap CSS-->
  <link rel="stylesheet" type="text/css" href="./../assets/css/bootstrap.min.css" />
  <!--! END: Bootstrap CSS-->
  <!--! BEGIN: Vendors CSS-->
  <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/vendors.min.css" />
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/tagify.min.css">
  <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/tagify-data.min.css">
  <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/quill.min.css">
  <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/select2.min.css">
  <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/select2-theme.min.css">
  <link rel="stylesheet" type="text/css" href="./../assets/vendors/css/daterangepicker.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <!--! END: Vendors CSS-->
  <!--! BEGIN: Custom CSS-->
  <link rel="stylesheet" type="text/css" href="./../assets/css/theme.min.css" />
  <!--! END: Custom CSS-->
  <!--! HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries !-->
  <!--! WARNING: Respond.js doesn"t work if you view the page via file: !-->
  <!--[if lt IE 9]>
			<script src="https:oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https:oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
</head>

<body>
  <!--! ================================================================ !-->
  <!--! [Start] Navigation Manu !-->
  <!--! ================================================================ !-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <nav class="nxl-navigation">
    <div class="navbar-wrapper">
      <div class="m-header">
        <a href="#" class="b-brand">
          <img src="/images/favicon.svg" alt="" class="logo logo-lg" />
          <img src="/images/favicon.svg" alt="" class="logo logo-sm" />
        </a>
      </div>
      <div class="navbar-content">
        <ul class="nxl-navbar">
          <li class="nxl-item nxl-caption">
            <label>Navigation</label>
          </li>
          <li class="nxl-item nxl-hasmenu">
            <a href="javascript:void(0);" class="nxl-link">
              <span class="nxl-micon"><i class="feather-airplay"></i></span>
              <span class="nxl-mtext">ADD COURSE DETAILS</span><span class="nxl-arrow"><i
                  class="feather-chevron-right"></i></span>
            </a>
            <ul class="nxl-submenu">
              <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/index.html">ADD DOMAIN</a>
              </li>

              <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/add-course.html">ADD COURSE</a>
              </li>

              <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/add-course-preview.html">ADD COURSE
                  PREVIEW</a>
              </li>

              <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/add-course-details.html">ADD COURSE
                  DETAILS</a>
              </li>

              <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/update-domain.html">UPDATE DOMAIN</a>
              </li>

              <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/update-course.html">UPDATE COURSE</a>
              </li>

              <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/update-course-preview.html">UPDATE
                  COURSE PREVIEW</a>
              </li>

              <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/update-course-details.html">UPDATE
                  COURSE DETAILS</a>
              </li>

              <!-- <li class="nxl-item"><a class="nxl-link" href="website-creation-details.html">Website Creation Details</a></li> -->
            </ul>
          </li>
          <li class="nxl-item nxl-hasmenu">
            <a href="javascript:void(0);" class="nxl-link">
              <span class="nxl-micon"><i class="feather-airplay"></i></span>
              <span class="nxl-mtext">TEAM MANAGER</span><span class="nxl-arrow"><i
                  class="feather-chevron-right"></i></span>
            </a>
            <ul class="nxl-submenu">
              <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/team-manager.html">INTERN'S DETAILS</a>
              </li>

              <!-- <li class="nxl-item"><a class="nxl-link" href="/profile/dashboard/add-course.html">ADD COURSE</a>
                            </li> -->

              <!-- <li class="nxl-item"><a class="nxl-link" href="website-creation-details.html">Website Creation Details</a></li> -->
            </ul>
          </li>
          <li class="nxl-item">
            <a href="javascript:void(0);" id="logoutBtn" class="nxl-link">
              <span class="nxl-micon"><i class="feather-settings"></i></span>
              <span class="nxl-mtext">Logout</span>
              <span class="nxl-arrow"><i class="feather-chevron-right"></i></span>
            </a>
          </li>
          <!-- Admin Page Link (Hidden by Default) -->
          <!-- <li class="nxl-item nxl-hasmenu" id="adminPageLink" style="display: none;">
                        <a href="javascript:void(0);" class="nxl-link">
                            <span class="nxl-micon"><i class="feather-settings"></i></span>
                            <span class="nxl-mtext">Admin Page</span><span class="nxl-arrow"><i class="feather-chevron-right"></i></span>
                        </a>
                        <ul class="nxl-submenu">
                            <li class="nxl-item"><a class="nxl-link" href="admin.html">Dashboard Analysis - Edit</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="business-analysis-edit.html">Business Analysis - Edit</a></li>
                            <li class="nxl-item"><a class="nxl-link" href="analysis-edit.html">Performance Analysis - Edit</a></li>
                        </ul>
                    </li> -->
        </ul>

        <div class="card text-center">
          <div class="card-body">
            <i class="feather-briefcase fs-4 text-dark"></i>
            <h6 class="mt-4 text-dark fw-bolder">Welcome to FundsRoom</h6>
            <p class="fs-11 my-3 text-dark">
              FundsRoom is your trusted financial partner, offering seamless solutions for managing
              investments, loans, and business funds with ease.
            </p>
            <!-- <a href="https://www.fundsroom.com/" class="btn btn-primary text-dark w-100" style="margin-bottom: 10%;">Fundsroom</a>
                        <a href="https://play.google.com/store/apps/details?id=com.fundsroom.fundsaudit&hl=en_IN" class="btn btn-success text-light w-100">Download FundsAudit</a> -->
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!--! ================================================================ !-->
  <!--! [End]  Navigation Manu !-->
  <!--! ================================================================ !-->
  <!--! ================================================================ !-->
  <!--! [Start] Header !-->
  <!--! ================================================================ !-->
  <header class="nxl-header">
    <div class="header-wrapper">
      <!--! [Start] Header Left !-->
      <div class="header-left d-flex align-items-center gap-4">
        <!--! [Start] nxl-head-mobile-toggler !-->
        <a href="javascript:void(0);" class="nxl-head-mobile-toggler" id="mobile-collapse">
          <div class="hamburger hamburger--arrowturn">
            <div class="hamburger-box">
              <div class="hamburger-inner"></div>
            </div>
          </div>
        </a>
        <!--! [Start] nxl-head-mobile-toggler !-->
        <!--! [Start] nxl-navigation-toggle !-->
        <div class="nxl-navigation-toggle">
          <a href="javascript:void(0);" id="menu-mini-button">
            <i class="feather-align-left"></i>
          </a>
          <a href="javascript:void(0);" id="menu-expend-button" style="display: none">
            <i class="feather-arrow-right"></i>
          </a>
        </div>
        <!--! [End] nxl-navigation-toggle !-->
        <!--! [Start] nxl-lavel-mega-menu-toggle !-->
        <!-- <div class="nxl-lavel-mega-menu-toggle d-flex d-lg-none">
                    <a href="javascript:void(0);" id="nxl-lavel-mega-menu-open">
                        <i class="feather-align-left"></i>
                    </a>
                </div> -->
        <!--! [End] nxl-lavel-mega-menu-toggle !-->
        <!--! [Start] nxl-lavel-mega-menu !-->
        <div class="nxl-drp-link nxl-lavel-mega-menu">
          <div class="nxl-lavel-mega-menu-toggle d-flex d-lg-none">
            <a href="javascript:void(0)" id="nxl-lavel-mega-menu-hide">
              <i class="feather-arrow-left me-2"></i>
              <span>Back</span>
            </a>
          </div>

          <!--! [End] nxl-lavel-mega-menu-wrapper !-->
        </div>
        <!--! [End] nxl-lavel-mega-menu !-->
      </div>
      <!--! [End] Header Left !-->
      <!--! [Start] Header Right !-->
      <div class="header-right ms-auto">
        <div class="d-flex align-items-center">

          <!-- Full Screen Switcher -->
          <!-- <div class="nxl-h-item d-none d-sm-flex">
                        <div class="full-screen-switcher">
                            <a href="javascript:void(0);" class="nxl-head-link me-0"
                                onclick="$('body').fullScreenHelper('toggle');">
                                <i class="feather-maximize maximize"></i>
                                <i class="feather-minimize minimize"></i>
                            </a>
                        </div>
                    </div> -->

          <!-- Dark/Light Theme Toggle -->
          <div class="nxl-h-item dark-light-theme">
            <a href="javascript:void(0);" class="nxl-head-link me-0 dark-button">
              <i class="feather-moon"></i>
            </a>
            <a href="javascript:void(0);" class="nxl-head-link me-0 light-button" style="display: none">
              <i class="feather-sun"></i>
            </a>
          </div>

          <!-- User Dropdown -->
          <div class="dropdown nxl-h-item">
            <a href="javascript:void(0);" data-bs-toggle="dropdown" role="button" data-bs-auto-close="outside">
              <div class="avatar-text avatar-lg bg-gray-200">
                <i class="feather-user"></i>
              </div>
            </a>
            <div class="dropdown-menu dropdown-menu-end nxl-h-dropdown nxl-user-dropdown">
              <div class="dropdown-header">
                <section id="user-header">
                  <div id="user-section" class="user-dropdown"><i class="feather-user"></i> Fundsroom
                    Tech</div>
                </section>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--! [End] Header Right !-->
    </div>
  </header>
  <!--! ================================================================ !-->
  <!--! [End] Header !-->
  <!--! ================================================================ !-->
  <!--! ================================================================ !-->
  <!--! [Start] Main Content !-->
  <!--! ================================================================ !-->
  <main class="nxl-container">
    <div class="nxl-content">
      <!-- [ page-header ] start -->
      <div class="page-header">
        <div class="page-header-left d-flex align-items-center">
          <div class="page-header-title">
            <h5 class="m-b-10">DASHBOARD</h5>
          </div>
          <ul class="breadcrumb">
            <li class="breadcrumb-item">UPDATE COURSE</li>
          </ul>
        </div>
      </div>
      <!-- [ page-header ] end -->

      <!-- [ Main Content ] start -->
      <div class="main-content" style="margin-bottom: 5%;">
        <div class="row">
          <div class="col-xl-12">
            <div class="card stretch stretch-full">
              <div class="card-body">

                <!-- Select Course -->
                <div class="mb-4">
                  <label class="form-label">Select Course <span class="text-danger">*</span></label>
                  <select class="form-select" id="courseSelect">
                    <option value="">Loading...</option>
                  </select>
                </div>

                <!-- Hidden ID -->
                <input type="hidden" id="courseId">

                <!-- Course Name -->
                <div class="mb-4">
                  <label class="form-label">Course Name</label>
                  <input type="text" class="form-control" id="courseName" placeholder="Enter course name">
                </div>

                <!-- Description -->
                <div class="mb-4">
                  <label class="form-label">Description</label>
                  <textarea class="form-control" id="description" rows="3"
                    placeholder="Enter course description"></textarea>
                </div>

                <!-- Business Target + Certificate Count -->
                <div class="row">
                  <div class="col-lg-6 mb-4">
                    <label class="form-label">Business Target</label>
                    <input type="number" class="form-control" id="businessTarget" placeholder="Enter business target">
                  </div>
                  <div class="col-lg-6 mb-4">
                    <label class="form-label">Certificate Count</label>
                    <input type="number" class="form-control" id="certificateCount"
                      placeholder="Enter certificate count">
                  </div>
                </div>

                <!-- Total Days + Duration -->
                <div class="row">
                  <div class="col-lg-6 mb-4">
                    <label class="form-label">Total Days</label>
                    <input type="number" class="form-control" id="totalDays" placeholder="Enter total days">
                  </div>
                  <div class="col-lg-6 mb-4">
                    <label class="form-label">Duration</label>
                    <input type="text" class="form-control" id="duration" placeholder="Enter duration (e.g. 2 weeks)">
                  </div>
                </div>

                <!-- Image Upload -->
                <div class="mb-4">
                  <label class="form-label">Upload Image</label>
                  <div id="uploadBox" class="border border-2 border-dashed rounded text-center p-5 cursor-pointer"
                    style="border-color: #ccc;">
                    <p class="mb-2">Drag & Drop image here or click below to select</p>
                    <input type="file" id="imageInput" class="form-control mt-2" accept="image/*,.pdf">
                  </div>

                  <!-- Preview -->
                  <div id="previewBox" class="text-center mt-3" style="display:none;">
                    <img id="previewImage" src="" class="img-fluid rounded mb-3"
                      style="max-height: 200px; object-fit: contain;" alt="Preview">
                    <div>
                      <button type="button" class="btn btn-outline-danger btn-sm" id="removeImage">Remove Image</button>
                    </div>
                  </div>
                </div>

                <!-- Message -->
                <div id="formMessage" class="mb-3"></div>

                <!-- Submit & Delete -->
                <div class="d-flex justify-content-between">
                  <!-- Update on left -->
                  <button type="button" class="btn btn-primary" id="submitBtn">Update Course</button>

                  <!-- Delete on right -->
                  <button type="button" class="btn btn-danger" id="deleteBtn">Delete Course</button>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- [ Main Content ] end -->
    </div>
  </main>


  <!--! ================================================================ !-->
  <!--! [End] Main Content !-->
  <!--! ================================================================ !-->

  <!--! ================================================================ !-->
  <!--! Footer Script !-->
  <!--! ================================================================ !-->
  <!--! BEGIN: Vendors JS !-->
  <script src="./../assets/vendors/js/vendors.min.js"></script>
  <!-- vendors.min.js {always must need to be top} -->
  <script src="./../assets/vendors/js/daterangepicker.min.js"></script>
  <script src="./../assets/vendors/js/apexcharts.min.js"></script>
  <script src="./../assets/vendors/js/circle-progress.min.js"></script>
  <script src="./../assets/vendors/js/jquery.calendar.min.js"></script>
  <script src="./../assets/vendors/js/tagify.min.js"></script>
  <script src="./../assets/vendors/js/tagify-data.min.js"></script>
  <script src="./../assets/vendors/js/quill.min.js"></script>
  <script src="./../assets/vendors/js/select2.min.js"></script>
  <script src="./../assets/vendors/js/select2-active.min.js"></script>
  <!--! END: Vendors JS !-->
  <!--! BEGIN: Apps Init  !-->
  <script src="./../assets/js/common-init.min.js"></script>
  <!-- <script src="./../assets/js/dashboard-init.min.js"></script> -->
  <!-- <script src="./../assets/js/reports-project-init.min.js"></script> -->
  <!-- <script src="./../assets/js/widgets-miscellaneous-init.min.js"></script> -->
  <!--! END: Apps Init !-->
  <!--! BEGIN: Theme Customizer  !-->
  <script src="./../assets/js/theme-customizer-init.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!--! END: Theme Customizer !-->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>
    $(document).ready(function () {
      const userId = 2; // hardcoded for now

      // 🔹 Fetch all courses
      $.ajax({
        url: `https://eduroom.in/api/v1/course/courses?userId=${userId}`,
        type: "GET",
        success: function (res) {
          if (res.success && res.data.length > 0) {
            let options = '<option value="">-- Select Course --</option>';
            res.data.forEach(function (course) {
              let cleanName = (course.name || "").replace(/^"(.*)"$/, "$1");
              options += `<option value="${course.id}" data-course='${JSON.stringify(course)}'>
                        ${cleanName}
                      </option>`;
            });
            $("#courseSelect").html(options);
          }
        },
        error: function () {
          $("#formMessage").html(`<div class="alert alert-danger">Failed to fetch courses.</div>`);
        }
      });

      // 🔹 On selecting course → prefill
      $("#courseSelect").change(function () {
        let selected = $(this).find(":selected").data("course");
        if (selected) {
          $("#courseId").val(selected.id);
          $("#courseName").val((selected.name || "").replace(/^"(.*)"$/, "$1"));
          $("#description").val((selected.description || "").replace(/^"(.*)"$/, "$1"));
          $("#businessTarget").val(selected.businessTarget || "");
          $("#certificateCount").val(selected.certificateCount || "");
          $("#totalDays").val(selected.totalDays || "");
          $("#duration").val(selected.duration || "");

          if (selected.img) {
            let url = selected.img;
            if (url.endsWith(".pdf")) {
              $("#previewImage").attr("src", "https://cdn-icons-png.flaticon.com/512/337/337946.png");
            } else {
              $("#previewImage").attr("src", url);
            }
            $("#uploadBox").hide();
            $("#previewBox").show();
          } else {
            $("#previewBox").hide();
            $("#uploadBox").show();
          }
        }
      });

      // 🔹 Preview new image selection
      $("#imageInput").change(function () {
        const file = this.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            $("#previewImage").attr("src", e.target.result);
            $("#previewBox").show();
            $("#uploadBox").hide();
          };
          reader.readAsDataURL(file);
        }
      });

      // 🔹 Remove preview image
      $("#removeImage").click(function () {
        $("#previewBox").hide();
        $("#uploadBox").show();
        $("#imageInput").val("");
      });

      // 🔹 Submit (Update Course)
      $("#submitBtn").click(function () {
        let courseId = $("#courseId").val();
        if (!courseId) {
          $("#formMessage").html(`<div class="alert alert-warning">Please select a course first.</div>`);
          return;
        }

        let formData = new FormData();
        formData.append("name", $("#courseName").val());
        formData.append("description", $("#description").val());
        formData.append("domainId", parseInt($("#courseSelect").val()) || null);
        formData.append("businessTarget", $("#businessTarget").val() ? parseInt($("#businessTarget").val()) : null);
        formData.append("certificateCount", $("#certificateCount").val() ? parseInt($("#certificateCount").val()) : null);
        formData.append("totalDays", $("#totalDays").val() ? parseInt($("#totalDays").val()) : null);
        formData.append("duration", $("#duration").val());

        let imageFile = $("#imageInput")[0].files[0];
        if (imageFile) {
          formData.append("img", imageFile);
        }

        // Loader before request
        Swal.fire({
          title: "Updating Course...",
          allowOutsideClick: false,
          didOpen: () => {
            Swal.showLoading();
          }
        });

        $.ajax({
          url: `https://eduroom.in/api/v1/course/update/${courseId}`,
          type: "PUT",
          data: formData,
          processData: false,
          contentType: false,
          success: function (res) {
            Swal.close();
            if (res.success) {
              Swal.fire("Updated!", "Course updated successfully!", "success");
            } else {
              Swal.fire("Failed!", res.error || "Update failed", "error");
            }
          },
          error: function (xhr) {
            Swal.close();
            Swal.fire("Error!", `Server error: ${xhr.status} ${xhr.statusText}`, "error");
          }
        });
      });

      // 🔹 Delete Course
      $("#deleteBtn").click(function () {
        let courseId = $("#courseId").val();
        if (!courseId) {
          Swal.fire("Warning", "Please select a course first.", "warning");
          return;
        }

        Swal.fire({
          title: "Are you sure?",
          text: "This will permanently delete the course.",
          icon: "warning",
          showCancelButton: true,
          confirmButtonText: "Yes, delete it!",
          cancelButtonText: "Cancel"
        }).then((result) => {
          if (result.isConfirmed) {
            Swal.fire({
              title: "Deleting...",
              allowOutsideClick: false,
              didOpen: () => {
                Swal.showLoading();
              }
            });

            $.ajax({
              url: `https://eduroom.in/api/v1/course/delete/${courseId}`,
              type: "DELETE",
              success: function (res) {
                Swal.close();
                if (res.success) {
                  Swal.fire("Deleted!", "Course deleted successfully!", "success");
                  $("#courseSelect option[value='" + courseId + "']").remove();
                  $("#courseSelect").val("");
                  $("#courseId").val("");
                  $("#courseName").val("");
                  $("#description").val("");
                  $("#businessTarget").val("");
                  $("#certificateCount").val("");
                  $("#totalDays").val("");
                  $("#duration").val("");
                  $("#previewBox").hide();
                  $("#uploadBox").show();
                } else {
                  Swal.fire("Failed!", res.error || "Delete failed", "error");
                }
              },
              error: function (xhr) {
                Swal.close();
                Swal.fire("Error!", `Server error: ${xhr.status} ${xhr.statusText}`, "error");
              }
            });
          }
        });
      });
    });
  </script>

  <script>
        window.addEventListener("pageshow", function (event) {
            if (event.persisted || (window.performance && window.performance.getEntriesByType("navigation")[0].type === "back_forward")) {
                window.location.reload();
            }
        });

        $(document).ready(function () {
            const userId = sessionStorage.getItem("user_id");

            if (!userId) {
                Swal.fire({
                    icon: "warning",
                    title: "Login Required",
                    text: "You must log in to access this page.",
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    showConfirmButton: true,
                    confirmButtonText: "Go to Login"
                }).then(() => {
                    window.top.location.href = "/login.html";
                });
                return;
            }

            $(document).on("click", "#logoutBtn", function () {
                Swal.fire({
                    title: "Logging out...",
                    text: "Please wait",
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                $.ajax({
                    url: "https://eduroom.in/api/v1/user/logout",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({ id: userId }),
                    success: function (res) {
                        console.log("Logout success:", res);
                        sessionStorage.removeItem("user_id");

                        Swal.fire({
                            icon: "success",
                            title: "Logged Out",
                            text: "You have been logged out successfully!",
                            showConfirmButton: false,
                            timer: 2000
                        }).then(() => {
                            window.top.location.href = "/login.html";
                        });
                    },
                    error: function (err) {
                        console.error("Logout error:", err);
                        Swal.fire({
                            icon: "error",
                            title: "Logout Failed",
                            text: "Something went wrong. Please try again!",
                            allowOutsideClick: false,
                            confirmButtonText: "OK"
                        });
                    }
                });
            });
        });
    </script>

</body>

</html>